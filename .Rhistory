modelfun = "analytic",
compound.col = "analyte_name_original",
cas.col = "dsstox_casrn",
reference.col = "fk_reference_document_id",
species.col = "species",
species.weight.col = "weight_kg",
species.weight.units.default = "kg",
dose.col = "dose_level_normalized",
time.col = "time_hr",
time.units.default = "hr",
media.col = "conc_medium_normalized",
media.units.default = "normalized",
value.col = "conc",
units.default = NA,
route.col = "administration_route_normalized",
source.col = "fk_extraction_document_id",
loq.default = NA,
subject.default = NA,
info.default = NA,
ratio.data.to.dose = 0.001
))
system.time(PK.fit.table.1comp <- fit_all(
data.set = data,
model = "1compartment",
modelfun = "analytic",
compound.col = "analyte_name_original",
cas.col = "dsstox_casrn",
reference.col = "fk_reference_document_id",
species.col = "species",
species.weight.col = "weight_kg",
species.weight.units.default = "kg",
dose.col = "dose_level_normalized",
time.col = "time_hr",
time.units.default = "hr",
media.col = "conc_medium_normalized",
media.units.default = "normalized",
value.col = "conc",
units.default = NA,
route.col = "administration_route_normalized",
source.col = "fk_extraction_document_id",
loq.default = NA,
subject.default = NA,
info.default = NA,
ratio.data.to.dose = 0.001
))
devtools::load_all(".")
system.time(PK.fit.table.1comp <- fit_all(
data.set = data,
model = "1compartment",
modelfun = "analytic",
compound.col = "analyte_name_original",
cas.col = "dsstox_casrn",
reference.col = "fk_reference_document_id",
species.col = "species",
species.weight.col = "weight_kg",
species.weight.units.default = "kg",
dose.col = "dose_level_normalized",
time.col = "time_hr",
time.units.default = "hr",
media.col = "conc_medium_normalized",
media.units.default = "normalized",
value.col = "conc",
units.default = NA,
route.col = "administration_route_normalized",
source.col = "fk_extraction_document_id",
loq.default = NA,
subject.default = NA,
info.default = NA,
ratio.data.to.dose = 0.001
))
debug(analyze_pk_data)
system.time(PK.fit.table.1comp <- fit_all(
data.set = data,
model = "1compartment",
modelfun = "analytic",
compound.col = "analyte_name_original",
cas.col = "dsstox_casrn",
reference.col = "fk_reference_document_id",
species.col = "species",
species.weight.col = "weight_kg",
species.weight.units.default = "kg",
dose.col = "dose_level_normalized",
time.col = "time_hr",
time.units.default = "hr",
media.col = "conc_medium_normalized",
media.units.default = "normalized",
value.col = "conc",
units.default = NA,
route.col = "administration_route_normalized",
source.col = "fk_extraction_document_id",
loq.default = NA,
subject.default = NA,
info.default = NA,
ratio.data.to.dose = 0.001
))
opt.params["Fgutabs"] <- log(oral.data$Value / mean(iv.data$Value) * mean(iv.data$Dose) / mean(oral.data$Dose))
opt.params
system.time(PK.fit.table.1comp <- fit_all(
data.set = data,
model = "1compartment",
modelfun = "analytic",
compound.col = "analyte_name_original",
cas.col = "dsstox_casrn",
reference.col = "fk_reference_document_id",
species.col = "species",
species.weight.col = "weight_kg",
species.weight.units.default = "kg",
dose.col = "dose_level_normalized",
time.col = "time_hr",
time.units.default = "hr",
media.col = "conc_medium_normalized",
media.units.default = "normalized",
value.col = "conc",
units.default = NA,
route.col = "administration_route_normalized",
source.col = "fk_extraction_document_id",
loq.default = NA,
subject.default = NA,
info.default = NA,
ratio.data.to.dose = 0.001
))
these.params
opt.params
these.params
data <- read.csv("inst/ext/cvt_query_for_john_27may2021_v2.csv")
data <- read.csv("inst/ext/cvt_query_for_john_27may2021_v2.csv")
### fix compound names
data$analyte_name_original[data$analyte_name_original == "Methyleugonal "] <- "Methyleugonal"
data$analyte_name_original[data$analyte_name_original == "2,4-D"] <- "2,4-Dichlorophenoxyacetic acid"
data$analyte_name_original[data$analyte_name_original == "Diclofenac"] <- "Hexobarbital"
data$analyte_name_original[data$analyte_name_original == "Pentadecafluorooctanoic acid"] <- "Perfluorooctanoic acid"
### make fk_reference_document equal fk_extraction document if fk_reference_document is NULL
data$fk_reference_document_id[data$fk_reference_document_id == "NULL"] <- data$fk_extraction_document_id[data$fk_reference_document_id == "NULL"]
debug(analyze_pk_data)
### do 1-Compartment fit
system.time(PK.fit.table.flat <- fit_all(
data.set = data,
model = "flat",
modelfun = "analytic",
compound.col = "analyte_name_original",
cas.col = "dsstox_casrn",
reference.col = "fk_reference_document_id",
species.col = "species",
species.weight.col = "weight_kg",
species.weight.units.default = "kg",
dose.col = "dose_level_normalized",
time.col = "time_hr",
time.units.default = "hr",
media.col = "conc_medium_normalized",
media.units.default = "normalized",
value.col = "conc",
units.default = NA,
route.col = "administration_route_normalized",
source.col = "fk_extraction_document_id",
loq.default = NA,
subject.default = NA,
info.default = NA,
ratio.data.to.dose = 0.001
))
devtools::load_all(".")
debug(analyze_pk_data)
### do 1-Compartment fit
system.time(PK.fit.table.flat <- fit_all(
data.set = data,
model = "flat",
modelfun = "analytic",
compound.col = "analyte_name_original",
cas.col = "dsstox_casrn",
reference.col = "fk_reference_document_id",
species.col = "species",
species.weight.col = "weight_kg",
species.weight.units.default = "kg",
dose.col = "dose_level_normalized",
time.col = "time_hr",
time.units.default = "hr",
media.col = "conc_medium_normalized",
media.units.default = "normalized",
value.col = "conc",
units.default = NA,
route.col = "administration_route_normalized",
source.col = "fk_extraction_document_id",
loq.default = NA,
subject.default = NA,
info.default = NA,
ratio.data.to.dose = 0.001
))
View(all.data.fit)
View(arith.means)
View(out.dt)
View(out.dt)
View(out.dt)
View(out.dt)
View(out.dt)
### do 1-Compartment fit
system.time(PK.fit.table.flat <- fit_all(
data.set = data,
model = "1comp",
modelfun = "analytic",
compound.col = "analyte_name_original",
cas.col = "dsstox_casrn",
reference.col = "fk_reference_document_id",
species.col = "species",
species.weight.col = "weight_kg",
species.weight.units.default = "kg",
dose.col = "dose_level_normalized",
time.col = "time_hr",
time.units.default = "hr",
media.col = "conc_medium_normalized",
media.units.default = "normalized",
value.col = "conc",
units.default = NA,
route.col = "administration_route_normalized",
source.col = "fk_extraction_document_id",
loq.default = NA,
subject.default = NA,
info.default = NA,
ratio.data.to.dose = 0.001
))
undebug(analyze_pk_data)
### do 1-Compartment fit
system.time(PK.fit.table.flat <- fit_all(
data.set = data,
model = "1comp",
modelfun = "analytic",
compound.col = "analyte_name_original",
cas.col = "dsstox_casrn",
reference.col = "fk_reference_document_id",
species.col = "species",
species.weight.col = "weight_kg",
species.weight.units.default = "kg",
dose.col = "dose_level_normalized",
time.col = "time_hr",
time.units.default = "hr",
media.col = "conc_medium_normalized",
media.units.default = "normalized",
value.col = "conc",
units.default = NA,
route.col = "administration_route_normalized",
source.col = "fk_extraction_document_id",
loq.default = NA,
subject.default = NA,
info.default = NA,
ratio.data.to.dose = 0.001
))
### do 1-Compartment fit
system.time(PK.fit.table.flat <- fit_all(
data.set = data,
model = "flat",
modelfun = "analytic",
compound.col = "analyte_name_original",
cas.col = "dsstox_casrn",
reference.col = "fk_reference_document_id",
species.col = "species",
species.weight.col = "weight_kg",
species.weight.units.default = "kg",
dose.col = "dose_level_normalized",
time.col = "time_hr",
time.units.default = "hr",
media.col = "conc_medium_normalized",
media.units.default = "normalized",
value.col = "conc",
units.default = NA,
route.col = "administration_route_normalized",
source.col = "fk_extraction_document_id",
loq.default = NA,
subject.default = NA,
info.default = NA,
ratio.data.to.dose = 0.001
))
### do 1-Compartment fit
system.time(PK.fit.table.1comp <- fit_all(
data.set = data,
model = "1comp",
modelfun = "analytic",
compound.col = "analyte_name_original",
cas.col = "dsstox_casrn",
reference.col = "fk_reference_document_id",
species.col = "species",
species.weight.col = "weight_kg",
species.weight.units.default = "kg",
dose.col = "dose_level_normalized",
time.col = "time_hr",
time.units.default = "hr",
media.col = "conc_medium_normalized",
media.units.default = "normalized",
value.col = "conc",
units.default = NA,
route.col = "administration_route_normalized",
source.col = "fk_extraction_document_id",
loq.default = NA,
subject.default = NA,
info.default = NA,
ratio.data.to.dose = 0.001
))
debug(analyze_pk_data)
### do 1-Compartment fit
system.time(PK.fit.table.1comp <- fit_all(
data.set = data,
model = "1comp",
modelfun = "analytic",
compound.col = "analyte_name_original",
cas.col = "dsstox_casrn",
reference.col = "fk_reference_document_id",
species.col = "species",
species.weight.col = "weight_kg",
species.weight.units.default = "kg",
dose.col = "dose_level_normalized",
time.col = "time_hr",
time.units.default = "hr",
media.col = "conc_medium_normalized",
media.units.default = "normalized",
value.col = "conc",
units.default = NA,
route.col = "administration_route_normalized",
source.col = "fk_extraction_document_id",
loq.default = NA,
subject.default = NA,
info.default = NA,
ratio.data.to.dose = 0.001
))
devtools::load_all(".")
### do 1-Compartment fit
system.time(PK.fit.table.1comp <- fit_all(
data.set = data,
model = "1compartment",
modelfun = "analytic",
compound.col = "analyte_name_original",
cas.col = "dsstox_casrn",
reference.col = "fk_reference_document_id",
species.col = "species",
species.weight.col = "weight_kg",
species.weight.units.default = "kg",
dose.col = "dose_level_normalized",
time.col = "time_hr",
time.units.default = "hr",
media.col = "conc_medium_normalized",
media.units.default = "normalized",
value.col = "conc",
units.default = NA,
route.col = "administration_route_normalized",
source.col = "fk_extraction_document_id",
loq.default = NA,
subject.default = NA,
info.default = NA,
ratio.data.to.dose = 0.001
))
debug(analyze_pk_data)
### do 1-Compartment fit
system.time(PK.fit.table.1comp <- fit_all(
data.set = data,
model = "1compartment",
modelfun = "analytic",
compound.col = "analyte_name_original",
cas.col = "dsstox_casrn",
reference.col = "fk_reference_document_id",
species.col = "species",
species.weight.col = "weight_kg",
species.weight.units.default = "kg",
dose.col = "dose_level_normalized",
time.col = "time_hr",
time.units.default = "hr",
media.col = "conc_medium_normalized",
media.units.default = "normalized",
value.col = "conc",
units.default = NA,
route.col = "administration_route_normalized",
source.col = "fk_extraction_document_id",
loq.default = NA,
subject.default = NA,
info.default = NA,
ratio.data.to.dose = 0.001
))
View(out.dt)
devtools::load_all(".")
### do 1-Compartment fit
system.time(PK.fit.table.flat <- fit_all(
data.set = data,
model = "flat",
modelfun = "analytic",
compound.col = "analyte_name_original",
cas.col = "dsstox_casrn",
reference.col = "fk_reference_document_id",
species.col = "species",
species.weight.col = "weight_kg",
species.weight.units.default = "kg",
dose.col = "dose_level_normalized",
time.col = "time_hr",
time.units.default = "hr",
media.col = "conc_medium_normalized",
media.units.default = "normalized",
value.col = "conc",
units.default = NA,
route.col = "administration_route_normalized",
source.col = "fk_extraction_document_id",
loq.default = NA,
subject.default = NA,
info.default = NA,
ratio.data.to.dose = 0.001
))
write.csv(PK.fit.table.flat, "inst/ext/PK.fit.table.flat.02102022.csv")
write.csv(PK.fit.table.flat[[1]], "inst/ext/PK.fit.table.flat.02102022.csv")
write.csv(PK.fit.table.flat[[1]], "inst/ext/PK.fit.table.fla.02102022.csv")
library(tidyverse)
library(data.table)
library(readxl)
devtools::load_all(".")
### load all of this wonderful data
load("figures_rdata/pk_output_1comp_12212021.Rdata")
load("figures_rdata/pk_output_2comp_12212021.Rdata")
load("figures_rdata/raw_1comp_12212021.Rdata")
load("figures_rdata/raw_2comp_12212021.Rdata")
load("figures_rdata/cp_df_12212021.Rdata")
load("figures_rdata/cvt_variability_df_12212021.Rdata")
load("figures_rdata/pk_lombardo_02072022.Rdata")
##################
##################
data1 <- pk_output_1comp_12212021 %>%
filter(param.value.type == "Fitted geometric mean" & AIC != Inf & Data.Analyzed != "Joint Analysis")
data2 <- pk_output_2comp_02102022 %>%
filter(param.value.type == "Fitted geometric mean" & AIC != Inf & Data.Analyzed != "Joint Analysis")
##################
##################
### assign new column, with either "1-Compartment" or "2-Compartment"
data1 <- subset(data1, select = sigma_value)
data1$model <- "1-Compartment"
data2 <- subset(data2, select = sigma_value)
data2$model <- "2-Compartment"
data <- rbind(data1, data2)
p <- ggplot(data = data,
mapping = aes(x = sigma_value)) +
geom_histogram(bins = 15) +
# geom_density() +
# scale_y_log10()+
scale_x_log10() +
theme_bw() +
labs(x = "Sigma",
y = "Number of observations") +
facet_wrap(.~ model) +
geom_vline(xintercept = 2.22e-06)
# stat_function(fun = dlnorm, args = list(mean = mean(log(data$sigma_value)), sd = sd(log(data$sigma_value))))
p
data <- read.csv("inst/ext/cvt_query_for_john_27may2021_v2.csv")
### fix compound names
data$analyte_name_original[data$analyte_name_original == "Methyleugonal "] <- "Methyleugonal"
data$analyte_name_original[data$analyte_name_original == "benzo[a]pyrene"] <- "benzo(a)pyrene"
data$analyte_name_original[data$analyte_name_original == "2,4-D"] <- "2,4-Dichlorophenoxyacetic acid"
data$analyte_name_original[data$analyte_name_original == "Diclofenac"] <- "Hexobarbital"
data$analyte_name_original[data$analyte_name_original == "Pentadecafluorooctanoic acid"] <- "Perfluorooctanoic acid"
### make fk_reference_document equal fk_extraction document if fk_reference_document is NULL
data$fk_reference_document_id[data$fk_reference_document_id == "NULL"] <- data$fk_extraction_document_id[data$fk_reference_document_id == "NULL"]
### do 1-Compartment fit
system.time(PK.fit.table.1comp <- fit_all(
data.set = data,
model = "1compartment",
modelfun = "analytic",
compound.col = "analyte_name_original",
cas.col = "dsstox_casrn",
reference.col = "fk_reference_document_id",
species.col = "species",
species.weight.col = "weight_kg",
species.weight.units.default = "kg",
dose.col = "dose_level_normalized",
time.col = "time_hr",
time.units.default = "hr",
media.col = "conc_medium_normalized",
media.units.default = "normalized",
value.col = "conc",
units.default = NA,
route.col = "administration_route_normalized",
source.col = "fk_extraction_document_id",
loq.default = NA,
subject.default = NA,
info.default = NA,
ratio.data.to.dose = 0.001
))
system.time(PK.fit.table.flat <- fit_all(
data.set = data,
model = "flat",
modelfun = "analytic",
compound.col = "analyte_name_original",
cas.col = "dsstox_casrn",
reference.col = "fk_reference_document_id",
species.col = "species",
species.weight.col = "weight_kg",
species.weight.units.default = "kg",
dose.col = "dose_level_normalized",
time.col = "time_hr",
time.units.default = "hr",
media.col = "conc_medium_normalized",
media.units.default = "normalized",
value.col = "conc",
units.default = NA,
route.col = "administration_route_normalized",
source.col = "fk_extraction_document_id",
loq.default = NA,
subject.default = NA,
info.default = NA,
ratio.data.to.dose = 0.001
))
write.csv(PK.fit.table.flat[[1]], "inst/ext/PK.fit.table.flat.02102022.csv", row.names = FALSE)
### load all of this wonderful data
load("figures_rdata/pk_output_1comp_12212021.Rdata")
load("figures_rdata/pk_output_2comp_12212021.Rdata")
load("figures_rdata/raw_1comp_12212021.Rdata")
load("figures_rdata/raw_2comp_12212021.Rdata")
load("figures_rdata/cp_df_12212021.Rdata")
load("figures_rdata/cvt_variability_df_12212021.Rdata")
load("figures_rdata/pk_lombardo_02072022.Rdata")
length(unique(pk_lombardo$Name))
length(unique(pk_lombardo$`CAS #`))
length(unique(pk_lombardo$Reference))
citation("optimx")
