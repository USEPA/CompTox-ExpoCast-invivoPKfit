<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>manuscript2023</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">manuscript2023</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>() </span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#&gt; ℹ Loading invivoPKfit</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># saveRDS(my_pk_100j, &quot;data-raw/all_cvt_pk_JOINT.rds&quot;)</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co"># my_pk &lt;- readRDS(&quot;data-raw/all_cvt_pk_JOINT.rds&quot;)</span></span></code></pre></div>
<div id="toc" class="section level1">
<h1>TOC</h1>
<ol style="list-style-type: decimal">
<li>Pulling Data from CvTdb<br />
</li>
</ol>
<ul>
<li>Minimal <code>pk</code> object<br />
</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Running all possible fitting options<br />
</li>
</ol>
<ul>
<li>Evaluating fitting options<br />
</li>
<li>Head-to-head comparison of pooled vs joint models<br />
</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Running dose-normalized joint fits<br />
</li>
<li>Analysis Plots<br />
</li>
</ol>
<ul>
<li>CvTdb replicate variation (Figure 4A &amp; Alternative)<br />
</li>
<li>CvTdb replicate variation over ADME-normalized time (Figure
4B)<br />
</li>
<li>CvTdb concentration and final time-point distributions
(Supplementary Figure 1)<br />
</li>
<li>invivoPKfit fit option selection (Supplementary Table 1)<br />
</li>
<li>invivoPKfit model performance (Supplementary Figure 2)<br />
</li>
<li>Model performance vs Data variability (Figure 5 and
Alternative)<br />
</li>
<li>Goodness of fit plots (Figure 6)<br />
</li>
<li>Fits that may be improved (Supplementary Figure 3)<br />
</li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>Lombardo Analysis<br />
</li>
</ol>
<ul>
<li>Chemicals included<br />
</li>
<li>Comparison of derived TK stats (Figure 7A)<br />
</li>
<li>Histograms for Steady-state Volume of Dist. and Total Clearance
(Supplemental Figure 4)</li>
</ul>
<ol start="6" style="list-style-type: decimal">
<li>Benchmarking invivoPKfit</li>
</ol>
<ul>
<li>Parallelization speeds up the process of fitting (Supplementary
Figure 5)</li>
</ul>
<div id="pulling-data-from-cvtdb" class="section level2">
<h2>Pulling data from CvTdb</h2>
<p>See <code>pulling_iv_oral_cvtdb.Rmd</code>.</p>
<p>The following chunk shows the column/field mapping from the
<code>cvt</code> object and the <code>pk</code> object needed for
invivoPKfit analysis.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="do">### Minimal PK Object </span><span class="al">###</span><span class="do">----</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co"># Minimum pk object, add options later</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># Note that these mappings are now a default mappings, just being verbose here.</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>minimal_pk <span class="ot">&lt;-</span> <span class="fu">pk</span>(<span class="at">data =</span> cvt,</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>                 <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>                   <span class="at">Chemical =</span> analyte_dtxsid,</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>                   <span class="at">Chemical_Name =</span> analyte_name_original,</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>                   <span class="at">DTXSID =</span> analyte_dtxsid,</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>                   <span class="at">CASRN =</span> analyte_casrn,</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>                   <span class="at">Species =</span> species,</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>                   <span class="at">Reference =</span> document_id,</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>                   <span class="at">Media =</span> conc_medium_normalized,</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>                   <span class="at">Route =</span> administration_route_normalized,</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>                   <span class="at">Dose =</span> dose_level_normalized,</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>                   <span class="at">Dose.Units =</span> <span class="st">&quot;mg/kg&quot;</span>,</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>                   <span class="at">Subject_ID =</span> subject_id,</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>                   <span class="at">Series_ID =</span> series_id,</span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>                   <span class="at">Study_ID =</span> study_id,</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>                   <span class="at">ConcTime_ID =</span> conc_time_id,</span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>                   <span class="at">N_Subjects =</span> n_subjects_in_series,</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>                   <span class="at">Weight =</span> weight_kg,</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>                   <span class="at">Weight.Units =</span> <span class="st">&quot;kg&quot;</span>,</span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>                   <span class="at">Time =</span> time_hr,</span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>                   <span class="at">Time.Units =</span> <span class="st">&quot;hours&quot;</span>,</span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>                   <span class="at">Value =</span> conc,</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>                   <span class="at">Value.Units =</span> <span class="st">&quot;mg/L&quot;</span>,</span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a>                   <span class="at">Value_SD =</span> conc_sd_normalized,</span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>                   <span class="at">LOQ =</span> loq</span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>                 ))</span></code></pre></div>
</div>
<div id="running-all-possible-fitting-options" class="section level2">
<h2>Running all possible fitting options</h2>
<p>This chunk is to run all the options through a standard pipeline that
calculates RMSE for Cmax and AUC_inf for the Chemical Species Route
Media grouping…</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Types of Choices:</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="do">## Dose Normalized</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="do">## Log10 transform</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="do">## Scale time</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co"># Pooled</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>my_pk_000p <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">FALSE</span>, <span class="at">log10_trans =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>  <span class="co"># scale_time(new_units = &quot;auto&quot;) +</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>  <span class="co"># stat_model() + </span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species)) </span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>my_pk_100p <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">TRUE</span>, <span class="at">log10_trans =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>  <span class="co"># scale_time(new_units = &quot;auto&quot;) +</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>  <span class="co"># stat_model() + </span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species)) </span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>my_pk_110p <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">TRUE</span>, <span class="at">log10_trans =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>  <span class="co"># scale_time(new_units = &quot;auto&quot;) +</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>  <span class="co"># stat_model() + </span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species)) </span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a>my_pk_111p <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">TRUE</span>, <span class="at">log10_trans =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a>  <span class="fu">scale_time</span>(<span class="at">new_units =</span> <span class="st">&quot;auto&quot;</span>) <span class="sc">+</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a>  <span class="co"># stat_model() + </span></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species))</span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a>my_pk_010p <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-50"><a href="#cb3-50" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb3-51"><a href="#cb3-51" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb3-52"><a href="#cb3-52" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">FALSE</span>, <span class="at">log10_trans =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb3-53"><a href="#cb3-53" tabindex="-1"></a>  <span class="co"># scale_time(new_units = &quot;auto&quot;) +</span></span>
<span id="cb3-54"><a href="#cb3-54" tabindex="-1"></a>  <span class="co"># stat_model() + </span></span>
<span id="cb3-55"><a href="#cb3-55" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species)) </span>
<span id="cb3-56"><a href="#cb3-56" tabindex="-1"></a></span>
<span id="cb3-57"><a href="#cb3-57" tabindex="-1"></a>my_pk_011p <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb3-58"><a href="#cb3-58" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb3-59"><a href="#cb3-59" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-60"><a href="#cb3-60" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb3-61"><a href="#cb3-61" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb3-62"><a href="#cb3-62" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">FALSE</span>, <span class="at">log10_trans =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb3-63"><a href="#cb3-63" tabindex="-1"></a>  <span class="fu">scale_time</span>(<span class="at">new_units =</span> <span class="st">&quot;auto&quot;</span>) <span class="sc">+</span></span>
<span id="cb3-64"><a href="#cb3-64" tabindex="-1"></a>  <span class="co"># stat_model() + </span></span>
<span id="cb3-65"><a href="#cb3-65" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species)) </span>
<span id="cb3-66"><a href="#cb3-66" tabindex="-1"></a></span>
<span id="cb3-67"><a href="#cb3-67" tabindex="-1"></a>my_pk_001p <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb3-68"><a href="#cb3-68" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb3-69"><a href="#cb3-69" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-70"><a href="#cb3-70" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb3-71"><a href="#cb3-71" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb3-72"><a href="#cb3-72" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">FALSE</span>, <span class="at">log10_trans =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb3-73"><a href="#cb3-73" tabindex="-1"></a>  <span class="fu">scale_time</span>(<span class="at">new_units =</span> <span class="st">&quot;auto&quot;</span>) <span class="sc">+</span></span>
<span id="cb3-74"><a href="#cb3-74" tabindex="-1"></a>  <span class="co"># stat_model() + </span></span>
<span id="cb3-75"><a href="#cb3-75" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species)) </span>
<span id="cb3-76"><a href="#cb3-76" tabindex="-1"></a></span>
<span id="cb3-77"><a href="#cb3-77" tabindex="-1"></a>my_pk_101p <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb3-78"><a href="#cb3-78" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb3-79"><a href="#cb3-79" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-80"><a href="#cb3-80" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb3-81"><a href="#cb3-81" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb3-82"><a href="#cb3-82" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">TRUE</span>, <span class="at">log10_trans =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb3-83"><a href="#cb3-83" tabindex="-1"></a>  <span class="fu">scale_time</span>(<span class="at">new_units =</span> <span class="st">&quot;auto&quot;</span>) <span class="sc">+</span></span>
<span id="cb3-84"><a href="#cb3-84" tabindex="-1"></a>  <span class="co"># stat_model() + </span></span>
<span id="cb3-85"><a href="#cb3-85" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species)) </span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Joint</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>my_pk_000j <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">FALSE</span>, <span class="at">log10_trans =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>  <span class="co"># scale_time(new_units = &quot;auto&quot;) +</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>  <span class="co"># stat_model() + </span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species, Reference)) </span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>my_pk_100j <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">TRUE</span>, <span class="at">log10_trans =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>  <span class="co"># scale_time(new_units = &quot;auto&quot;) +</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>  <span class="co"># stat_model() + </span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species, Reference)) </span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>my_pk_110j <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">TRUE</span>, <span class="at">log10_trans =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>  <span class="co"># scale_time(new_units = &quot;auto&quot;) +</span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>  <span class="co"># stat_model() + </span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species, Reference)) </span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a>my_pk_111j <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">TRUE</span>, <span class="at">log10_trans =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a>  <span class="fu">scale_time</span>(<span class="at">new_units =</span> <span class="st">&quot;auto&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a>  <span class="co"># stat_model() + </span></span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species, Reference))</span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a>my_pk_010j <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb4-44"><a href="#cb4-44" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-45"><a href="#cb4-45" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb4-46"><a href="#cb4-46" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb4-47"><a href="#cb4-47" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">FALSE</span>, <span class="at">log10_trans =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb4-48"><a href="#cb4-48" tabindex="-1"></a>  <span class="co"># scale_time(new_units = &quot;auto&quot;) +</span></span>
<span id="cb4-49"><a href="#cb4-49" tabindex="-1"></a>  <span class="co"># stat_model() + </span></span>
<span id="cb4-50"><a href="#cb4-50" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species, Reference)) </span>
<span id="cb4-51"><a href="#cb4-51" tabindex="-1"></a></span>
<span id="cb4-52"><a href="#cb4-52" tabindex="-1"></a>my_pk_011j <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb4-53"><a href="#cb4-53" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb4-54"><a href="#cb4-54" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-55"><a href="#cb4-55" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb4-56"><a href="#cb4-56" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb4-57"><a href="#cb4-57" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">FALSE</span>, <span class="at">log10_trans =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb4-58"><a href="#cb4-58" tabindex="-1"></a>  <span class="fu">scale_time</span>(<span class="at">new_units =</span> <span class="st">&quot;auto&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-59"><a href="#cb4-59" tabindex="-1"></a>  <span class="co"># stat_model() + </span></span>
<span id="cb4-60"><a href="#cb4-60" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species, Reference)) </span>
<span id="cb4-61"><a href="#cb4-61" tabindex="-1"></a></span>
<span id="cb4-62"><a href="#cb4-62" tabindex="-1"></a>my_pk_001j <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb4-63"><a href="#cb4-63" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb4-64"><a href="#cb4-64" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-65"><a href="#cb4-65" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb4-66"><a href="#cb4-66" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb4-67"><a href="#cb4-67" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">FALSE</span>, <span class="at">log10_trans =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-68"><a href="#cb4-68" tabindex="-1"></a>  <span class="fu">scale_time</span>(<span class="at">new_units =</span> <span class="st">&quot;auto&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-69"><a href="#cb4-69" tabindex="-1"></a>  <span class="co"># stat_model() + </span></span>
<span id="cb4-70"><a href="#cb4-70" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species, Reference)) </span>
<span id="cb4-71"><a href="#cb4-71" tabindex="-1"></a></span>
<span id="cb4-72"><a href="#cb4-72" tabindex="-1"></a>my_pk_101j <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb4-73"><a href="#cb4-73" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb4-74"><a href="#cb4-74" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-75"><a href="#cb4-75" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb4-76"><a href="#cb4-76" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb4-77"><a href="#cb4-77" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">TRUE</span>, <span class="at">log10_trans =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-78"><a href="#cb4-78" tabindex="-1"></a>  <span class="fu">scale_time</span>(<span class="at">new_units =</span> <span class="st">&quot;auto&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-79"><a href="#cb4-79" tabindex="-1"></a>  <span class="co"># stat_model() + </span></span>
<span id="cb4-80"><a href="#cb4-80" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species, Reference)) </span></code></pre></div>
<div id="evaluating-fitting-options" class="section level3">
<h3>Evaluating fitting options</h3>
<p>Here I evaluate the various fitting options by counting the number of
fits for each model that “won” based on AIC. This is given by the
<code>get_winning_model</code> method. Furthermore, I also calculate the
root mean squared error (RMSE) for AUC<sub>inf</sub> and C<sub>max</sub>
values. The <em>observed</em> values in this calculation are the results
of the non-compartmental analysis. Importantly, all Chemical, Species,
Reference, Route, Media, Dose data groups with AUC<sub>inf</sub> values
that are non-finite or zero in either non-compartmental or
<em>invivoPKfit</em> analysis are not included in the calculation for
RMSE (of AUC or C<sub>max</sub>). This is to exclude the “incalculable”
RMSEs such that they won’t impact our assessment of each set of options’
<em>goodness-of-fit</em>. Lastly, we calculate more detailed statistics
such as R<sup>2</sup> and average fold error for each model, method, and
set <strong>data_group</strong> for downstream analyses.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Evaluation</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co"># Current: </span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>get_choices <span class="ot">&lt;-</span> <span class="cf">function</span>(obj, <span class="at">PJ =</span> <span class="st">&quot;Pooled&quot;</span>) {</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  dose_norm <span class="ot">&lt;-</span> obj<span class="sc">$</span>scales<span class="sc">$</span>conc<span class="sc">$</span>dose_norm</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  log10_norm <span class="ot">&lt;-</span> obj<span class="sc">$</span>scales<span class="sc">$</span>conc<span class="sc">$</span>log10_trans</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  time_scale <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(obj<span class="sc">$</span>scales<span class="sc">$</span>time<span class="sc">$</span>new_units <span class="sc">==</span> <span class="st">&quot;identity&quot;</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  </span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  my_choices <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dose_norm<span class="sc">+</span><span class="dv">0</span>,</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>                       log10_norm<span class="sc">+</span><span class="dv">0</span>,</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>                       time_scale<span class="sc">+</span><span class="dv">0</span>,</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>                       <span class="st">&quot; &quot;</span>, PJ)</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>  <span class="fu">return</span>(my_choices)</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>}</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co"># Write into package</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>evaluate_choices <span class="ot">&lt;-</span> <span class="cf">function</span>(obj, <span class="at">PJ =</span> <span class="st">&quot;Pooled&quot;</span>) {</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>  pk_name <span class="ot">&lt;-</span> <span class="fu">get_choices</span>(obj, <span class="at">PJ =</span> PJ)</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>  </span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>  cli<span class="sc">::</span><span class="fu">cli_progress_step</span>(<span class="st">&quot;Winning Model...&quot;</span>)</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>  <span class="co"># Wide winning model</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>  <span class="fu">suppressMessages</span>({</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>    winning_model <span class="ot">&lt;-</span> <span class="fu">get_winning_model</span>(<span class="at">obj =</span> obj) </span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>    wide_winning_model <span class="ot">&lt;-</span> winning_model <span class="sc">%&gt;%</span></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>      <span class="fu">group_by</span>(method, model) <span class="sc">%&gt;%</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>      <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> model, <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Options =</span> pk_name)</span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>  })</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>  </span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>  </span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>  cli<span class="sc">::</span><span class="fu">cli_progress_step</span>(<span class="st">&quot;Cmax and AUC_inf RMSEs...&quot;</span>)</span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a>  <span class="co"># Cmax and AUC_inf RMSEs</span></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>  <span class="fu">suppressMessages</span>({</span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a>    RMSE_eval <span class="ot">&lt;-</span> <span class="fu">eval_tkstats</span>(<span class="at">obj =</span> obj) <span class="sc">%&gt;%</span></span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Options =</span> pk_name) <span class="sc">%&gt;%</span></span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(Options,</span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a>                Chemical, Species,</span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a>                Route, Media, Reference,</span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a>                method, model,</span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a>                <span class="fu">starts_with</span>(<span class="st">&quot;Cmax&quot;</span>),</span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a>                <span class="fu">starts_with</span>(<span class="st">&quot;AUC_&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="fu">abs</span>(AUC_inf.nca <span class="sc">/</span> AUC_tlast.nca) <span class="sc">&lt;</span> <span class="dv">10</span>,</span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a>             <span class="fu">is.finite</span>(AUC_inf.nca), <span class="fu">is.finite</span>(AUC_inf.tkstats),</span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a>             AUC_inf.nca <span class="sc">&gt;</span> <span class="dv">0</span>, AUC_inf.tkstats <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-46"><a href="#cb5-46" tabindex="-1"></a>      <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-47"><a href="#cb5-47" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">SE_Cmax =</span> (Cmax.tkstats <span class="sc">-</span> Cmax.nca)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb5-48"><a href="#cb5-48" tabindex="-1"></a>             <span class="at">SE_AUC_inf =</span> (AUC_inf.tkstats <span class="sc">-</span> AUC_inf.nca)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-49"><a href="#cb5-49" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SE_Cmax), <span class="sc">!</span><span class="fu">is.na</span>(SE_AUC_inf)) <span class="sc">%&gt;%</span></span>
<span id="cb5-50"><a href="#cb5-50" tabindex="-1"></a>      <span class="fu">group_by</span>(Options, method) <span class="sc">%&gt;%</span></span>
<span id="cb5-51"><a href="#cb5-51" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">RMSE_Cmax =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(SE_Cmax,</span>
<span id="cb5-52"><a href="#cb5-52" tabindex="-1"></a>                                      <span class="at">na.rm =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span> <span class="fu">signif</span>(<span class="at">digits =</span> <span class="dv">4</span>),</span>
<span id="cb5-53"><a href="#cb5-53" tabindex="-1"></a>                <span class="at">RMSE_AUC =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(SE_AUC_inf,</span>
<span id="cb5-54"><a href="#cb5-54" tabindex="-1"></a>                                     <span class="at">na.rm =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span> <span class="fu">signif</span>(<span class="at">digits =</span> <span class="dv">4</span>))</span>
<span id="cb5-55"><a href="#cb5-55" tabindex="-1"></a>  })</span>
<span id="cb5-56"><a href="#cb5-56" tabindex="-1"></a>  </span>
<span id="cb5-57"><a href="#cb5-57" tabindex="-1"></a>  </span>
<span id="cb5-58"><a href="#cb5-58" tabindex="-1"></a>  cli<span class="sc">::</span><span class="fu">cli_progress_step</span>(<span class="st">&quot;More detailed metrics...&quot;</span>)</span>
<span id="cb5-59"><a href="#cb5-59" tabindex="-1"></a>  <span class="co"># Other metrics (detailed)</span></span>
<span id="cb5-60"><a href="#cb5-60" tabindex="-1"></a>  <span class="fu">suppressMessages</span>({</span>
<span id="cb5-61"><a href="#cb5-61" tabindex="-1"></a>    r2_df <span class="ot">&lt;-</span> <span class="fu">rsq</span>(obj, <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-62"><a href="#cb5-62" tabindex="-1"></a>    <span class="fu">inner_join</span>(winning_model)</span>
<span id="cb5-63"><a href="#cb5-63" tabindex="-1"></a>  myAIC <span class="ot">&lt;-</span> <span class="fu">AIC</span>(obj) <span class="sc">%&gt;%</span></span>
<span id="cb5-64"><a href="#cb5-64" tabindex="-1"></a>    <span class="fu">inner_join</span>(winning_model)</span>
<span id="cb5-65"><a href="#cb5-65" tabindex="-1"></a>  fold_errors_all <span class="ot">&lt;-</span> <span class="fu">fold_errors</span>(obj) <span class="sc">%&gt;%</span></span>
<span id="cb5-66"><a href="#cb5-66" tabindex="-1"></a>    <span class="fu">inner_join</span>(winning_model) <span class="sc">%&gt;%</span></span>
<span id="cb5-67"><a href="#cb5-67" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(Detect <span class="sc">%in%</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-68"><a href="#cb5-68" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(<span class="sc">!!!</span>obj<span class="sc">$</span>data_group, model, method) <span class="sc">%&gt;%</span></span>
<span id="cb5-69"><a href="#cb5-69" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">avg_FoldErr =</span> <span class="fu">mean</span>(Fold_Error, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-70"><a href="#cb5-70" tabindex="-1"></a>                       <span class="fu">signif</span>(<span class="at">digits =</span> <span class="dv">4</span>),</span>
<span id="cb5-71"><a href="#cb5-71" tabindex="-1"></a>                     <span class="at">median_FoldErr =</span> <span class="fu">median</span>(Fold_Error, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-72"><a href="#cb5-72" tabindex="-1"></a>                       <span class="fu">signif</span>(<span class="at">digits =</span> <span class="dv">4</span>),</span>
<span id="cb5-73"><a href="#cb5-73" tabindex="-1"></a>                     <span class="at">within_2fold =</span> <span class="fu">sum</span>(Fold_Error <span class="sc">&gt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Fold_Error <span class="sc">&lt;=</span> <span class="dv">2</span>)<span class="sc">/</span><span class="fu">length</span>(Fold_Error) <span class="sc">%&gt;%</span></span>
<span id="cb5-74"><a href="#cb5-74" tabindex="-1"></a>                       <span class="fu">signif</span>(<span class="at">digits =</span> <span class="dv">4</span>))</span>
<span id="cb5-75"><a href="#cb5-75" tabindex="-1"></a>  </span>
<span id="cb5-76"><a href="#cb5-76" tabindex="-1"></a>  myRMSE_all <span class="ot">&lt;-</span> <span class="fu">rmse</span>(obj,</span>
<span id="cb5-77"><a href="#cb5-77" tabindex="-1"></a>                     <span class="at">rmse_group =</span> <span class="fu">vars</span>(Route, Media, Dose),</span>
<span id="cb5-78"><a href="#cb5-78" tabindex="-1"></a>                     <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-79"><a href="#cb5-79" tabindex="-1"></a>    <span class="fu">inner_join</span>(winning_model) <span class="sc">%&gt;%</span></span>
<span id="cb5-80"><a href="#cb5-80" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(<span class="sc">!!!</span>obj<span class="sc">$</span>data_group, model, method) <span class="sc">%&gt;%</span></span>
<span id="cb5-81"><a href="#cb5-81" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">avg_MSE =</span> <span class="fu">mean</span>(RMSE<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-82"><a href="#cb5-82" tabindex="-1"></a>                       <span class="fu">signif</span>(<span class="at">digits =</span> <span class="dv">4</span>),</span>
<span id="cb5-83"><a href="#cb5-83" tabindex="-1"></a>                     <span class="at">median_MSE =</span> <span class="fu">median</span>(RMSE<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-84"><a href="#cb5-84" tabindex="-1"></a>                       <span class="fu">signif</span>(<span class="at">digits =</span> <span class="dv">4</span>))</span>
<span id="cb5-85"><a href="#cb5-85" tabindex="-1"></a>  </span>
<span id="cb5-86"><a href="#cb5-86" tabindex="-1"></a>  my_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(fold_errors_all, r2_df) <span class="sc">%&gt;%</span></span>
<span id="cb5-87"><a href="#cb5-87" tabindex="-1"></a>    <span class="fu">inner_join</span>(myAIC) <span class="sc">%&gt;%</span></span>
<span id="cb5-88"><a href="#cb5-88" tabindex="-1"></a>    <span class="fu">inner_join</span>(myRMSE_all) <span class="sc">%&gt;%</span></span>
<span id="cb5-89"><a href="#cb5-89" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Options =</span> pk_name, <span class="at">.before =</span> Chemical)</span>
<span id="cb5-90"><a href="#cb5-90" tabindex="-1"></a>  </span>
<span id="cb5-91"><a href="#cb5-91" tabindex="-1"></a>  full_list <span class="ot">&lt;-</span> <span class="fu">list</span>(wide_winning_model, RMSE_eval, my_df)</span>
<span id="cb5-92"><a href="#cb5-92" tabindex="-1"></a>  })</span>
<span id="cb5-93"><a href="#cb5-93" tabindex="-1"></a>  </span>
<span id="cb5-94"><a href="#cb5-94" tabindex="-1"></a>  <span class="fu">return</span>(full_list)</span>
<span id="cb5-95"><a href="#cb5-95" tabindex="-1"></a>}</span>
<span id="cb5-96"><a href="#cb5-96" tabindex="-1"></a><span class="fu">gc</span>()</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="do">### Evaluations-----</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>my_pk_000p <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk_000p, <span class="at">n_cores =</span> <span class="dv">14</span>)  <span class="sc">%&gt;%</span> <span class="fu">evaluate_choices</span>() <span class="co"># Done</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>my_pk_100p <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk_100p, <span class="at">n_cores =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> <span class="fu">evaluate_choices</span>() <span class="co"># Done</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>my_pk_110p <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk_110p, <span class="at">n_cores =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> <span class="fu">evaluate_choices</span>() <span class="co"># Done</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>my_pk_111p <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk_111p, <span class="at">n_cores =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> <span class="fu">evaluate_choices</span>() <span class="co"># Done</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="fu">rm</span>(my_pk_100p,my_pk_110p,my_pk_111p)</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>my_pk_010p <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk_010p, <span class="at">n_cores =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> <span class="fu">evaluate_choices</span>() <span class="co"># Done</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>my_pk_011p <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk_011p, <span class="at">n_cores =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> <span class="fu">evaluate_choices</span>() <span class="co"># Done </span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>my_pk_001p <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk_001p, <span class="at">n_cores =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> <span class="fu">evaluate_choices</span>() <span class="co"># Done</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>my_pk_101p <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk_101p, <span class="at">n_cores =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> <span class="fu">evaluate_choices</span>() <span class="co"># Done</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>my_pk_000j <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk_000j, <span class="at">n_cores =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> <span class="fu">evaluate_choices</span>(<span class="at">PJ =</span> <span class="st">&quot;Joint&quot;</span>) <span class="co"># Done</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>my_pk_100j <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk_100j, <span class="at">n_cores =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> <span class="fu">evaluate_choices</span>(<span class="at">PJ =</span> <span class="st">&quot;Joint&quot;</span>) <span class="co"># Done</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>my_pk_110j <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk_110j, <span class="at">n_cores =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> <span class="fu">evaluate_choices</span>(<span class="at">PJ =</span> <span class="st">&quot;Joint&quot;</span>) <span class="co"># Done</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>my_pk_111j <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk_111j, <span class="at">n_cores =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> <span class="fu">evaluate_choices</span>(<span class="at">PJ =</span> <span class="st">&quot;Joint&quot;</span>) <span class="co"># Done</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="fu">rm</span>(my_pk_000j, my_pk_100j, my_pk_110j, my_pk_111j)</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>my_pk_010j <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk_010j, <span class="at">n_cores =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> <span class="fu">evaluate_choices</span>(<span class="at">PJ =</span> <span class="st">&quot;Joint&quot;</span>) <span class="co"># Done</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>my_pk_011j <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk_011j, <span class="at">n_cores =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> <span class="fu">evaluate_choices</span>(<span class="at">PJ =</span> <span class="st">&quot;Joint&quot;</span>) <span class="co"># Done</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>my_pk_001j <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk_001j, <span class="at">n_cores =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> <span class="fu">evaluate_choices</span>(<span class="at">PJ =</span> <span class="st">&quot;Joint&quot;</span>) <span class="co"># Done</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>my_pk_101j <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk_101j, <span class="at">n_cores =</span> <span class="dv">8</span>) <span class="sc">%&gt;%</span> <span class="fu">evaluate_choices</span>(<span class="at">PJ =</span> <span class="st">&quot;Joint&quot;</span>) <span class="co"># Done</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a><span class="co"># Run after each evaluation</span></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a><span class="co"># initialization (only run once)</span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>{</span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a>winning_model_final <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a>rmse_summary <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a>detail_stats <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a>}</span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a><span class="co"># Run all at once</span></span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a>{</span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a>current_pk <span class="ot">&lt;-</span> my_pk_101j <span class="co"># Define current evaluated pk object here</span></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a>winning_model_final <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(winning_model_final, current_pk[[<span class="dv">1</span>]])</span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a>rmse_summary <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(rmse_summary, current_pk[[<span class="dv">2</span>]])</span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a>detail_stats <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(detail_stats, current_pk[[<span class="dv">3</span>]])</span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a><span class="fu">rm</span>(current_pk)</span>
<span id="cb6-40"><a href="#cb6-40" tabindex="-1"></a><span class="fu">gc</span>()</span>
<span id="cb6-41"><a href="#cb6-41" tabindex="-1"></a>}</span>
<span id="cb6-42"><a href="#cb6-42" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" tabindex="-1"></a><span class="co"># For copy + pasting into Excel workbook</span></span>
<span id="cb6-44"><a href="#cb6-44" tabindex="-1"></a>winning_model_final <span class="sc">%&gt;%</span> clipr<span class="sc">::</span><span class="fu">write_clip</span>(<span class="at">col.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-45"><a href="#cb6-45" tabindex="-1"></a>clipr<span class="sc">::</span><span class="fu">clear_clip</span>()</span>
<span id="cb6-46"><a href="#cb6-46" tabindex="-1"></a>rmse_summary <span class="sc">%&gt;%</span> clipr<span class="sc">::</span><span class="fu">write_clip</span>(<span class="at">col.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-47"><a href="#cb6-47" tabindex="-1"></a>clipr<span class="sc">::</span><span class="fu">clear_clip</span>()</span>
<span id="cb6-48"><a href="#cb6-48" tabindex="-1"></a>detail_stats <span class="sc">%&gt;%</span> clipr<span class="sc">::</span><span class="fu">write_clip</span>(<span class="at">col.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-49"><a href="#cb6-49" tabindex="-1"></a>clipr<span class="sc">::</span><span class="fu">clear_clip</span>()</span>
<span id="cb6-50"><a href="#cb6-50" tabindex="-1"></a><span class="fu">gc</span>()</span></code></pre></div>
</div>
</div>
<div id="head-to-head-comparison-of-pooled-vs-joint-models" class="section level2">
<h2>Head-to-head comparison of pooled vs joint models</h2>
<p>Now I need to go back and re-analyze the data only for 100, 101, and
000 Pooled and Joint, L-BFGS-B only. I need to filter the cvt_df to only
include Chem + Species combinations with multiple references. Then I
will join them with the excel sheet of already collected data.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Reference Multiples</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>multiRef_ChemSpec <span class="ot">&lt;-</span> cvt_df <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="fu">distinct</span>(analyte_dtxsid, species, document_id) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="fu">group_by</span>(analyte_dtxsid, species) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>n)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>multiRef_ChemSpec <span class="sc">%&gt;%</span> <span class="fu">nrow</span>() <span class="co"># Surprisingly only 13 Chem + Species have multiple references</span></span></code></pre></div>
<p>These finalists will be compared based on their more detailed
statistics.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>finalist_options <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;000 Pooled&quot;</span>, <span class="st">&quot;000 Joint&quot;</span>,</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>                      <span class="st">&quot;100 Pooled&quot;</span>, <span class="st">&quot;100 Joint&quot;</span>,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>                      <span class="st">&quot;101 Pooled&quot;</span>, <span class="st">&quot;101 Joint&quot;</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co"># What are the sheets names</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>readxl<span class="sc">::</span><span class="fu">excel_sheets</span>(<span class="fu">paste</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>                           <span class="st">&quot;DataSummary_9_21_2023.xlsx&quot;</span>,</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>                           <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)) <span class="co"># Predictions Evaluation</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>preval <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="fu">paste</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>                                  <span class="st">&quot;DataSummary_9_21_2023.xlsx&quot;</span>,</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>                                  <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>                            <span class="at">sheet =</span> <span class="st">&quot;Predictions Evaluation&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>  <span class="fu">left_join</span>(multiRef_ChemSpec,</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(Chemical <span class="sc">==</span> analyte_dtxsid,</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>                         Species <span class="sc">==</span> species)) <span class="sc">%&gt;%</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>  <span class="fu">filter</span>(method <span class="sc">%in%</span> <span class="st">&quot;L-BFGS-B&quot;</span>, </span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>         Options <span class="sc">%in%</span> finalist_options) <span class="sc">%&gt;%</span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>preval <span class="sc">%&gt;%</span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>  <span class="fu">separate</span>(Options, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>,</span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;Options&quot;</span>, <span class="st">&quot;Error_Model&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> avg_FoldErr,</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>             <span class="at">color =</span> Options)) <span class="sc">+</span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">bins =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(Error_Model))</span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>preval <span class="sc">%&gt;%</span> </span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>  <span class="fu">separate</span>(Options, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>,</span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;Options&quot;</span>, <span class="st">&quot;Error_Model&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a>  <span class="fu">group_by</span>(Options, Error_Model) <span class="sc">%&gt;%</span></span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">totalFoldError =</span> <span class="fu">sum</span>(avg_FoldErr))</span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a>readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="fu">paste</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a>                                  <span class="st">&quot;DataSummary_9_21_2023.xlsx&quot;</span>,</span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a>                                  <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a>                            <span class="at">sheet =</span> <span class="st">&quot;Fit_Counts&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a>  <span class="fu">filter</span>(Options <span class="sc">%in%</span> finalist_options, method <span class="sc">%in%</span> <span class="st">&quot;L-BFGS-B&quot;</span>)</span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a>readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="fu">paste</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a>                                  <span class="st">&quot;DataSummary_9_21_2023.xlsx&quot;</span>,</span>
<span id="cb8-44"><a href="#cb8-44" tabindex="-1"></a>                                  <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb8-45"><a href="#cb8-45" tabindex="-1"></a>                            <span class="at">sheet =</span> <span class="st">&quot;Cmax and AUC_inf Evaluation&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-46"><a href="#cb8-46" tabindex="-1"></a>  <span class="fu">filter</span>(Options <span class="sc">%in%</span> finalist_options, method <span class="sc">%in%</span> <span class="st">&quot;L-BFGS-B&quot;</span>)</span>
<span id="cb8-47"><a href="#cb8-47" tabindex="-1"></a></span>
<span id="cb8-48"><a href="#cb8-48" tabindex="-1"></a></span>
<span id="cb8-49"><a href="#cb8-49" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb8-50"><a href="#cb8-50" tabindex="-1"></a></span>
<span id="cb8-51"><a href="#cb8-51" tabindex="-1"></a>filtered_preval <span class="ot">&lt;-</span> preval <span class="sc">%&gt;%</span></span>
<span id="cb8-52"><a href="#cb8-52" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">if_all</span>(<span class="fu">where</span>(is.numeric), is.finite))</span>
<span id="cb8-53"><a href="#cb8-53" tabindex="-1"></a></span>
<span id="cb8-54"><a href="#cb8-54" tabindex="-1"></a>filtered_preval <span class="sc">%&gt;%</span></span>
<span id="cb8-55"><a href="#cb8-55" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Chemical, Species, model, method, Options, Rsq) <span class="sc">%&gt;%</span></span>
<span id="cb8-56"><a href="#cb8-56" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_scaled =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(Options,</span>
<span id="cb8-57"><a href="#cb8-57" tabindex="-1"></a>                                         <span class="at">pattern =</span> <span class="st">&quot;^</span><span class="sc">\\</span><span class="st">d</span><span class="sc">\\</span><span class="st">d1&quot;</span>),</span>
<span id="cb8-58"><a href="#cb8-58" tabindex="-1"></a>                              <span class="st">&quot;Time_Scaled&quot;</span>,</span>
<span id="cb8-59"><a href="#cb8-59" tabindex="-1"></a>                              <span class="st">&quot;notTime_Scaled&quot;</span>),</span>
<span id="cb8-60"><a href="#cb8-60" tabindex="-1"></a>         <span class="at">Options =</span> <span class="fu">str_remove</span>(Options, <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d(?=[:blank:])&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-61"><a href="#cb8-61" tabindex="-1"></a>  <span class="co"># dplyr::select(-Options) %&gt;%</span></span>
<span id="cb8-62"><a href="#cb8-62" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> time_scaled, <span class="at">values_from =</span> Rsq) <span class="sc">%&gt;%</span> </span>
<span id="cb8-63"><a href="#cb8-63" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">differ =</span> Time_Scaled <span class="sc">-</span> notTime_Scaled) <span class="sc">%&gt;%</span></span>
<span id="cb8-64"><a href="#cb8-64" tabindex="-1"></a>  <span class="fu">View</span>()</span>
<span id="cb8-65"><a href="#cb8-65" tabindex="-1"></a></span>
<span id="cb8-66"><a href="#cb8-66" tabindex="-1"></a></span>
<span id="cb8-67"><a href="#cb8-67" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(within_2fold <span class="sc">~</span> avg_FoldErr, <span class="at">data =</span> filtered_preval)</span>
<span id="cb8-68"><a href="#cb8-68" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb8-69"><a href="#cb8-69" tabindex="-1"></a><span class="fu">tidy</span>(fit)</span>
<span id="cb8-70"><a href="#cb8-70" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">augment</span>(fit))</span>
<span id="cb8-71"><a href="#cb8-71" tabindex="-1"></a><span class="fu">glance</span>(fit)</span>
<span id="cb8-72"><a href="#cb8-72" tabindex="-1"></a></span>
<span id="cb8-73"><a href="#cb8-73" tabindex="-1"></a>filtered_preval <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Options) <span class="sc">%&gt;%</span></span>
<span id="cb8-74"><a href="#cb8-74" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-75"><a href="#cb8-75" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">map</span>(data, \(x) {</span>
<span id="cb8-76"><a href="#cb8-76" tabindex="-1"></a>    <span class="fu">lm</span>(within_2fold <span class="sc">~</span> avg_FoldErr, <span class="at">data =</span> x)</span>
<span id="cb8-77"><a href="#cb8-77" tabindex="-1"></a>    }),</span>
<span id="cb8-78"><a href="#cb8-78" tabindex="-1"></a>    <span class="at">tidy_fit =</span> <span class="fu">map</span>(fit, tidy)) <span class="sc">%&gt;%</span></span>
<span id="cb8-79"><a href="#cb8-79" tabindex="-1"></a>  <span class="fu">unnest</span>(tidy_fit) <span class="sc">%&gt;%</span></span>
<span id="cb8-80"><a href="#cb8-80" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Options, term, estimate, std.error, statistic) <span class="sc">%&gt;%</span></span>
<span id="cb8-81"><a href="#cb8-81" tabindex="-1"></a>  <span class="fu">View</span>()</span>
<span id="cb8-82"><a href="#cb8-82" tabindex="-1"></a></span>
<span id="cb8-83"><a href="#cb8-83" tabindex="-1"></a></span>
<span id="cb8-84"><a href="#cb8-84" tabindex="-1"></a>Cmax_AUC <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="fu">paste</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;OD_DIR&quot;</span>),</span>
<span id="cb8-85"><a href="#cb8-85" tabindex="-1"></a>                                  <span class="st">&quot;DataSummary_8_18_2023.xlsx&quot;</span>,</span>
<span id="cb8-86"><a href="#cb8-86" tabindex="-1"></a>                                  <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb8-87"><a href="#cb8-87" tabindex="-1"></a>                            <span class="at">sheet =</span> <span class="st">&quot;Cmax and AUC_inf Evaluation&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-88"><a href="#cb8-88" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-89"><a href="#cb8-89" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb8-90"><a href="#cb8-90" tabindex="-1"></a></span>
<span id="cb8-91"><a href="#cb8-91" tabindex="-1"></a></span>
<span id="cb8-92"><a href="#cb8-92" tabindex="-1"></a>Cmax_AUC <span class="sc">%&gt;%</span></span>
<span id="cb8-93"><a href="#cb8-93" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DFO =</span> <span class="fu">rank</span>(<span class="fu">sqrt</span>(RMSE_Cmax<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">signif</span>(RMSE_AUC, <span class="dv">5</span>)<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb8-94"><a href="#cb8-94" tabindex="-1"></a>         <span class="at">OLS =</span> <span class="fu">rank</span>(<span class="fu">abs</span>(RMSE_Cmax <span class="sc">+</span> <span class="fu">signif</span>(RMSE_AUC, <span class="dv">5</span>))<span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb8-95"><a href="#cb8-95" tabindex="-1"></a>  <span class="co">#filter(DFO &lt; 11 | OLS &lt; 11) %&gt;%</span></span>
<span id="cb8-96"><a href="#cb8-96" tabindex="-1"></a>  <span class="fu">arrange</span>(DFO, OLS) <span class="sc">%&gt;%</span></span>
<span id="cb8-97"><a href="#cb8-97" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>RMSE_Cmax, <span class="sc">-</span>RMSE_AUC) <span class="sc">%&gt;%</span> <span class="fu">View</span>()</span>
<span id="cb8-98"><a href="#cb8-98" tabindex="-1"></a>  clipr<span class="sc">::</span><span class="fu">write_clip</span>()</span>
<span id="cb8-99"><a href="#cb8-99" tabindex="-1"></a></span>
<span id="cb8-100"><a href="#cb8-100" tabindex="-1"></a></span>
<span id="cb8-101"><a href="#cb8-101" tabindex="-1"></a>Cmax_AUC <span class="sc">%&gt;%</span></span>
<span id="cb8-102"><a href="#cb8-102" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DFO =</span> <span class="fu">rank</span>(<span class="fu">sqrt</span>(RMSE_Cmax<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> RMSE_AUC<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb8-103"><a href="#cb8-103" tabindex="-1"></a>         <span class="at">OLS =</span> <span class="fu">rank</span>(<span class="fu">abs</span>(RMSE_Cmax <span class="sc">+</span> RMSE_AUC)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb8-104"><a href="#cb8-104" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb8-105"><a href="#cb8-105" tabindex="-1"></a>    <span class="at">x =</span> DFO,</span>
<span id="cb8-106"><a href="#cb8-106" tabindex="-1"></a>    <span class="at">y =</span> OLS,</span>
<span id="cb8-107"><a href="#cb8-107" tabindex="-1"></a>    <span class="at">fill =</span> Options</span>
<span id="cb8-108"><a href="#cb8-108" tabindex="-1"></a>  )) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>)</span></code></pre></div>
</div>
<div id="running-dose-normalized-joint-fits" class="section level2">
<h2>Running dose-normalized joint fits</h2>
<p>Dose-normalization and a hierarchical model were the options that
produced the least amount of error in predictions and derived TK stats.
In addition, <em>L-BFGS-B</em> was the optimizer of choice due to some
marginally better fits (I will note that the run-time for
<em>L-BFGS-B</em> is significantly faster).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>my_pk <span class="ot">&lt;-</span> minimal_pk <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>)) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">TRUE</span>, <span class="at">log10_trans =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species, Reference)) </span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>my_pk <span class="ot">&lt;-</span> <span class="fu">do_preprocess</span>(my_pk)</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>cvt_DTXSIDs <span class="ot">&lt;-</span> <span class="fu">unique</span>(my_pk<span class="sc">$</span>data<span class="sc">$</span>Chemical)</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>my_pk <span class="ot">&lt;-</span> <span class="fu">do_data_info</span>(my_pk)</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>my_pk <span class="ot">&lt;-</span> <span class="fu">do_prefit</span>(my_pk) <span class="co"># needs reframe somewhere</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>{</span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>  start <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>  my_pk <span class="ot">&lt;-</span> <span class="fu">do_fit</span>(my_pk, </span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a>                  <span class="at">n_cores =</span> <span class="dv">12</span>)</span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>  <span class="fu">round</span>(<span class="fu">Sys.time</span>() <span class="sc">-</span> start, <span class="dv">4</span>)</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="analysis-plots" class="section level2">
<h2>Analysis Plots</h2>
<p>Next I will generate the figures for the paper.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Need the following data for any of the subsequent plots</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co"># after fitting pk object for all cvt objects or reading the fitted pk object in `setup`</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>winmodel <span class="ot">&lt;-</span> <span class="fu">get_winning_model</span>(my_pk)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>my_preds <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(<span class="fu">predict</span>(my_pk, <span class="at">use_scale_conc =</span> <span class="cn">TRUE</span>), winmodel)</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>my_residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(my_pk, <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  <span class="fu">inner_join</span>(winmodel)</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>my_tkstats <span class="ot">&lt;-</span> <span class="fu">eval_tkstats</span>(my_pk)</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>my_nca <span class="ot">&lt;-</span> <span class="fu">get_nca</span>(my_pk)</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>all_my_data <span class="ot">&lt;-</span> <span class="fu">get_data</span>(my_pk)</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>fe_df <span class="ot">&lt;-</span> <span class="fu">fold_errors</span>(my_pk, <span class="at">method =</span> <span class="st">&quot;L-BFGS-B&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(winmodel)</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co"># May need to change the use_scale_conc defaults</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>r2_df <span class="ot">&lt;-</span> <span class="fu">rsq</span>(my_pk, <span class="at">method =</span> <span class="st">&quot;L-BFGS-B&quot;</span>, <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>  <span class="fu">inner_join</span>(winmodel)</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>myAIC <span class="ot">&lt;-</span> <span class="fu">AIC</span>(my_pk, <span class="at">method =</span> <span class="st">&quot;L-BFGS-B&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>  <span class="fu">inner_join</span>(winmodel)</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>myRMSE <span class="ot">&lt;-</span> <span class="fu">rmse</span>(my_pk, <span class="at">method =</span> <span class="st">&quot;L-BFGS-B&quot;</span>,</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>               <span class="at">rmse_group =</span> <span class="fu">vars</span>(Route, Media, Dose),</span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>               <span class="at">use_scale_conc =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>  <span class="fu">inner_join</span>(winmodel)</span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a><span class="co"># Something wrong with the summary method... maybe only use detects?</span></span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a>fold_errors_all <span class="ot">&lt;-</span> fe_df <span class="sc">%&gt;%</span></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Detect <span class="sc">%in%</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(<span class="sc">!!!</span>my_pk<span class="sc">$</span>data_group, model, method) <span class="sc">%&gt;%</span></span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">avg_FoldErr =</span> <span class="fu">mean</span>(Fold_Error, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a>                <span class="at">median_FoldErr =</span> <span class="fu">median</span>(Fold_Error, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a>                <span class="at">within_2fold =</span> <span class="fu">sum</span>(Fold_Error <span class="sc">&gt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> Fold_Error <span class="sc">&lt;=</span> <span class="dv">2</span>)<span class="sc">/</span><span class="fu">length</span>(Fold_Error))</span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a>myRMSE_all <span class="ot">&lt;-</span> myRMSE <span class="sc">%&gt;%</span></span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(<span class="sc">!!!</span>my_pk<span class="sc">$</span>data_group, model, method) <span class="sc">%&gt;%</span></span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">avg_MSE =</span> <span class="fu">mean</span>(RMSE<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a>                <span class="at">median_MSE =</span> <span class="fu">median</span>(RMSE<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a></span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a>my_coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(my_pk) <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(winmodel) <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(myAIC)</span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a>my_coefs <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>sigma_value, <span class="sc">-</span>error_group, <span class="sc">-</span>coefs_vector) <span class="sc">%&gt;%</span></span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a>  <span class="fu">inner_join</span>(other_coefs <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(model, method, Chemical, Species)) <span class="ot">-&gt;</span></span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a>  my_coefs</span></code></pre></div>
<div id="figure-4a-replicated-timepoint-variation-in-cvtdb" class="section level3">
<h3>Figure 4A: Replicated timepoint variation in CvTdb</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>all_my_data <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="fu">filter</span>(Detect <span class="sc">%in%</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>         exclude <span class="sc">%in%</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>         Dose <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical,</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>           Species,</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>           Reference,</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>           Route, </span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>           Media,</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>           Dose, Time) <span class="sc">%&gt;%</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>,</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>         <span class="fu">sum</span>(<span class="fu">is.na</span>(Conc)) <span class="sc">!=</span> <span class="fu">n</span>(),</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>         Conc <span class="sc">&gt;</span> LOQ) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">meanConc =</span> <span class="fu">mean</span>(Conc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">foldConc =</span> Conc <span class="sc">/</span> meanConc) <span class="sc">%&gt;%</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>  <span class="fu">filter</span>(Route <span class="sc">==</span> <span class="st">&quot;iv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>  <span class="fu">count</span>(foldConc <span class="sc">&lt;</span> <span class="fl">0.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a>  {.[[<span class="dv">2</span>,<span class="dv">2</span>]]<span class="sc">/</span>(.[[<span class="dv">1</span>,<span class="dv">2</span>]] <span class="sc">+</span> .[[<span class="dv">2</span>,<span class="dv">2</span>]])}</span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a><span class="co"># Stats for ALL | ORAL | IV</span></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a><span class="co"># 88.64% inside twofold | 87.20%  | 91.23%</span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a><span class="co"># 2.23%  above twofold  | 2.52%   | 1.70%</span></span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a><span class="co"># 9.11%  below twofold  | 10.25%  | 7.04%</span></span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a>pl5A <span class="ot">&lt;-</span> all_my_data <span class="sc">%&gt;%</span></span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a>  <span class="fu">filter</span>(Detect <span class="sc">%in%</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a>         exclude <span class="sc">%in%</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a>         Dose <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical,</span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a>           Species,</span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a>           Reference,</span>
<span id="cb11-34"><a href="#cb11-34" tabindex="-1"></a>           Route, </span>
<span id="cb11-35"><a href="#cb11-35" tabindex="-1"></a>           Media,</span>
<span id="cb11-36"><a href="#cb11-36" tabindex="-1"></a>           Dose, Time) <span class="sc">%&gt;%</span></span>
<span id="cb11-37"><a href="#cb11-37" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>,</span>
<span id="cb11-38"><a href="#cb11-38" tabindex="-1"></a>         <span class="fu">sum</span>(<span class="fu">is.na</span>(Conc)) <span class="sc">!=</span> <span class="fu">n</span>(),</span>
<span id="cb11-39"><a href="#cb11-39" tabindex="-1"></a>         LOQ <span class="sc">&lt;</span> Conc) <span class="sc">%&gt;%</span></span>
<span id="cb11-40"><a href="#cb11-40" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">meanConc =</span> <span class="fu">mean</span>(Conc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-41"><a href="#cb11-41" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-42"><a href="#cb11-42" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-43"><a href="#cb11-43" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">foldConc =</span> Conc <span class="sc">/</span> meanConc) <span class="sc">%&gt;%</span></span>
<span id="cb11-44"><a href="#cb11-44" tabindex="-1"></a>  <span class="co"># Plotting</span></span>
<span id="cb11-45"><a href="#cb11-45" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> foldConc)) <span class="sc">+</span></span>
<span id="cb11-46"><a href="#cb11-46" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.2</span>,</span>
<span id="cb11-47"><a href="#cb11-47" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">&quot;grey5&quot;</span>,</span>
<span id="cb11-48"><a href="#cb11-48" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;grey5&quot;</span>,</span>
<span id="cb11-49"><a href="#cb11-49" tabindex="-1"></a>                 <span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb11-50"><a href="#cb11-50" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>),</span>
<span id="cb11-51"><a href="#cb11-51" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4000</span>)) <span class="sc">+</span></span>
<span id="cb11-52"><a href="#cb11-52" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb11-53"><a href="#cb11-53" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>, <span class="dv">2000</span>, <span class="dv">3000</span>),</span>
<span id="cb11-54"><a href="#cb11-54" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb11-55"><a href="#cb11-55" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb11-56"><a href="#cb11-56" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>), <span class="at">color =</span> <span class="st">&quot;red3&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb11-57"><a href="#cb11-57" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb11-58"><a href="#cb11-58" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Mean-normalized</span><span class="sc">\n</span><span class="st">concentration&quot;</span>,</span>
<span id="cb11-59"><a href="#cb11-59" tabindex="-1"></a>                <span class="at">y =</span> <span class="st">&quot;Observations</span><span class="sc">\n</span><span class="st">(thousands)&quot;</span>) <span class="sc">+</span></span>
<span id="cb11-60"><a href="#cb11-60" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb11-61"><a href="#cb11-61" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb11-62"><a href="#cb11-62" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-63"><a href="#cb11-63" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>),</span>
<span id="cb11-64"><a href="#cb11-64" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb11-65"><a href="#cb11-65" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-66"><a href="#cb11-66" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-67"><a href="#cb11-67" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb11-68"><a href="#cb11-68" tabindex="-1"></a></span>
<span id="cb11-69"><a href="#cb11-69" tabindex="-1"></a>pl5A</span>
<span id="cb11-70"><a href="#cb11-70" tabindex="-1"></a></span>
<span id="cb11-71"><a href="#cb11-71" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb11-72"><a href="#cb11-72" tabindex="-1"></a>              <span class="st">&quot;NormalizedConcentrations_2023-09-29.png&quot;</span>),</span>
<span id="cb11-73"><a href="#cb11-73" tabindex="-1"></a>       <span class="at">plot =</span> pl5A,</span>
<span id="cb11-74"><a href="#cb11-74" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">2.2</span>,</span>
<span id="cb11-75"><a href="#cb11-75" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">2.5</span>,</span>
<span id="cb11-76"><a href="#cb11-76" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb11-77"><a href="#cb11-77" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb11-78"><a href="#cb11-78" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb11-79"><a href="#cb11-79" tabindex="-1"></a></span>
<span id="cb11-80"><a href="#cb11-80" tabindex="-1"></a></span>
<span id="cb11-81"><a href="#cb11-81" tabindex="-1"></a>all_my_data <span class="sc">%&gt;%</span></span>
<span id="cb11-82"><a href="#cb11-82" tabindex="-1"></a>  <span class="fu">filter</span>(Detect <span class="sc">%in%</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-83"><a href="#cb11-83" tabindex="-1"></a>         exclude <span class="sc">%in%</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-84"><a href="#cb11-84" tabindex="-1"></a>         Dose <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-85"><a href="#cb11-85" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical,</span>
<span id="cb11-86"><a href="#cb11-86" tabindex="-1"></a>           Species,</span>
<span id="cb11-87"><a href="#cb11-87" tabindex="-1"></a>           Reference,</span>
<span id="cb11-88"><a href="#cb11-88" tabindex="-1"></a>           Route, </span>
<span id="cb11-89"><a href="#cb11-89" tabindex="-1"></a>           Media,</span>
<span id="cb11-90"><a href="#cb11-90" tabindex="-1"></a>           Dose, Time) <span class="sc">%&gt;%</span></span>
<span id="cb11-91"><a href="#cb11-91" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-92"><a href="#cb11-92" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Replicated =</span> <span class="fu">ifelse</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-93"><a href="#cb11-93" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> .<span class="sc">$</span>Replicated <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span>
<span id="cb11-94"><a href="#cb11-94" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Replicated)) <span class="sc">+</span></span>
<span id="cb11-95"><a href="#cb11-95" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;stack&quot;</span>,</span>
<span id="cb11-96"><a href="#cb11-96" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb11-97"><a href="#cb11-97" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Timepoints&quot;</span>) <span class="sc">+</span></span>
<span id="cb11-98"><a href="#cb11-98" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;white&quot;</span>)) <span class="sc">+</span></span>
<span id="cb11-99"><a href="#cb11-99" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb11-100"><a href="#cb11-100" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb11-101"><a href="#cb11-101" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
</div>
<div id="figure-4a-2-alternate-version-of-figure-4a" class="section level3">
<h3>Figure 4A-2: Alternate version of Figure 4A</h3>
<p>This alternate version of Figure 4A aims to simplify the assessment
of replication of datasets in invivoPKfit. In contrast to the original
4A, this will also result in the inclusion of datasets with recorded
standard deviation values (i.e. non-indivudual animal data/summarized
data).</p>
<p>The way this will work is by calculating the average and standard
deviations of individual animal data (eliminating individual animal data
that does not have replicates) then testing the following:</p>
<p><span class="math display">\[
\frac{\mu + 2\sigma}{\mu} \leq 2
\]</span></p>
<p>Which essentially tests whether, at least 95% of data is within a
factor of 2. The result is a bar chart that shows how many timepoints
with replicate values passed this test. It minimizes the double (or
more) counting of timepoints with multiple replicates from individual
animal data.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>iad_summary <span class="ot">&lt;-</span> cvt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(conc <span class="sc">&gt;</span> <span class="dv">0</span>, n_subjects_in_series <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="fu">group_by</span>(analyte_dtxsid, species, administration_route_normalized,</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>           conc_medium_normalized, dose_level_corrected, document_id,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>           time_hr) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">conc_sd_calc =</span> <span class="fu">sd</span>(conc),</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>            <span class="at">conc_avg_calc =</span> <span class="fu">mean</span>(conc),</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>            <span class="at">n_subjects_in_series =</span> <span class="fu">n</span>())</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>sud_summary <span class="ot">&lt;-</span> cvt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(conc <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>                              n_subjects_in_series <span class="sc">&gt;</span> <span class="dv">1</span>,</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>                              <span class="sc">!</span><span class="fu">is.na</span>(conc_sd_normalized)) <span class="sc">%&gt;%</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">conc_sd_calc =</span> conc_sd_normalized,</span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>         <span class="at">conc_avg_calc =</span> conc) <span class="sc">%&gt;%</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>  <span class="fu">distinct</span>(analyte_dtxsid, species, administration_route_normalized,</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a>           conc_medium_normalized, dose_level_corrected, document_id,</span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>           time_hr, conc_sd_calc, conc_avg_calc, n_subjects_in_series)</span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a>combined_summary <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(sud_summary, iad_summary) <span class="sc">%&gt;%</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">twofold_95 =</span> <span class="fu">ifelse</span>((conc_avg_calc <span class="sc">+</span> (<span class="dv">2</span><span class="sc">*</span>conc_sd_calc))<span class="sc">/</span>conc_avg_calc <span class="sc">&lt;</span> <span class="dv">2</span>,</span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a>                             <span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a><span class="co"># With the mapped column names</span></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a>iad_summary <span class="ot">&lt;-</span> all_my_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Conc <span class="sc">&gt;</span> <span class="dv">0</span>, N_Subjects <span class="sc">==</span> <span class="dv">1</span>, Dose <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical, Species, Route, Media, Dose, Reference, Time) <span class="sc">%&gt;%</span></span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">conc_sd_calc =</span> <span class="fu">sd</span>(Conc),</span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a>            <span class="at">conc_avg_calc =</span> <span class="fu">mean</span>(Conc),</span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a>            <span class="at">n_subjects_in_series =</span> <span class="fu">n</span>())</span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" tabindex="-1"></a>sud_summary <span class="ot">&lt;-</span> all_my_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Conc <span class="sc">&gt;</span> <span class="dv">0</span>, N_Subjects <span class="sc">&gt;</span> <span class="dv">1</span>,</span>
<span id="cb12-34"><a href="#cb12-34" tabindex="-1"></a>                                      <span class="sc">!</span><span class="fu">is.na</span>(Conc_SD), Dose <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-35"><a href="#cb12-35" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">conc_sd_calc =</span> Conc_SD,</span>
<span id="cb12-36"><a href="#cb12-36" tabindex="-1"></a>         <span class="at">conc_avg_calc =</span> Conc,</span>
<span id="cb12-37"><a href="#cb12-37" tabindex="-1"></a>         <span class="at">n_subjects_in_series =</span> N_Subjects) <span class="sc">%&gt;%</span></span>
<span id="cb12-38"><a href="#cb12-38" tabindex="-1"></a>  <span class="fu">distinct</span>(Chemical, Species, Route, Media, Dose, Reference, Time,</span>
<span id="cb12-39"><a href="#cb12-39" tabindex="-1"></a>           conc_sd_calc, conc_avg_calc, n_subjects_in_series)</span>
<span id="cb12-40"><a href="#cb12-40" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" tabindex="-1"></a>combined_summary <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(sud_summary, iad_summary) <span class="sc">%&gt;%</span></span>
<span id="cb12-42"><a href="#cb12-42" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-43"><a href="#cb12-43" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">twofold_95 =</span> <span class="fu">ifelse</span>((conc_avg_calc <span class="sc">+</span> (<span class="dv">2</span><span class="sc">*</span>conc_sd_calc))<span class="sc">/</span>conc_avg_calc <span class="sc">&lt;</span> <span class="dv">2</span>,</span>
<span id="cb12-44"><a href="#cb12-44" tabindex="-1"></a>                             <span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span>
<span id="cb12-45"><a href="#cb12-45" tabindex="-1"></a></span>
<span id="cb12-46"><a href="#cb12-46" tabindex="-1"></a><span class="fu">table</span>(combined_summary<span class="sc">$</span>twofold_95)</span>
<span id="cb12-47"><a href="#cb12-47" tabindex="-1"></a></span>
<span id="cb12-48"><a href="#cb12-48" tabindex="-1"></a>pl5A <span class="ot">&lt;-</span> combined_summary <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-49"><a href="#cb12-49" tabindex="-1"></a>  <span class="fu">count</span>(twofold_95) <span class="sc">%&gt;%</span></span>
<span id="cb12-50"><a href="#cb12-50" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> twofold_95, <span class="at">fill =</span> twofold_95, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb12-51"><a href="#cb12-51" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_stack</span>(),</span>
<span id="cb12-52"><a href="#cb12-52" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb12-53"><a href="#cb12-53" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4000</span>)) <span class="sc">+</span></span>
<span id="cb12-54"><a href="#cb12-54" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb12-55"><a href="#cb12-55" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>, <span class="dv">2000</span>, <span class="dv">3000</span>),</span>
<span id="cb12-56"><a href="#cb12-56" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb12-57"><a href="#cb12-57" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;white&quot;</span>)) <span class="sc">+</span></span>
<span id="cb12-58"><a href="#cb12-58" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb12-59"><a href="#cb12-59" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;95% of observations</span><span class="sc">\n</span><span class="st">within factor of 2&quot;</span>,</span>
<span id="cb12-60"><a href="#cb12-60" tabindex="-1"></a>                <span class="at">y =</span> <span class="st">&quot;Observations</span><span class="sc">\n</span><span class="st">(thousands)&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-61"><a href="#cb12-61" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb12-62"><a href="#cb12-62" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb12-63"><a href="#cb12-63" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-64"><a href="#cb12-64" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>),</span>
<span id="cb12-65"><a href="#cb12-65" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb12-66"><a href="#cb12-66" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-67"><a href="#cb12-67" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-68"><a href="#cb12-68" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-69"><a href="#cb12-69" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
</div>
<div id="figure-4b-variation-over-time-in-cvtdb-data" class="section level3">
<h3>Figure 4B: Variation over time in CvTdb data</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>pl5B <span class="ot">&lt;-</span> all_my_data <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical,</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>           Species,</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>           Reference,</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>           Route,</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>           Dose, Time) <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>,</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>         <span class="fu">sum</span>(<span class="fu">is.na</span>(Conc_trans)) <span class="sc">!=</span> <span class="fu">n</span>(),</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>         exclude <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">meanConc =</span> <span class="fu">mean</span>(Conc_trans, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">foldConc =</span> Conc_trans <span class="sc">/</span> meanConc) <span class="sc">%&gt;%</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>  <span class="fu">inner_join</span>(my_tkstats <span class="sc">%&gt;%</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(Chemical, Species,</span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>                            Route, Media,</span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>                            <span class="at">tmax =</span> tmax.nca) <span class="sc">%&gt;%</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>              <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(tmax))) <span class="sc">%&gt;%</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical,</span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>           Species,</span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a>           Reference,</span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a>           Route,</span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a>           Media,</span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a>           Dose) <span class="sc">%&gt;%</span></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a>         <span class="at">normTime =</span> <span class="fu">ifelse</span>(</span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a>           Route <span class="sc">==</span> <span class="st">&quot;iv&quot;</span>,</span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a>           <span class="dv">1</span> <span class="sc">+</span> Time<span class="sc">/</span><span class="fu">max</span>(Time),</span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a>           <span class="fu">ifelse</span>(</span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a>             Time <span class="sc">&gt;</span> tmax,</span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a>             ((Time <span class="sc">-</span> tmax)<span class="sc">/</span><span class="fu">max</span>(Time)) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a>             <span class="fl">0.5</span> <span class="sc">+</span> Time<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>tmax)</span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a>           )</span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a>         )) <span class="sc">%&gt;%</span></span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb13-37"><a href="#cb13-37" tabindex="-1"></a>    <span class="at">x =</span> normTime,</span>
<span id="cb13-38"><a href="#cb13-38" tabindex="-1"></a>    <span class="at">y =</span> foldConc</span>
<span id="cb13-39"><a href="#cb13-39" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb13-40"><a href="#cb13-40" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb13-41"><a href="#cb13-41" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb13-42"><a href="#cb13-42" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-43"><a href="#cb13-43" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;green4&quot;</span>,</span>
<span id="cb13-44"><a href="#cb13-44" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-45"><a href="#cb13-45" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>), <span class="at">color =</span> <span class="st">&quot;red3&quot;</span>,</span>
<span id="cb13-46"><a href="#cb13-46" tabindex="-1"></a>             <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-47"><a href="#cb13-47" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(Route),</span>
<span id="cb13-48"><a href="#cb13-48" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-49"><a href="#cb13-49" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;ADME-Normalized Time&quot;</span>,</span>
<span id="cb13-50"><a href="#cb13-50" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Mean-Normalized</span><span class="sc">\n</span><span class="st">Concentration&quot;</span>) <span class="sc">+</span></span>
<span id="cb13-51"><a href="#cb13-51" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb13-52"><a href="#cb13-52" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb13-53"><a href="#cb13-53" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-54"><a href="#cb13-54" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb13-55"><a href="#cb13-55" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb13-56"><a href="#cb13-56" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb13-57"><a href="#cb13-57" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-58"><a href="#cb13-58" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-59"><a href="#cb13-59" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-60"><a href="#cb13-60" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb13-61"><a href="#cb13-61" tabindex="-1"></a>        <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="fl">0.125</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>),</span>
<span id="cb13-62"><a href="#cb13-62" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-63"><a href="#cb13-63" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb13-64"><a href="#cb13-64" tabindex="-1"></a></span>
<span id="cb13-65"><a href="#cb13-65" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb13-66"><a href="#cb13-66" tabindex="-1"></a>              <span class="st">&quot;ADME_NormTime-NormConcs_onlyDetects_2023-09-29.png&quot;</span>),</span>
<span id="cb13-67"><a href="#cb13-67" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb13-68"><a href="#cb13-68" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">5</span>,</span>
<span id="cb13-69"><a href="#cb13-69" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb13-70"><a href="#cb13-70" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb13-71"><a href="#cb13-71" tabindex="-1"></a></span>
<span id="cb13-72"><a href="#cb13-72" tabindex="-1"></a></span>
<span id="cb13-73"><a href="#cb13-73" tabindex="-1"></a><span class="co"># Make the Combination Plot----</span></span>
<span id="cb13-74"><a href="#cb13-74" tabindex="-1"></a></span>
<span id="cb13-75"><a href="#cb13-75" tabindex="-1"></a><span class="fu">plot_grid</span>(pl5A, pl5B, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>),</span>
<span id="cb13-76"><a href="#cb13-76" tabindex="-1"></a>                     <span class="at">align =</span> <span class="st">&quot;h&quot;</span>, <span class="at">axis =</span> <span class="st">&quot;bt&quot;</span>, <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb13-77"><a href="#cb13-77" tabindex="-1"></a></span>
<span id="cb13-78"><a href="#cb13-78" tabindex="-1"></a></span>
<span id="cb13-79"><a href="#cb13-79" tabindex="-1"></a>figure5 <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(pl5A, pl5B, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>),</span>
<span id="cb13-80"><a href="#cb13-80" tabindex="-1"></a>                     <span class="at">align =</span> <span class="st">&quot;h&quot;</span>, <span class="at">axis =</span> <span class="st">&quot;bt&quot;</span>, <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.75</span>))</span>
<span id="cb13-81"><a href="#cb13-81" tabindex="-1"></a></span>
<span id="cb13-82"><a href="#cb13-82" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb13-83"><a href="#cb13-83" tabindex="-1"></a>              <span class="st">&quot;Figure5alt_onlyDetects_2023-10-02.png&quot;</span>),</span>
<span id="cb13-84"><a href="#cb13-84" tabindex="-1"></a>       <span class="at">plot =</span> figure5,</span>
<span id="cb13-85"><a href="#cb13-85" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb13-86"><a href="#cb13-86" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">3.25</span>,</span>
<span id="cb13-87"><a href="#cb13-87" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">6.5</span>,</span>
<span id="cb13-88"><a href="#cb13-88" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb13-89"><a href="#cb13-89" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span></code></pre></div>
</div>
<div id="supp.-figure-1-concentration-and-final-time-points-have-wide-range" class="section level3">
<h3>Supp. Figure 1: Concentration and final time-points have wide
range</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>data_range <span class="ot">&lt;-</span> all_my_data <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="fu">filter</span>(Detect) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical, Species, Reference, Media, Route, Dose, Dose.Units) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">maxT =</span> <span class="fu">max</span>(Time)<span class="sc">/</span><span class="dv">24</span>,</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>         <span class="at">concRange =</span> <span class="fu">log10</span>(<span class="fu">max</span>(Conc)<span class="sc">/</span><span class="fu">min</span>(Conc))) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>  </span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>  </span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>sf_2B <span class="ot">&lt;-</span> data_range <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> maxT)) <span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;grey5&quot;</span>,</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>                 <span class="at">bins =</span> <span class="dv">40</span>,</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;grey5&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>number,</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>                <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">30</span>, <span class="dv">365</span>)) <span class="sc">+</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>),</span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Day of final Timepoint&quot;</span>,</span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>())</span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a>              <span class="st">&quot;SFig2B_TimePoints_2023-10-02.png&quot;</span>),</span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb14-32"><a href="#cb14-32" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb14-33"><a href="#cb14-33" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb14-34"><a href="#cb14-34" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb14-35"><a href="#cb14-35" tabindex="-1"></a></span>
<span id="cb14-36"><a href="#cb14-36" tabindex="-1"></a></span>
<span id="cb14-37"><a href="#cb14-37" tabindex="-1"></a>sf_2A <span class="ot">&lt;-</span> data_range <span class="sc">%&gt;%</span></span>
<span id="cb14-38"><a href="#cb14-38" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> concRange)) <span class="sc">+</span></span>
<span id="cb14-39"><a href="#cb14-39" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;grey5&quot;</span>,</span>
<span id="cb14-40"><a href="#cb14-40" tabindex="-1"></a>                 <span class="at">bins =</span> <span class="dv">40</span>,</span>
<span id="cb14-41"><a href="#cb14-41" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;grey5&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-42"><a href="#cb14-42" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb14-43"><a href="#cb14-43" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">25</span>),</span>
<span id="cb14-44"><a href="#cb14-44" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb14-45"><a href="#cb14-45" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log10(Concentration Range)&quot;</span>,</span>
<span id="cb14-46"><a href="#cb14-46" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-47"><a href="#cb14-47" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb14-48"><a href="#cb14-48" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb14-49"><a href="#cb14-49" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-50"><a href="#cb14-50" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb14-51"><a href="#cb14-51" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb14-52"><a href="#cb14-52" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb14-53"><a href="#cb14-53" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-54"><a href="#cb14-54" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-55"><a href="#cb14-55" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb14-56"><a href="#cb14-56" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>))</span>
<span id="cb14-57"><a href="#cb14-57" tabindex="-1"></a>  </span>
<span id="cb14-58"><a href="#cb14-58" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb14-59"><a href="#cb14-59" tabindex="-1"></a>              <span class="st">&quot;SFig2A_ConcRange_2023-09-29.png&quot;</span>),</span>
<span id="cb14-60"><a href="#cb14-60" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb14-61"><a href="#cb14-61" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb14-62"><a href="#cb14-62" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb14-63"><a href="#cb14-63" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb14-64"><a href="#cb14-64" tabindex="-1"></a></span>
<span id="cb14-65"><a href="#cb14-65" tabindex="-1"></a></span>
<span id="cb14-66"><a href="#cb14-66" tabindex="-1"></a><span class="fu">plot_grid</span>(sf_2A, sf_2B, <span class="at">labels =</span> <span class="st">&quot;AUTO&quot;</span>, <span class="at">align =</span> <span class="st">&quot;h&quot;</span>, <span class="at">axis =</span> <span class="st">&quot;bt&quot;</span>)</span>
<span id="cb14-67"><a href="#cb14-67" tabindex="-1"></a></span>
<span id="cb14-68"><a href="#cb14-68" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb14-69"><a href="#cb14-69" tabindex="-1"></a>              <span class="st">&quot;SFig2_ConcTimeRanges_2023-10-02.png&quot;</span>),</span>
<span id="cb14-70"><a href="#cb14-70" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">3.25</span>,</span>
<span id="cb14-71"><a href="#cb14-71" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb14-72"><a href="#cb14-72" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb14-73"><a href="#cb14-73" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span></code></pre></div>
</div>
<div id="supp-figure-2-invivopkfit-model-performance" class="section level3">
<h3>Supp Figure 2: invivoPKfit model performance</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>my_preds <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  <span class="fu">right_join</span>(winmodel) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Pred_Obs =</span> Conc_trans<span class="sc">/</span>Conc_est) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.finite</span>(Pred_Obs),</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>         model <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;model_1comp&quot;</span>, <span class="st">&quot;model_2comp&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>  <span class="co"># mutate(pass = ifelse(Pred_Obs &lt; 0.5, TRUE, FALSE)) %&gt;%</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>  <span class="co"># pull(pass) %&gt;% table()</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Pred_Obs)) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.5</span>,</span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">&quot;grey5&quot;</span>) <span class="sc">+</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fl">1E6</span>)) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>), <span class="at">color =</span> <span class="st">&quot;red3&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(model),</span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a>             <span class="at">rows =</span> <span class="fu">vars</span>(Route)) <span class="sc">+</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Dose-normalized</span><span class="sc">\n</span><span class="st">Predicted/Observed&quot;</span>,</span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of Observations&quot;</span>) <span class="sc">+</span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>))</span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a><span class="co"># 91.1% of Pred_Obs are finite</span></span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a><span class="co"># 16.6% Are below two-fold</span></span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a><span class="co"># 33.2%  Are above two-fold</span></span>
<span id="cb15-27"><a href="#cb15-27" tabindex="-1"></a><span class="co"># 50.2% Are within twofold</span></span>
<span id="cb15-28"><a href="#cb15-28" tabindex="-1"></a></span>
<span id="cb15-29"><a href="#cb15-29" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb15-30"><a href="#cb15-30" tabindex="-1"></a>              <span class="st">&quot;PredictedObserved_compartmentModels_2023-11-30.png&quot;</span>),</span>
<span id="cb15-31"><a href="#cb15-31" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">6</span>)</span>
<span id="cb15-32"><a href="#cb15-32" tabindex="-1"></a>  </span></code></pre></div>
</div>
<div id="figure-5-model-performance-vs-data-variability" class="section level3">
<h3>Figure 5: Model performance vs Data Variability</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>pl_7A <span class="ot">&lt;-</span> my_preds <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical,</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>           Species,</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>           Route, Media,</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>           Dose, Time) <span class="sc">%&gt;%</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>,</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>         <span class="fu">sum</span>(<span class="fu">is.na</span>(Conc_trans)) <span class="sc">!=</span> <span class="fu">n</span>(),</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>         <span class="co"># model %in% c(&quot;model_flat&quot;),</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>         exclude <span class="sc">%in%</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>         Detect <span class="sc">%in%</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">meanConc =</span> <span class="fu">mean</span>(Conc_trans, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">foldConc =</span> Conc_trans <span class="sc">/</span> meanConc,</span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>         <span class="at">foldPred =</span> Conc_est <span class="sc">/</span> Conc_trans) <span class="sc">%&gt;%</span></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>  <span class="co"># For percentages</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>  <span class="co"># ungroup() %&gt;%</span></span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a>  <span class="co"># filter(model %in% c(&quot;model_flat&quot;)) %&gt;%</span></span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a>  <span class="co"># count((foldPred &gt;= 0.5 &amp; foldPred &lt;= 2) &amp; !(foldConc &gt;= 0.5 &amp; foldConc &lt;= 2)) %&gt;%</span></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a>  <span class="co"># {100*.[[2,2]]/(.[[1,2]] + .[[2,2]])}</span></span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a>  <span class="co"># For Plotting</span></span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a>    <span class="at">y =</span> foldPred,</span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a>    <span class="at">x =</span> foldConc</span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a>  <span class="fu">geom_bin2d</span>(<span class="at">bins =</span> <span class="dv">40</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb16-29"><a href="#cb16-29" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-30"><a href="#cb16-30" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-31"><a href="#cb16-31" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(model)) <span class="sc">+</span></span>
<span id="cb16-32"><a href="#cb16-32" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_math</span>(<span class="at">format =</span> log10),</span>
<span id="cb16-33"><a href="#cb16-33" tabindex="-1"></a>                <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb16-34"><a href="#cb16-34" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_math</span>(<span class="at">format =</span> log10),</span>
<span id="cb16-35"><a href="#cb16-35" tabindex="-1"></a>                <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="dv">1000</span>)) <span class="sc">+</span></span>
<span id="cb16-36"><a href="#cb16-36" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;cividis&quot;</span>,</span>
<span id="cb16-37"><a href="#cb16-37" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">100</span>),</span>
<span id="cb16-38"><a href="#cb16-38" tabindex="-1"></a>                       <span class="at">oob =</span> scales<span class="sc">::</span>oob_squish) <span class="sc">+</span></span>
<span id="cb16-39"><a href="#cb16-39" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Model Error&quot;</span>,</span>
<span id="cb16-40"><a href="#cb16-40" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Data Variability&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-41"><a href="#cb16-41" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb16-42"><a href="#cb16-42" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="fl">1.5</span>),</span>
<span id="cb16-43"><a href="#cb16-43" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-44"><a href="#cb16-44" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb16-45"><a href="#cb16-45" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb16-46"><a href="#cb16-46" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb16-47"><a href="#cb16-47" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-48"><a href="#cb16-48" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>())</span>
<span id="cb16-49"><a href="#cb16-49" tabindex="-1"></a></span>
<span id="cb16-50"><a href="#cb16-50" tabindex="-1"></a>pl_7A</span>
<span id="cb16-51"><a href="#cb16-51" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb16-52"><a href="#cb16-52" tabindex="-1"></a>              <span class="st">&quot;ModelPerformance_vDataVariability_2023-10-19.png&quot;</span>),</span>
<span id="cb16-53"><a href="#cb16-53" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>,</span>
<span id="cb16-54"><a href="#cb16-54" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">6.5</span>,</span>
<span id="cb16-55"><a href="#cb16-55" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb16-56"><a href="#cb16-56" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>,</span>
<span id="cb16-57"><a href="#cb16-57" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)  </span>
<span id="cb16-58"><a href="#cb16-58" tabindex="-1"></a>  </span>
<span id="cb16-59"><a href="#cb16-59" tabindex="-1"></a>my_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-60"><a href="#cb16-60" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;Both within a factor of 2&quot;</span>,</span>
<span id="cb16-61"><a href="#cb16-61" tabindex="-1"></a>    <span class="st">&quot;Model too variable&quot;</span>,</span>
<span id="cb16-62"><a href="#cb16-62" tabindex="-1"></a>    <span class="st">&quot;Data too variable&quot;</span>,</span>
<span id="cb16-63"><a href="#cb16-63" tabindex="-1"></a>    <span class="st">&quot;Both outside a factor of 2&quot;</span>),</span>
<span id="cb16-64"><a href="#cb16-64" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">46.3</span>, <span class="fl">39.5</span>, <span class="fl">2.3</span>, <span class="dv">12</span>),</span>
<span id="cb16-65"><a href="#cb16-65" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">46</span>, <span class="dv">44</span>, <span class="fl">1.8</span>, <span class="fl">7.4</span>),</span>
<span id="cb16-66"><a href="#cb16-66" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">26</span>, <span class="dv">60</span>, <span class="dv">5</span>, <span class="fl">8.5</span>),</span>
<span id="cb16-67"><a href="#cb16-67" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">45</span>, <span class="fl">42.7</span>, <span class="fl">2.3</span>, <span class="dv">10</span>))</span>
<span id="cb16-68"><a href="#cb16-68" tabindex="-1"></a></span>
<span id="cb16-69"><a href="#cb16-69" tabindex="-1"></a><span class="fu">names</span>(my_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot; &quot;</span>,<span class="st">&quot;1-compartment (%)&quot;</span>, <span class="st">&quot;2-compartment (%)&quot;</span>, <span class="st">&quot;Flat (%)&quot;</span>, <span class="st">&quot;Overall (%)&quot;</span>)</span>
<span id="cb16-70"><a href="#cb16-70" tabindex="-1"></a></span>
<span id="cb16-71"><a href="#cb16-71" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb16-72"><a href="#cb16-72" tabindex="-1"></a><span class="fu">library</span>(officer)</span>
<span id="cb16-73"><a href="#cb16-73" tabindex="-1"></a></span>
<span id="cb16-74"><a href="#cb16-74" tabindex="-1"></a><span class="fu">flextable</span>(my_table) <span class="sc">%&gt;%</span></span>
<span id="cb16-75"><a href="#cb16-75" tabindex="-1"></a>  <span class="fu">border_inner</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-76"><a href="#cb16-76" tabindex="-1"></a>  <span class="fu">fontsize</span>(<span class="at">part =</span> <span class="st">&quot;all&quot;</span>, <span class="at">size =</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-77"><a href="#cb16-77" tabindex="-1"></a>  <span class="fu">bold</span>(<span class="at">part =</span> <span class="st">&quot;all&quot;</span>, <span class="at">j =</span> <span class="dv">5</span>)</span>
<span id="cb16-78"><a href="#cb16-78" tabindex="-1"></a></span>
<span id="cb16-79"><a href="#cb16-79" tabindex="-1"></a>table_plot <span class="ot">&lt;-</span> <span class="fu">gen_grob</span>(<span class="fu">flextable</span>(my_table) <span class="sc">%&gt;%</span></span>
<span id="cb16-80"><a href="#cb16-80" tabindex="-1"></a>                         <span class="fu">border_inner</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-81"><a href="#cb16-81" tabindex="-1"></a>                         <span class="fu">fontsize</span>(<span class="at">part =</span> <span class="st">&quot;all&quot;</span>, <span class="at">size =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-82"><a href="#cb16-82" tabindex="-1"></a>                         <span class="fu">bold</span>(<span class="at">part =</span> <span class="st">&quot;all&quot;</span>, <span class="at">j =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-83"><a href="#cb16-83" tabindex="-1"></a>                         <span class="fu">autofit</span>())</span>
<span id="cb16-84"><a href="#cb16-84" tabindex="-1"></a></span>
<span id="cb16-85"><a href="#cb16-85" tabindex="-1"></a></span>
<span id="cb16-86"><a href="#cb16-86" tabindex="-1"></a>dual_plot <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(pl_7A, table_plot, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">align =</span> <span class="st">&quot;v&quot;</span>,</span>
<span id="cb16-87"><a href="#cb16-87" tabindex="-1"></a>          <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>))</span>
<span id="cb16-88"><a href="#cb16-88" tabindex="-1"></a></span>
<span id="cb16-89"><a href="#cb16-89" tabindex="-1"></a></span>
<span id="cb16-90"><a href="#cb16-90" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb16-91"><a href="#cb16-91" tabindex="-1"></a>              <span class="st">&quot;ModelPerformance_vDataVariability_wTable_2023-10-02.png&quot;</span>),</span>
<span id="cb16-92"><a href="#cb16-92" tabindex="-1"></a>       <span class="at">plot =</span> dual_plot,</span>
<span id="cb16-93"><a href="#cb16-93" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">4.5</span>,</span>
<span id="cb16-94"><a href="#cb16-94" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">6.5</span>,</span>
<span id="cb16-95"><a href="#cb16-95" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb16-96"><a href="#cb16-96" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb16-97"><a href="#cb16-97" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>,</span>
<span id="cb16-98"><a href="#cb16-98" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)  </span></code></pre></div>
</div>
<div id="figure-5alt" class="section level3">
<h3>Figure 5Alt</h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># Redo combined summary</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>combined_summary <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(sud_summary, iad_summary) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">twofold_95 =</span> <span class="fu">ifelse</span>((conc_avg_calc <span class="sc">+</span> (<span class="dv">2</span><span class="sc">*</span>conc_sd_calc))<span class="sc">/</span>conc_avg_calc <span class="sc">&lt;</span> <span class="dv">2</span>,</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>                             <span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co"># Now</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>this_preds <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(<span class="fu">predict</span>(my_pk), winmodel) <span class="sc">%&gt;%</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">foldPred =</span> Conc_est<span class="sc">/</span>Conc) <span class="sc">%&gt;%</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>  <span class="fu">distinct</span>(model, method, Chemical, Species, Route, Media, Dose, Time, foldPred) <span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>  <span class="fu">group_by</span>(model, method, Chemical, Species, Route, Media, Dose, Time) <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avgFE =</span> <span class="fu">mean</span>(foldPred, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>pl_7Alt <span class="ot">&lt;-</span> this_preds <span class="sc">%&gt;%</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>  <span class="fu">inner_join</span>(combined_summary, <span class="at">by =</span> <span class="fu">join_by</span>(Chemical, Species,</span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>                                            Route, Media,</span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>                                            Dose, Time)) <span class="sc">%&gt;%</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(model), avgFE <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a>  <span class="co"># </span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a>  <span class="co"># For Plotting</span></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a>    <span class="at">y =</span> avgFE,</span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a>    <span class="at">x =</span> twofold_95</span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a>  <span class="fu">geom_bin2d</span>(<span class="at">bins =</span> <span class="dv">40</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;red3&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_math</span>(<span class="at">format =</span> log10),</span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a>                <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.0001</span>, <span class="dv">10000</span>)) <span class="sc">+</span></span>
<span id="cb17-29"><a href="#cb17-29" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;cividis&quot;</span>,</span>
<span id="cb17-30"><a href="#cb17-30" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">200</span>),</span>
<span id="cb17-31"><a href="#cb17-31" tabindex="-1"></a>                       <span class="at">oob =</span> scales<span class="sc">::</span>oob_squish) <span class="sc">+</span></span>
<span id="cb17-32"><a href="#cb17-32" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Model Error&quot;</span>,</span>
<span id="cb17-33"><a href="#cb17-33" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;95% of data within 2-fold&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-34"><a href="#cb17-34" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb17-35"><a href="#cb17-35" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="fl">1.5</span>),</span>
<span id="cb17-36"><a href="#cb17-36" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-37"><a href="#cb17-37" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb17-38"><a href="#cb17-38" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb17-39"><a href="#cb17-39" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb17-40"><a href="#cb17-40" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-41"><a href="#cb17-41" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>())</span>
<span id="cb17-42"><a href="#cb17-42" tabindex="-1"></a></span>
<span id="cb17-43"><a href="#cb17-43" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb17-44"><a href="#cb17-44" tabindex="-1"></a>              <span class="st">&quot;ModelPerformance_vDataVariability_2023-11-14.png&quot;</span>),</span>
<span id="cb17-45"><a href="#cb17-45" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">4.5</span>,</span>
<span id="cb17-46"><a href="#cb17-46" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">4.5</span>,</span>
<span id="cb17-47"><a href="#cb17-47" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb17-48"><a href="#cb17-48" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb17-49"><a href="#cb17-49" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>,</span>
<span id="cb17-50"><a href="#cb17-50" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)  </span>
<span id="cb17-51"><a href="#cb17-51" tabindex="-1"></a></span>
<span id="cb17-52"><a href="#cb17-52" tabindex="-1"></a>this_preds <span class="sc">%&gt;%</span></span>
<span id="cb17-53"><a href="#cb17-53" tabindex="-1"></a>  <span class="fu">inner_join</span>(combined_summary, <span class="at">by =</span> <span class="fu">join_by</span>(Chemical, Species,</span>
<span id="cb17-54"><a href="#cb17-54" tabindex="-1"></a>                                            Route, Media,</span>
<span id="cb17-55"><a href="#cb17-55" tabindex="-1"></a>                                            Dose, Time)) <span class="sc">%&gt;%</span></span>
<span id="cb17-56"><a href="#cb17-56" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(model), avgFE <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-57"><a href="#cb17-57" tabindex="-1"></a>  <span class="fu">filter</span>(model <span class="sc">==</span> <span class="st">&quot;model_2comp&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-58"><a href="#cb17-58" tabindex="-1"></a>  <span class="fu">count</span>(<span class="sc">!</span>(avgFE <span class="sc">&gt;=</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> avgFE <span class="sc">&lt;=</span> <span class="dv">2</span>) <span class="sc">&amp;</span> <span class="sc">!</span>twofold_95) <span class="sc">%&gt;%</span></span>
<span id="cb17-59"><a href="#cb17-59" tabindex="-1"></a>  {<span class="dv">100</span><span class="sc">*</span>.[[<span class="dv">2</span>,<span class="dv">2</span>]]<span class="sc">/</span>(.[[<span class="dv">1</span>,<span class="dv">2</span>]] <span class="sc">+</span> .[[<span class="dv">2</span>,<span class="dv">2</span>]])} <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb17-60"><a href="#cb17-60" tabindex="-1"></a></span>
<span id="cb17-61"><a href="#cb17-61" tabindex="-1"></a><span class="co"># Table</span></span>
<span id="cb17-62"><a href="#cb17-62" tabindex="-1"></a></span>
<span id="cb17-63"><a href="#cb17-63" tabindex="-1"></a>my_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-64"><a href="#cb17-64" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;Reasonable model error and observed variability&quot;</span>,</span>
<span id="cb17-65"><a href="#cb17-65" tabindex="-1"></a>    <span class="st">&quot;Data variability high, model error reasonable&quot;</span>,</span>
<span id="cb17-66"><a href="#cb17-66" tabindex="-1"></a>    <span class="st">&quot;Model error high, data variation reasonable&quot;</span>,</span>
<span id="cb17-67"><a href="#cb17-67" tabindex="-1"></a>    <span class="st">&quot;Both model error and data variability are high&quot;</span>),</span>
<span id="cb17-68"><a href="#cb17-68" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">37.2</span>, <span class="fl">6.5</span>,  <span class="fl">41.4</span>, <span class="fl">14.8</span>),</span>
<span id="cb17-69"><a href="#cb17-69" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">53.6</span>, <span class="fl">3.5</span>,  <span class="fl">32.4</span>, <span class="fl">10.4</span>),</span>
<span id="cb17-70"><a href="#cb17-70" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">11.0</span>, <span class="fl">16.4</span>, <span class="fl">46.6</span>, <span class="fl">26.0</span>),</span>
<span id="cb17-71"><a href="#cb17-71" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fl">44.2</span>, <span class="fl">5.4</span>,  <span class="fl">37.4</span>, <span class="fl">13.0</span>))</span>
<span id="cb17-72"><a href="#cb17-72" tabindex="-1"></a></span>
<span id="cb17-73"><a href="#cb17-73" tabindex="-1"></a><span class="fu">names</span>(my_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot; &quot;</span>,<span class="st">&quot;1-compartment (%)&quot;</span>, <span class="st">&quot;2-compartment (%)&quot;</span>, <span class="st">&quot;Flat (%)&quot;</span>, <span class="st">&quot;Overall (%)&quot;</span>)</span>
<span id="cb17-74"><a href="#cb17-74" tabindex="-1"></a></span>
<span id="cb17-75"><a href="#cb17-75" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb17-76"><a href="#cb17-76" tabindex="-1"></a><span class="fu">library</span>(officer)</span>
<span id="cb17-77"><a href="#cb17-77" tabindex="-1"></a></span>
<span id="cb17-78"><a href="#cb17-78" tabindex="-1"></a><span class="fu">flextable</span>(my_table) <span class="sc">%&gt;%</span></span>
<span id="cb17-79"><a href="#cb17-79" tabindex="-1"></a>  <span class="fu">border_inner</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-80"><a href="#cb17-80" tabindex="-1"></a>  <span class="fu">fontsize</span>(<span class="at">part =</span> <span class="st">&quot;all&quot;</span>, <span class="at">size =</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-81"><a href="#cb17-81" tabindex="-1"></a>  <span class="fu">bold</span>(<span class="at">part =</span> <span class="st">&quot;all&quot;</span>, <span class="at">j =</span> <span class="dv">5</span>)</span>
<span id="cb17-82"><a href="#cb17-82" tabindex="-1"></a></span>
<span id="cb17-83"><a href="#cb17-83" tabindex="-1"></a>table_plot <span class="ot">&lt;-</span> <span class="fu">gen_grob</span>(<span class="fu">flextable</span>(my_table) <span class="sc">%&gt;%</span></span>
<span id="cb17-84"><a href="#cb17-84" tabindex="-1"></a>                         <span class="fu">border_inner</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-85"><a href="#cb17-85" tabindex="-1"></a>                         <span class="fu">fontsize</span>(<span class="at">part =</span> <span class="st">&quot;all&quot;</span>, <span class="at">size =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-86"><a href="#cb17-86" tabindex="-1"></a>                         <span class="fu">bold</span>(<span class="at">part =</span> <span class="st">&quot;all&quot;</span>, <span class="at">j =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-87"><a href="#cb17-87" tabindex="-1"></a>                         <span class="fu">autofit</span>())</span>
<span id="cb17-88"><a href="#cb17-88" tabindex="-1"></a></span>
<span id="cb17-89"><a href="#cb17-89" tabindex="-1"></a></span>
<span id="cb17-90"><a href="#cb17-90" tabindex="-1"></a>dual_plot <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(pl_7Alt, table_plot, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">align =</span> <span class="st">&quot;v&quot;</span>,</span>
<span id="cb17-91"><a href="#cb17-91" tabindex="-1"></a>          <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>))</span>
<span id="cb17-92"><a href="#cb17-92" tabindex="-1"></a></span>
<span id="cb17-93"><a href="#cb17-93" tabindex="-1"></a>dual_plot</span>
<span id="cb17-94"><a href="#cb17-94" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb17-95"><a href="#cb17-95" tabindex="-1"></a>              <span class="st">&quot;ModelPerformance_vDataVariability_wTable_2023-11-30.png&quot;</span>),</span>
<span id="cb17-96"><a href="#cb17-96" tabindex="-1"></a>       <span class="at">plot =</span> dual_plot,</span>
<span id="cb17-97"><a href="#cb17-97" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">4.5</span>,</span>
<span id="cb17-98"><a href="#cb17-98" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">6.5</span>,</span>
<span id="cb17-99"><a href="#cb17-99" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb17-100"><a href="#cb17-100" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb17-101"><a href="#cb17-101" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>,</span>
<span id="cb17-102"><a href="#cb17-102" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)  </span></code></pre></div>
</div>
<div id="figure-6-multiple-goodness-of-fit-metrics-validate-model-performance" class="section level3">
<h3>Figure 6: Multiple goodness-of-fit metrics validate model
performance</h3>
<p>This should be it’s own figure</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>my_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(fold_errors_all, r2_df) <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(myAIC) <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(myRMSE_all)</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>mypl <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> my_df,</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>               <span class="fu">aes</span>(</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>                 <span class="at">x =</span> within_2fold,</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>                 <span class="at">y =</span> Rsq,</span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>                 <span class="at">color =</span> model</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>               )) <span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;red4&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;longdash&quot;</span>) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#0398FC&quot;</span>, <span class="st">&quot;#D68E09&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;% Fold Error within 2-fold&quot;</span>,</span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;R-squared value&quot;</span>) <span class="sc">+</span></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb18-24"><a href="#cb18-24" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb18-25"><a href="#cb18-25" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_blank</span>())</span>
<span id="cb18-26"><a href="#cb18-26" tabindex="-1"></a>panelA_plot <span class="ot">&lt;-</span> ggExtra<span class="sc">::</span><span class="fu">ggMarginal</span>(mypl, <span class="at">groupFill =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-27"><a href="#cb18-27" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">&quot;histogram&quot;</span>,</span>
<span id="cb18-28"><a href="#cb18-28" tabindex="-1"></a>                    <span class="at">xparams =</span> <span class="fu">list</span>(<span class="at">binwidth =</span> <span class="fl">0.05</span>),</span>
<span id="cb18-29"><a href="#cb18-29" tabindex="-1"></a>                    <span class="at">yparams =</span> <span class="fu">list</span>(<span class="at">binwidth =</span> <span class="fl">0.05</span>))</span>
<span id="cb18-30"><a href="#cb18-30" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb18-31"><a href="#cb18-31" tabindex="-1"></a>                         <span class="st">&quot;R2_within2fold_comparison.png&quot;</span>),</span>
<span id="cb18-32"><a href="#cb18-32" tabindex="-1"></a>       <span class="at">plot =</span> ggExtra<span class="sc">::</span><span class="fu">ggMarginal</span>(mypl, <span class="at">groupFill =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-33"><a href="#cb18-33" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">&quot;histogram&quot;</span>,</span>
<span id="cb18-34"><a href="#cb18-34" tabindex="-1"></a>                    <span class="at">xparams =</span> <span class="fu">list</span>(<span class="at">binwidth =</span> <span class="fl">0.05</span>),</span>
<span id="cb18-35"><a href="#cb18-35" tabindex="-1"></a>                    <span class="at">yparams =</span> <span class="fu">list</span>(<span class="at">binwidth =</span> <span class="fl">0.05</span>)),</span>
<span id="cb18-36"><a href="#cb18-36" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">5</span>,</span>
<span id="cb18-37"><a href="#cb18-37" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">5</span>,</span>
<span id="cb18-38"><a href="#cb18-38" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span>
<span id="cb18-39"><a href="#cb18-39" tabindex="-1"></a></span>
<span id="cb18-40"><a href="#cb18-40" tabindex="-1"></a>panelB_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> myRMSE <span class="sc">%&gt;%</span></span>
<span id="cb18-41"><a href="#cb18-41" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">RMSE =</span> <span class="fu">ifelse</span>(RMSE <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, RMSE)),</span>
<span id="cb18-42"><a href="#cb18-42" tabindex="-1"></a>               <span class="fu">aes</span>(</span>
<span id="cb18-43"><a href="#cb18-43" tabindex="-1"></a>                 <span class="at">x =</span> <span class="fu">log10</span>(RMSE),</span>
<span id="cb18-44"><a href="#cb18-44" tabindex="-1"></a>                 <span class="at">color =</span> model,</span>
<span id="cb18-45"><a href="#cb18-45" tabindex="-1"></a>                 <span class="at">fill =</span> model</span>
<span id="cb18-46"><a href="#cb18-46" tabindex="-1"></a>               )) <span class="sc">+</span> </span>
<span id="cb18-47"><a href="#cb18-47" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb18-48"><a href="#cb18-48" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="sc">+</span></span>
<span id="cb18-49"><a href="#cb18-49" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#0398FC&quot;</span>, <span class="st">&quot;#D68E09&quot;</span>, <span class="st">&quot;grey10&quot;</span>)) <span class="sc">+</span></span>
<span id="cb18-50"><a href="#cb18-50" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#0398FC&quot;</span>, <span class="st">&quot;#D68E09&quot;</span>, <span class="st">&quot;grey10&quot;</span>)) <span class="sc">+</span></span>
<span id="cb18-51"><a href="#cb18-51" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">pretty_breaks</span>(<span class="at">n =</span> <span class="dv">4</span>),</span>
<span id="cb18-52"><a href="#cb18-52" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb18-53"><a href="#cb18-53" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(model),</span>
<span id="cb18-54"><a href="#cb18-54" tabindex="-1"></a>             <span class="at">cols =</span> <span class="fu">vars</span>(Route)) <span class="sc">+</span></span>
<span id="cb18-55"><a href="#cb18-55" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb18-56"><a href="#cb18-56" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="fl">0.6</span>,</span>
<span id="cb18-57"><a href="#cb18-57" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb18-58"><a href="#cb18-58" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb18-59"><a href="#cb18-59" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb18-60"><a href="#cb18-60" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb18-61"><a href="#cb18-61" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb18-62"><a href="#cb18-62" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb18-63"><a href="#cb18-63" tabindex="-1"></a>    <span class="at">panel.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.125</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>),</span>
<span id="cb18-64"><a href="#cb18-64" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb18-65"><a href="#cb18-65" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb18-66"><a href="#cb18-66" tabindex="-1"></a></span>
<span id="cb18-67"><a href="#cb18-67" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb18-68"><a href="#cb18-68" tabindex="-1"></a>                         <span class="st">&quot;RMSEs_winningmodel_LBFGSB_zero1E-6_RouteFacet_notNormalized.png&quot;</span>),</span>
<span id="cb18-69"><a href="#cb18-69" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb18-70"><a href="#cb18-70" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb18-71"><a href="#cb18-71" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span>
<span id="cb18-72"><a href="#cb18-72" tabindex="-1"></a></span>
<span id="cb18-73"><a href="#cb18-73" tabindex="-1"></a>legend <span class="ot">&lt;-</span> <span class="fu">get_legend</span>(panelB_plot)</span>
<span id="cb18-74"><a href="#cb18-74" tabindex="-1"></a></span>
<span id="cb18-75"><a href="#cb18-75" tabindex="-1"></a><span class="fu">plot_grid</span>(<span class="fu">plot_grid</span>(panelA_plot,</span>
<span id="cb18-76"><a href="#cb18-76" tabindex="-1"></a>                   panelB_plot <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>),</span>
<span id="cb18-77"><a href="#cb18-77" tabindex="-1"></a>                   <span class="at">axis =</span> <span class="st">&quot;tb&quot;</span>, <span class="at">align =</span> <span class="st">&quot;h&quot;</span>, <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)), legend,</span>
<span id="cb18-78"><a href="#cb18-78" tabindex="-1"></a>          <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb18-79"><a href="#cb18-79" tabindex="-1"></a>          <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>))</span>
<span id="cb18-80"><a href="#cb18-80" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb18-81"><a href="#cb18-81" tabindex="-1"></a>                         <span class="st">&quot;CombinedPlot_Rsquared_RMSE.png&quot;</span>),</span>
<span id="cb18-82"><a href="#cb18-82" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb18-83"><a href="#cb18-83" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">6.5</span>,</span>
<span id="cb18-84"><a href="#cb18-84" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb18-85"><a href="#cb18-85" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span></code></pre></div>
</div>
<div id="supp.-fig.-3-distribution-of-sigmas-in-cvtdb-data" class="section level3">
<h3>Supp. Fig. 3: Distribution of Sigmas in CvTdb data</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>my_coefs <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(<span class="fu">get_winning_model</span>(my_pk), <span class="fu">coef</span>(my_pk))</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>my_coefs <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(<span class="fu">get_data_summary</span>(my_pk)) <span class="ot">-&gt;</span> my_coefs</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>my_coefs <span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> </span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>           <span class="fu">case_when</span>(</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>             model <span class="sc">==</span> <span class="st">&quot;model_1comp&quot;</span> <span class="sc">~</span> <span class="st">&quot;1-compartment&quot;</span>,</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>             model <span class="sc">==</span> <span class="st">&quot;model_2comp&quot;</span> <span class="sc">~</span> <span class="st">&quot;2-compartment&quot;</span>,</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>             model <span class="sc">==</span> <span class="st">&quot;model_flat&quot;</span>  <span class="sc">~</span> <span class="st">&quot;Null&quot;</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>           )) <span class="sc">%&gt;%</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sigma_value<span class="sc">/</span>n_obs)) <span class="sc">+</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>,</span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a>                 <span class="at">color =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="st">&quot;grey5&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_math</span>(<span class="at">format =</span> log10)) <span class="sc">+</span></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(model)) <span class="sc">+</span></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Size-normalized Sigma Value&quot;</span>,</span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of Observations&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="fl">1.5</span>),</span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>())</span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a>              <span class="st">&quot;NormalizedSigma_Distributions_2023-07.png&quot;</span>),</span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="dv">5</span>)</span></code></pre></div>
</div>
<div id="figure-7-comparing-derived-tk-stats-with-human-tk-stats-from-lombardo-et-al." class="section level3">
<h3>Figure 7: Comparing derived TK stats with human TK stats from
Lombardo et al.</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>cvt_DTXSIDs <span class="ot">&lt;-</span> <span class="fu">unique</span>(my_pk<span class="sc">$</span>data<span class="sc">$</span>Chemical)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co"># First things first, let&#39;s load the data from Lombardo et al.</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>lombardo <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>         <span class="st">&quot;Lombardo2018-Supplemental_82966_revised_corrected.xlsx&quot;</span>),</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>  <span class="at">skip =</span> <span class="dv">8</span>)</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>l_batch_search <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>         <span class="st">&quot;LombardoBatchSearch_Name.xlsx&quot;</span>),</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>  <span class="at">sheet =</span> <span class="st">&quot;Main Data&quot;</span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a>)</span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a>  </span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a>l_batch_search <span class="ot">&lt;-</span> l_batch_search[<span class="fu">c</span>(<span class="st">&quot;INPUT&quot;</span>, <span class="st">&quot;CASRN&quot;</span>,<span class="st">&quot;DTXSID&quot;</span>)] <span class="sc">%&gt;%</span></span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a>  <span class="fu">right_join</span>(lombardo[<span class="fu">c</span>(<span class="st">&quot;Name&quot;</span>, <span class="st">&quot;CAS #&quot;</span>)], <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;CASRN&quot;</span> <span class="ot">=</span> <span class="st">&quot;CAS #&quot;</span>, <span class="st">&quot;INPUT&quot;</span> <span class="ot">=</span> <span class="st">&quot;Name&quot;</span>))</span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a></span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a>l_noNamesCASRN <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(</span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a>         <span class="st">&quot;LombardoBatchSearch_CASRNnoName.xlsx&quot;</span>),</span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a>  <span class="at">sheet =</span> <span class="st">&quot;Main Data&quot;</span></span>
<span id="cb20-26"><a href="#cb20-26" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb20-27"><a href="#cb20-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">CASRN =</span> INPUT, DTXSID)</span>
<span id="cb20-28"><a href="#cb20-28" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" tabindex="-1"></a>l_curatedDTX <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb20-30"><a href="#cb20-30" tabindex="-1"></a>                         <span class="st">&quot;CuratedIDs_lombardo.txt&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-31"><a href="#cb20-31" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">INPUT =</span> Name)</span>
<span id="cb20-32"><a href="#cb20-32" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" tabindex="-1"></a></span>
<span id="cb20-34"><a href="#cb20-34" tabindex="-1"></a>l_batch_search <span class="ot">&lt;-</span> l_batch_search <span class="sc">%&gt;%</span></span>
<span id="cb20-35"><a href="#cb20-35" tabindex="-1"></a>  <span class="fu">left_join</span>(l_noNamesCASRN, <span class="at">by =</span> <span class="st">&quot;CASRN&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-36"><a href="#cb20-36" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DTXSID =</span> <span class="fu">coalesce</span>(DTXSID.x, DTXSID.y)) <span class="sc">%&gt;%</span></span>
<span id="cb20-37"><a href="#cb20-37" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>DTXSID.x, <span class="sc">-</span>DTXSID.y) <span class="sc">%&gt;%</span></span>
<span id="cb20-38"><a href="#cb20-38" tabindex="-1"></a>  <span class="fu">left_join</span>(l_curatedDTX, <span class="at">by =</span> <span class="st">&quot;INPUT&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-39"><a href="#cb20-39" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DTXSID =</span> <span class="fu">coalesce</span>(DTXSID.x, DTXSID.y)) <span class="sc">%&gt;%</span></span>
<span id="cb20-40"><a href="#cb20-40" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>DTXSID.x, <span class="sc">-</span>DTXSID.y)</span>
<span id="cb20-41"><a href="#cb20-41" tabindex="-1"></a><span class="co"># Now all but two of the IDs are unidentified</span></span>
<span id="cb20-42"><a href="#cb20-42" tabindex="-1"></a></span>
<span id="cb20-43"><a href="#cb20-43" tabindex="-1"></a>lombardo <span class="ot">&lt;-</span> lombardo <span class="sc">%&gt;%</span></span>
<span id="cb20-44"><a href="#cb20-44" tabindex="-1"></a>  <span class="fu">right_join</span>(l_batch_search, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Name&quot;</span> <span class="ot">=</span> <span class="st">&quot;INPUT&quot;</span>))</span>
<span id="cb20-45"><a href="#cb20-45" tabindex="-1"></a></span>
<span id="cb20-46"><a href="#cb20-46" tabindex="-1"></a>lombard_abbr <span class="ot">&lt;-</span> lombardo <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(DTXSID,</span>
<span id="cb20-47"><a href="#cb20-47" tabindex="-1"></a>                                           <span class="at">hVss =</span> <span class="st">`</span><span class="at">human VDss (L/kg)</span><span class="st">`</span>,</span>
<span id="cb20-48"><a href="#cb20-48" tabindex="-1"></a>                                           <span class="at">hCltot =</span> <span class="st">`</span><span class="at">human CL (mL/min/kg)</span><span class="st">`</span>,</span>
<span id="cb20-49"><a href="#cb20-49" tabindex="-1"></a>                                           <span class="at">halflife =</span> <span class="st">`</span><span class="at">terminal  t1/2 (h)</span><span class="st">`</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb20-50"><a href="#cb20-50" tabindex="-1"></a>  <span class="fu">filter</span>(DTXSID <span class="sc">%in%</span> cvt_DTXSIDs)</span>
<span id="cb20-51"><a href="#cb20-51" tabindex="-1"></a></span>
<span id="cb20-52"><a href="#cb20-52" tabindex="-1"></a><span class="co"># 15 chemicals in common with values for both</span></span>
<span id="cb20-53"><a href="#cb20-53" tabindex="-1"></a>lombardo_comparison <span class="ot">&lt;-</span> my_tkstats <span class="sc">%&gt;%</span></span>
<span id="cb20-54"><a href="#cb20-54" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">DTXSID =</span> Chemical, Species,</span>
<span id="cb20-55"><a href="#cb20-55" tabindex="-1"></a>                model, Vss.tkstats, CLtot.tkstats) <span class="sc">%&gt;%</span></span>
<span id="cb20-56"><a href="#cb20-56" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-57"><a href="#cb20-57" tabindex="-1"></a>  <span class="fu">inner_join</span>(lombard_abbr, <span class="at">by =</span> <span class="st">&quot;DTXSID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-58"><a href="#cb20-58" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Vss.tkstats)) <span class="sc">%&gt;%</span></span>
<span id="cb20-59"><a href="#cb20-59" tabindex="-1"></a>  <span class="fu">arrange</span>(halflife)</span>
<span id="cb20-60"><a href="#cb20-60" tabindex="-1"></a></span>
<span id="cb20-61"><a href="#cb20-61" tabindex="-1"></a>comparable_ids <span class="ot">&lt;-</span> lombardo_comparison <span class="sc">%&gt;%</span> <span class="fu">pull</span>(DTXSID)</span>
<span id="cb20-62"><a href="#cb20-62" tabindex="-1"></a></span>
<span id="cb20-63"><a href="#cb20-63" tabindex="-1"></a>lombard_abbr <span class="ot">&lt;-</span> lombard_abbr <span class="sc">%&gt;%</span></span>
<span id="cb20-64"><a href="#cb20-64" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="st">&quot;human&quot;</span>, <span class="at">model =</span> <span class="st">&quot;Lombardo et al.&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-65"><a href="#cb20-65" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Vss =</span> hVss, <span class="at">CLtot =</span> hCltot) <span class="sc">%&gt;%</span></span>
<span id="cb20-66"><a href="#cb20-66" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CLtot =</span> CLtot<span class="sc">*</span><span class="dv">60</span><span class="sc">/</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span> <span class="co"># Lombardo reports this as mL/min/kg, need L/h/kg</span></span>
<span id="cb20-67"><a href="#cb20-67" tabindex="-1"></a>  <span class="fu">filter</span>(DTXSID <span class="sc">%in%</span> comparable_ids)</span>
<span id="cb20-68"><a href="#cb20-68" tabindex="-1"></a></span>
<span id="cb20-69"><a href="#cb20-69" tabindex="-1"></a>lombardo_comparison <span class="ot">&lt;-</span> my_tkstats <span class="sc">%&gt;%</span></span>
<span id="cb20-70"><a href="#cb20-70" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">DTXSID =</span> Chemical, Species,</span>
<span id="cb20-71"><a href="#cb20-71" tabindex="-1"></a>                model, Vss.tkstats, CLtot.tkstats, halflife.tkstats) <span class="sc">%&gt;%</span></span>
<span id="cb20-72"><a href="#cb20-72" tabindex="-1"></a>  <span class="fu">filter</span>(DTXSID <span class="sc">%in%</span> comparable_ids) <span class="sc">%&gt;%</span></span>
<span id="cb20-73"><a href="#cb20-73" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-74"><a href="#cb20-74" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Vss =</span> Vss.tkstats, <span class="at">CLtot =</span> CLtot.tkstats, <span class="at">halflife =</span> halflife.tkstats) <span class="sc">%&gt;%</span></span>
<span id="cb20-75"><a href="#cb20-75" tabindex="-1"></a>  <span class="fu">bind_rows</span>(lombard_abbr) <span class="sc">%&gt;%</span></span>
<span id="cb20-76"><a href="#cb20-76" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(model, <span class="st">&quot;^model&quot;</span>), <span class="st">&quot;invivoPKfit&quot;</span>, model),</span>
<span id="cb20-77"><a href="#cb20-77" tabindex="-1"></a>         <span class="at">DTXSID =</span> <span class="fu">factor</span>(DTXSID, <span class="at">levels =</span> <span class="fu">unique</span>(comparable_ids)))</span>
<span id="cb20-78"><a href="#cb20-78" tabindex="-1"></a></span>
<span id="cb20-79"><a href="#cb20-79" tabindex="-1"></a>lombardo_comparison <span class="sc">%&gt;%</span></span>
<span id="cb20-80"><a href="#cb20-80" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;Vss&quot;</span>, <span class="st">&quot;CLtot&quot;</span>, <span class="st">&quot;halflife&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-81"><a href="#cb20-81" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;halflife&quot;</span>, <span class="st">&quot;Vss&quot;</span>, <span class="st">&quot;CLtot&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb20-82"><a href="#cb20-82" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb20-83"><a href="#cb20-83" tabindex="-1"></a>    <span class="at">x =</span> value,</span>
<span id="cb20-84"><a href="#cb20-84" tabindex="-1"></a>    <span class="at">y =</span> DTXSID</span>
<span id="cb20-85"><a href="#cb20-85" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb20-86"><a href="#cb20-86" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> model,</span>
<span id="cb20-87"><a href="#cb20-87" tabindex="-1"></a>                 <span class="at">shape =</span> Species),</span>
<span id="cb20-88"><a href="#cb20-88" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.7</span>),</span>
<span id="cb20-89"><a href="#cb20-89" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">5</span><span class="sc">/</span>.pt, <span class="at">stroke =</span> <span class="fl">2.5</span><span class="sc">/</span>.pt) <span class="sc">+</span></span>
<span id="cb20-90"><a href="#cb20-90" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(name),</span>
<span id="cb20-91"><a href="#cb20-91" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb20-92"><a href="#cb20-92" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">24</span>),</span>
<span id="cb20-93"><a href="#cb20-93" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;human&quot;</span>, <span class="st">&quot;dog&quot;</span>, <span class="st">&quot;rat&quot;</span>)) <span class="sc">+</span></span>
<span id="cb20-94"><a href="#cb20-94" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;#1064c9&quot;</span>)) <span class="sc">+</span></span>
<span id="cb20-95"><a href="#cb20-95" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">21</span>),</span>
<span id="cb20-96"><a href="#cb20-96" tabindex="-1"></a>                              <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb20-97"><a href="#cb20-97" tabindex="-1"></a>                              <span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb20-98"><a href="#cb20-98" tabindex="-1"></a>                              <span class="at">title.hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb20-99"><a href="#cb20-99" tabindex="-1"></a>         <span class="at">shape =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>,</span>
<span id="cb20-100"><a href="#cb20-100" tabindex="-1"></a>                              <span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb20-101"><a href="#cb20-101" tabindex="-1"></a>                              <span class="at">title.hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb20-102"><a href="#cb20-102" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>),</span>
<span id="cb20-103"><a href="#cb20-103" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-104"><a href="#cb20-104" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb20-105"><a href="#cb20-105" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb20-106"><a href="#cb20-106" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb20-107"><a href="#cb20-107" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb20-108"><a href="#cb20-108" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-109"><a href="#cb20-109" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-110"><a href="#cb20-110" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb20-111"><a href="#cb20-111" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-112"><a href="#cb20-112" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-113"><a href="#cb20-113" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb20-114"><a href="#cb20-114" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-115"><a href="#cb20-115" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb20-116"><a href="#cb20-116" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>())</span>
<span id="cb20-117"><a href="#cb20-117" tabindex="-1"></a></span>
<span id="cb20-118"><a href="#cb20-118" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb20-119"><a href="#cb20-119" tabindex="-1"></a>                         <span class="st">&quot;lombardoComparison_Figure8.png&quot;</span>),</span>
<span id="cb20-120"><a href="#cb20-120" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb20-121"><a href="#cb20-121" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">6.5</span>,</span>
<span id="cb20-122"><a href="#cb20-122" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb20-123"><a href="#cb20-123" tabindex="-1"></a>  </span></code></pre></div>
</div>
<div id="supp.-fig.-4-histogram-of-lombardo-vss-and-invivopkfit-another-meta-analysis" class="section level3">
<h3>Supp. Fig. 4 Histogram of Lombardo Vss and InvivoPKfit &amp; another
meta-analysis</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="co"># Histograms</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>lombardo_hist <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Chemical =</span> <span class="fu">c</span>(lombardo<span class="sc">$</span>DTXSID,</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>                              my_tkstats<span class="sc">$</span>Chemical),</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>                            <span class="at">Vss =</span> <span class="fu">c</span>(lombardo<span class="sc">$</span><span class="st">`</span><span class="at">human VDss (L/kg)</span><span class="st">`</span>,</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>                              my_tkstats<span class="sc">$</span>Vss.tkstats),</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>                            <span class="at">halflife =</span> <span class="fu">c</span>(lombardo<span class="sc">$</span><span class="st">`</span><span class="at">terminal  t1/2 (h)</span><span class="st">`</span>,</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>                              my_tkstats<span class="sc">$</span>halflife.tkstats),</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>                            <span class="at">Source =</span> <span class="fu">c</span>(<span class="fu">rep_len</span>(<span class="st">&quot;lombardo&quot;</span>,</span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>                                    <span class="at">length.out =</span> <span class="fu">nrow</span>(lombardo)),</span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>                              <span class="fu">rep_len</span>(<span class="st">&quot;invivoPKfit&quot;</span>,</span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>                                      <span class="at">length.out =</span> <span class="fu">nrow</span>(my_tkstats))))</span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>sfig4A <span class="ot">&lt;-</span> lombardo_hist <span class="sc">%&gt;%</span> </span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log2</span>(Vss), <span class="at">color =</span> Source,</span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a>             <span class="at">group =</span> Source)) <span class="sc">+</span></span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(ndensity)),</span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a>                <span class="at">linewidth =</span> <span class="dv">2</span><span class="sc">/</span>.pt,</span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a>                <span class="at">bins =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Scaled Frequency&quot;</span>,</span>
<span id="cb21-22"><a href="#cb21-22" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Vss&quot;</span>) <span class="sc">+</span></span>
<span id="cb21-23"><a href="#cb21-23" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_math</span>(<span class="at">expr =</span> <span class="dv">2</span><span class="sc">^</span>.x)) <span class="sc">+</span></span>
<span id="cb21-24"><a href="#cb21-24" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;#1064c9&quot;</span>)) <span class="sc">+</span></span>
<span id="cb21-25"><a href="#cb21-25" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">linewidth =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb21-26"><a href="#cb21-26" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>),</span>
<span id="cb21-27"><a href="#cb21-27" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-28"><a href="#cb21-28" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb21-29"><a href="#cb21-29" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb21-30"><a href="#cb21-30" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb21-31"><a href="#cb21-31" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb21-32"><a href="#cb21-32" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-33"><a href="#cb21-33" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-34"><a href="#cb21-34" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb21-35"><a href="#cb21-35" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb21-36"><a href="#cb21-36" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-37"><a href="#cb21-37" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb21-38"><a href="#cb21-38" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>())</span>
<span id="cb21-39"><a href="#cb21-39" tabindex="-1"></a></span>
<span id="cb21-40"><a href="#cb21-40" tabindex="-1"></a>sfig4A</span>
<span id="cb21-41"><a href="#cb21-41" tabindex="-1"></a>other_meta <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb21-42"><a href="#cb21-42" tabindex="-1"></a>  <span class="at">file =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>), <span class="st">&quot;SupTableInVivoDatandPreds.csv&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-43"><a href="#cb21-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(DTXSID, fbioh, fbior) <span class="sc">%&gt;%</span></span>
<span id="cb21-44"><a href="#cb21-44" tabindex="-1"></a>  <span class="fu">filter</span>(DTXSID <span class="sc">%in%</span> my_tkstats<span class="sc">$</span>Chemical)</span>
<span id="cb21-45"><a href="#cb21-45" tabindex="-1"></a></span>
<span id="cb21-46"><a href="#cb21-46" tabindex="-1"></a></span>
<span id="cb21-47"><a href="#cb21-47" tabindex="-1"></a>sfig4B <span class="ot">&lt;-</span> other_meta <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(my_tkstats, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;DTXSID&quot;</span> <span class="ot">=</span> <span class="st">&quot;Chemical&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-48"><a href="#cb21-48" tabindex="-1"></a>  <span class="fu">filter</span>(Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;rat&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-49"><a href="#cb21-49" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Fgutabs.tkstats),</span>
<span id="cb21-50"><a href="#cb21-50" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(fbior)) <span class="sc">%&gt;%</span></span>
<span id="cb21-51"><a href="#cb21-51" tabindex="-1"></a>  <span class="fu">distinct</span>(DTXSID, Species,</span>
<span id="cb21-52"><a href="#cb21-52" tabindex="-1"></a>           Fgutabs.tkstats, fbior) <span class="sc">%&gt;%</span></span>
<span id="cb21-53"><a href="#cb21-53" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(Fgutabs.tkstats, fbior),</span>
<span id="cb21-54"><a href="#cb21-54" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;Source&quot;</span>,</span>
<span id="cb21-55"><a href="#cb21-55" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;Fgutabs&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-56"><a href="#cb21-56" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Source =</span> <span class="fu">ifelse</span>(<span class="fu">str_detect</span>(Source, <span class="st">&quot;tkstats&quot;</span>), <span class="st">&quot;invivoPKfit&quot;</span>,</span>
<span id="cb21-57"><a href="#cb21-57" tabindex="-1"></a>                           <span class="st">&quot;Honda et al.&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-58"><a href="#cb21-58" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb21-59"><a href="#cb21-59" tabindex="-1"></a>      <span class="at">x =</span> Fgutabs,</span>
<span id="cb21-60"><a href="#cb21-60" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">reorder</span>(DTXSID, Fgutabs)</span>
<span id="cb21-61"><a href="#cb21-61" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb21-62"><a href="#cb21-62" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> Source),</span>
<span id="cb21-63"><a href="#cb21-63" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">24</span>,</span>
<span id="cb21-64"><a href="#cb21-64" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.7</span>),</span>
<span id="cb21-65"><a href="#cb21-65" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">5</span><span class="sc">/</span>.pt, <span class="at">stroke =</span> <span class="fl">2.5</span><span class="sc">/</span>.pt) <span class="sc">+</span></span>
<span id="cb21-66"><a href="#cb21-66" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;green4&quot;</span>),</span>
<span id="cb21-67"><a href="#cb21-67" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;invivoPKfit&quot;</span>, <span class="st">&quot;Honda et al.&quot;</span>)) <span class="sc">+</span></span>
<span id="cb21-68"><a href="#cb21-68" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Oral Bioavailability&quot;</span>) <span class="sc">+</span></span>
<span id="cb21-69"><a href="#cb21-69" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb21-70"><a href="#cb21-70" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>),</span>
<span id="cb21-71"><a href="#cb21-71" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-72"><a href="#cb21-72" tabindex="-1"></a>          <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb21-73"><a href="#cb21-73" tabindex="-1"></a>          <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb21-74"><a href="#cb21-74" tabindex="-1"></a>          <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb21-75"><a href="#cb21-75" tabindex="-1"></a>          <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb21-76"><a href="#cb21-76" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-77"><a href="#cb21-77" tabindex="-1"></a>          <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-78"><a href="#cb21-78" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb21-79"><a href="#cb21-79" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-80"><a href="#cb21-80" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb21-81"><a href="#cb21-81" tabindex="-1"></a>          <span class="at">legend.key =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-82"><a href="#cb21-82" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb21-83"><a href="#cb21-83" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>())</span>
<span id="cb21-84"><a href="#cb21-84" tabindex="-1"></a>  </span>
<span id="cb21-85"><a href="#cb21-85" tabindex="-1"></a></span>
<span id="cb21-86"><a href="#cb21-86" tabindex="-1"></a><span class="fu">plot_grid</span>(sfig4A, sfig4B, <span class="at">align =</span> <span class="st">&quot;h&quot;</span>, <span class="at">axis =</span> <span class="st">&quot;bt&quot;</span>)</span>
<span id="cb21-87"><a href="#cb21-87" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb21-88"><a href="#cb21-88" tabindex="-1"></a>                         <span class="st">&quot;metaAnalysis_Comparisons_SuppFigure4.png&quot;</span>),</span>
<span id="cb21-89"><a href="#cb21-89" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>,</span>
<span id="cb21-90"><a href="#cb21-90" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">5</span>,</span>
<span id="cb21-91"><a href="#cb21-91" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span></code></pre></div>
</div>
<div id="supp.-fig.-5-parallelization-decreases-runtime-of-invivopkfit" class="section level3">
<h3>Supp. Fig. 5: Parallelization decreases runtime of invivoPKfit</h3>
<p>Here I do a bit of benchmarking for the parallel-ized version of
do_fit</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="co"># Set to </span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>single_core <span class="ot">&lt;-</span> microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(<span class="fu">do_fit</span>(my_pk, <span class="at">n_cores =</span> <span class="dv">1</span>), <span class="at">times =</span> <span class="dv">3</span>)</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>four_core <span class="ot">&lt;-</span> microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(<span class="fu">do_fit</span>(my_pk, <span class="at">n_cores =</span> <span class="dv">4</span>), <span class="at">times =</span> <span class="dv">3</span>)</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="co"># eight_core &lt;- microbenchmark::microbenchmark(do_fit(my_pk, n_cores = 8), times = 3) # Only for four_DG</span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>ten_core <span class="ot">&lt;-</span> microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(<span class="fu">do_fit</span>(my_pk, <span class="at">n_cores =</span> <span class="dv">10</span>), <span class="at">times =</span> <span class="dv">3</span>)</span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>fourteen_core <span class="ot">&lt;-</span> microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>(<span class="fu">do_fit</span>(my_pk, <span class="at">n_cores =</span> <span class="dv">14</span>), <span class="at">times =</span> <span class="dv">3</span>)</span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" tabindex="-1"></a>single_core</span>
<span id="cb22-10"><a href="#cb22-10" tabindex="-1"></a>four_core</span>
<span id="cb22-11"><a href="#cb22-11" tabindex="-1"></a><span class="co"># eight_core</span></span>
<span id="cb22-12"><a href="#cb22-12" tabindex="-1"></a>ten_core</span>
<span id="cb22-13"><a href="#cb22-13" tabindex="-1"></a>fourteen_core</span>
<span id="cb22-14"><a href="#cb22-14" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" tabindex="-1"></a>four_DG <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">summary</span>(single_core),</span>
<span id="cb22-16"><a href="#cb22-16" tabindex="-1"></a>                     <span class="fu">summary</span>(four_core),</span>
<span id="cb22-17"><a href="#cb22-17" tabindex="-1"></a>                     <span class="fu">summary</span>(eight_core),</span>
<span id="cb22-18"><a href="#cb22-18" tabindex="-1"></a>                     <span class="fu">summary</span>(ten_core),</span>
<span id="cb22-19"><a href="#cb22-19" tabindex="-1"></a>                     <span class="fu">summary</span>(fourteen_core)) <span class="co"># Done ~ 140s</span></span>
<span id="cb22-20"><a href="#cb22-20" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" tabindex="-1"></a>eight_DG <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">summary</span>(single_core),</span>
<span id="cb22-22"><a href="#cb22-22" tabindex="-1"></a>                      <span class="fu">summary</span>(four_core),</span>
<span id="cb22-23"><a href="#cb22-23" tabindex="-1"></a>                      <span class="fu">summary</span>(ten_core),</span>
<span id="cb22-24"><a href="#cb22-24" tabindex="-1"></a>                      <span class="fu">summary</span>(fourteen_core)) <span class="co"># Done</span></span>
<span id="cb22-25"><a href="#cb22-25" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" tabindex="-1"></a>sixteen_DG <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">summary</span>(single_core),</span>
<span id="cb22-27"><a href="#cb22-27" tabindex="-1"></a>                        <span class="fu">summary</span>(four_core),</span>
<span id="cb22-28"><a href="#cb22-28" tabindex="-1"></a>                        <span class="fu">summary</span>(ten_core),</span>
<span id="cb22-29"><a href="#cb22-29" tabindex="-1"></a>                        <span class="fu">summary</span>(fourteen_core)) <span class="co"># Done</span></span>
<span id="cb22-30"><a href="#cb22-30" tabindex="-1"></a></span>
<span id="cb22-31"><a href="#cb22-31" tabindex="-1"></a></span>
<span id="cb22-32"><a href="#cb22-32" tabindex="-1"></a>my_pk <span class="sc">%&gt;%</span> <span class="fu">get_data</span>() <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Chemical, Species) <span class="sc">%&gt;%</span></span>
<span id="cb22-33"><a href="#cb22-33" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb22-34"><a href="#cb22-34" tabindex="-1"></a>my_pk <span class="sc">%&gt;%</span> <span class="fu">get_data</span>() <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Chemical) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="ot">-&gt;</span> used_chemicals</span>
<span id="cb22-35"><a href="#cb22-35" tabindex="-1"></a></span>
<span id="cb22-36"><a href="#cb22-36" tabindex="-1"></a>unused_cvt <span class="ot">&lt;-</span> cvt <span class="sc">%&gt;%</span></span>
<span id="cb22-37"><a href="#cb22-37" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>(chemicals_analyzed.dsstox_substance_id <span class="sc">%in%</span> used_chemicals))</span>
<span id="cb22-38"><a href="#cb22-38" tabindex="-1"></a></span>
<span id="cb22-39"><a href="#cb22-39" tabindex="-1"></a>new_chemicals <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">unique</span>(unused_cvt<span class="sc">$</span>chemicals_analyzed.dsstox_substance_id),</span>
<span id="cb22-40"><a href="#cb22-40" tabindex="-1"></a>                       <span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb22-41"><a href="#cb22-41" tabindex="-1"></a></span>
<span id="cb22-42"><a href="#cb22-42" tabindex="-1"></a>my_predata <span class="ot">&lt;-</span> cvt <span class="sc">%&gt;%</span></span>
<span id="cb22-43"><a href="#cb22-43" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(chemicals_analyzed.dsstox_substance_id <span class="sc">%in%</span> <span class="fu">union</span>(used_chemicals,</span>
<span id="cb22-44"><a href="#cb22-44" tabindex="-1"></a>                                                                  new_chemicals))</span>
<span id="cb22-45"><a href="#cb22-45" tabindex="-1"></a>my_predata <span class="sc">%&gt;%</span></span>
<span id="cb22-46"><a href="#cb22-46" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(chemicals_analyzed.dsstox_substance_id, subjects.species_harmonized) <span class="sc">%&gt;%</span></span>
<span id="cb22-47"><a href="#cb22-47" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span>
<span id="cb22-48"><a href="#cb22-48" tabindex="-1"></a></span>
<span id="cb22-49"><a href="#cb22-49" tabindex="-1"></a>my_pk <span class="ot">&lt;-</span> <span class="fu">pk</span>(<span class="at">data =</span> my_predata) <span class="sc">+</span></span>
<span id="cb22-50"><a href="#cb22-50" tabindex="-1"></a>  <span class="fu">facet_data</span>(<span class="fu">vars</span>(Chemical, Species)) <span class="sc">+</span></span>
<span id="cb22-51"><a href="#cb22-51" tabindex="-1"></a>  <span class="fu">settings_preprocess</span>(<span class="at">keep_data_original =</span> <span class="cn">TRUE</span>,</span>
<span id="cb22-52"><a href="#cb22-52" tabindex="-1"></a>                      <span class="at">suppress.messages =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb22-53"><a href="#cb22-53" tabindex="-1"></a>  <span class="fu">settings_optimx</span>(<span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;L-BFGS-B&quot;</span>, <span class="st">&quot;bobyqa&quot;</span>)) <span class="sc">+</span></span>
<span id="cb22-54"><a href="#cb22-54" tabindex="-1"></a>  <span class="fu">scale_conc</span>(<span class="at">dose_norm =</span> <span class="cn">TRUE</span>, <span class="at">log10_trans =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb22-55"><a href="#cb22-55" tabindex="-1"></a>  <span class="co"># scale_time(new_units = &quot;auto&quot;) +</span></span>
<span id="cb22-56"><a href="#cb22-56" tabindex="-1"></a>  <span class="co"># stat_model() + </span></span>
<span id="cb22-57"><a href="#cb22-57" tabindex="-1"></a>  <span class="fu">stat_error_model</span>(<span class="at">error_group =</span> <span class="fu">vars</span>(Chemical, Species))</span>
<span id="cb22-58"><a href="#cb22-58" tabindex="-1"></a>my_pk <span class="ot">&lt;-</span> <span class="fu">do_prefit</span>(my_pk) <span class="co"># Then run again</span></span>
<span id="cb22-59"><a href="#cb22-59" tabindex="-1"></a></span>
<span id="cb22-60"><a href="#cb22-60" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb22-61"><a href="#cb22-61" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb22-62"><a href="#cb22-62" tabindex="-1"></a><span class="co"># After getting all of them</span></span>
<span id="cb22-63"><a href="#cb22-63" tabindex="-1"></a>full_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb22-64"><a href="#cb22-64" tabindex="-1"></a>  four_DG <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">data_group_N =</span> <span class="dv">4</span>),</span>
<span id="cb22-65"><a href="#cb22-65" tabindex="-1"></a>  eight_DG <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">data_group_N =</span> <span class="dv">8</span>),</span>
<span id="cb22-66"><a href="#cb22-66" tabindex="-1"></a>  sixteen_DG <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">data_group_N =</span> <span class="dv">16</span>)</span>
<span id="cb22-67"><a href="#cb22-67" tabindex="-1"></a>)</span>
<span id="cb22-68"><a href="#cb22-68" tabindex="-1"></a></span>
<span id="cb22-69"><a href="#cb22-69" tabindex="-1"></a>full_df <span class="ot">&lt;-</span> full_df <span class="sc">%&gt;%</span></span>
<span id="cb22-70"><a href="#cb22-70" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">N_cores =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(expr, <span class="at">pattern =</span> <span class="st">&quot;[:digit:]+&quot;</span>)))</span>
<span id="cb22-71"><a href="#cb22-71" tabindex="-1"></a></span>
<span id="cb22-72"><a href="#cb22-72" tabindex="-1"></a>full_long <span class="ot">&lt;-</span> full_df <span class="sc">%&gt;%</span> </span>
<span id="cb22-73"><a href="#cb22-73" tabindex="-1"></a>         dplyr<span class="sc">::</span><span class="fu">select</span>(expr, N_cores, data_group_N, min, median, max) <span class="sc">%&gt;%</span></span>
<span id="cb22-74"><a href="#cb22-74" tabindex="-1"></a>         <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(min, median, max)) <span class="sc">%&gt;%</span></span>
<span id="cb22-75"><a href="#cb22-75" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name)</span>
<span id="cb22-76"><a href="#cb22-76" tabindex="-1"></a></span>
<span id="cb22-77"><a href="#cb22-77" tabindex="-1"></a>df_long <span class="ot">&lt;-</span> full_df <span class="sc">%&gt;%</span> </span>
<span id="cb22-78"><a href="#cb22-78" tabindex="-1"></a>         dplyr<span class="sc">::</span><span class="fu">select</span>(expr, N_cores, data_group_N, min, median, max) <span class="sc">%&gt;%</span></span>
<span id="cb22-79"><a href="#cb22-79" tabindex="-1"></a>         <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(min, median, max)) <span class="sc">%&gt;%</span></span>
<span id="cb22-80"><a href="#cb22-80" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(N_cores, data_group_N) <span class="sc">%&gt;%</span></span>
<span id="cb22-81"><a href="#cb22-81" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_val =</span> <span class="fu">mean</span>(value),</span>
<span id="cb22-82"><a href="#cb22-82" tabindex="-1"></a>            <span class="at">sd_val =</span> <span class="fu">sd</span>(value))</span>
<span id="cb22-83"><a href="#cb22-83" tabindex="-1"></a></span>
<span id="cb22-84"><a href="#cb22-84" tabindex="-1"></a><span class="fu">ggplot</span>(full_long,</span>
<span id="cb22-85"><a href="#cb22-85" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> N_cores,</span>
<span id="cb22-86"><a href="#cb22-86" tabindex="-1"></a>           <span class="at">y =</span> value,</span>
<span id="cb22-87"><a href="#cb22-87" tabindex="-1"></a>           <span class="at">color =</span> <span class="fu">factor</span>(data_group_N))) <span class="sc">+</span></span>
<span id="cb22-88"><a href="#cb22-88" tabindex="-1"></a>  </span>
<span id="cb22-89"><a href="#cb22-89" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb22-90"><a href="#cb22-90" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df_long,</span>
<span id="cb22-91"><a href="#cb22-91" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> N_cores,</span>
<span id="cb22-92"><a href="#cb22-92" tabindex="-1"></a>                <span class="at">y =</span> avg_val)) <span class="sc">+</span></span>
<span id="cb22-93"><a href="#cb22-93" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb22-94"><a href="#cb22-94" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of Cores&quot;</span>,</span>
<span id="cb22-95"><a href="#cb22-95" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Runtime (seconds)&quot;</span>,</span>
<span id="cb22-96"><a href="#cb22-96" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Data Groups&quot;</span>,</span>
<span id="cb22-97"><a href="#cb22-97" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Parallelization diminishes runtime at scale&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-98"><a href="#cb22-98" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="fl">1.5</span>),</span>
<span id="cb22-99"><a href="#cb22-99" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-100"><a href="#cb22-100" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb22-101"><a href="#cb22-101" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb22-102"><a href="#cb22-102" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-103"><a href="#cb22-103" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>())</span>
<span id="cb22-104"><a href="#cb22-104" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb22-105"><a href="#cb22-105" tabindex="-1"></a>              <span class="st">&quot;Parallelization_Benchmarking.png&quot;</span>),</span>
<span id="cb22-106"><a href="#cb22-106" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">4.5</span>,</span>
<span id="cb22-107"><a href="#cb22-107" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">3.5</span>,</span>
<span id="cb22-108"><a href="#cb22-108" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span></code></pre></div>
</div>
<div id="supp.-fig.-6-example-plots-for-data-fits" class="section level3">
<h3>Supp. Fig. 6: Example plots for data fits</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">plot</span>(my_pk, <span class="at">use_scale_conc =</span> <span class="cn">TRUE</span>, <span class="at">n_interp =</span> <span class="dv">10</span>)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="fu">names</span>(pl) <span class="co"># Chemical Species observations observation_plot predicted predicted_plot final_plot</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>s6_plA <span class="ot">&lt;-</span> pl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Chemical <span class="sc">%in%</span> <span class="st">&quot;DTXSID3031860&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>  <span class="fu">pull</span>(observation_plot) <span class="sc">%&gt;%</span> .[[<span class="dv">1</span>]]</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>s6_plB_mouse <span class="ot">&lt;-</span> pl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Chemical <span class="sc">%in%</span> <span class="st">&quot;DTXSID4020533&quot;</span>,</span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>                              Species <span class="sc">%in%</span> <span class="st">&quot;mouse&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(final_plot) <span class="sc">%&gt;%</span> .[[<span class="dv">1</span>]]</span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>s6_plB_rat <span class="ot">&lt;-</span> pl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Chemical <span class="sc">%in%</span> <span class="st">&quot;DTXSID4020533&quot;</span>,</span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a>                              Species <span class="sc">%in%</span> <span class="st">&quot;rat&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(final_plot) <span class="sc">%&gt;%</span> .[[<span class="dv">1</span>]]</span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a>s6_plC <span class="ot">&lt;-</span> pl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Chemical <span class="sc">%in%</span> <span class="st">&quot;DTXSID8021359&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a>  <span class="fu">pull</span>(final_plot) <span class="sc">%&gt;%</span> .[[<span class="dv">1</span>]]</span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a>s6_plD <span class="ot">&lt;-</span> pl <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Chemical <span class="sc">%in%</span> <span class="st">&quot;DTXSID8025337&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a>  <span class="fu">pull</span>(final_plot) <span class="sc">%&gt;%</span> .[[<span class="dv">1</span>]]</span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a><span class="co"># Set colors palettes for each</span></span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a><span class="co"># panel A : Oranges</span></span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a>panelA_cols <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&quot;Oranges&quot;</span>)[<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>]</span>
<span id="cb23-18"><a href="#cb23-18" tabindex="-1"></a><span class="co"># panel B : Greens</span></span>
<span id="cb23-19"><a href="#cb23-19" tabindex="-1"></a>panelB_cols <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&quot;Greens&quot;</span>)[<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>]</span>
<span id="cb23-20"><a href="#cb23-20" tabindex="-1"></a><span class="co"># panel C : Blue (only 2 values) </span></span>
<span id="cb23-21"><a href="#cb23-21" tabindex="-1"></a><span class="co"># panel D : Purple (6 values)</span></span>
<span id="cb23-22"><a href="#cb23-22" tabindex="-1"></a>panelD_cols <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&quot;Purples&quot;</span>)[<span class="dv">4</span><span class="sc">:</span><span class="dv">9</span>]</span>
<span id="cb23-23"><a href="#cb23-23" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" tabindex="-1"></a>s6_plA <span class="ot">&lt;-</span> s6_plA <span class="sc">+</span> </span>
<span id="cb23-25"><a href="#cb23-25" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;perfluorodecanoic acid&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-26"><a href="#cb23-26" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> panelA_cols, <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>)) <span class="sc">+</span></span>
<span id="cb23-27"><a href="#cb23-27" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb23-28"><a href="#cb23-28" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb23-29"><a href="#cb23-29" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>))</span>
<span id="cb23-30"><a href="#cb23-30" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" tabindex="-1"></a>s6_plB_mouse <span class="ot">&lt;-</span> s6_plB_mouse <span class="sc">+</span> </span>
<span id="cb23-32"><a href="#cb23-32" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;1,4-dioxane</span><span class="sc">\n</span><span class="st">Mouse&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-33"><a href="#cb23-33" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> panelB_cols[<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">8</span>)],</span>
<span id="cb23-34"><a href="#cb23-34" tabindex="-1"></a>                     <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>)) <span class="sc">+</span></span>
<span id="cb23-35"><a href="#cb23-35" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb23-36"><a href="#cb23-36" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb23-37"><a href="#cb23-37" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>))</span>
<span id="cb23-38"><a href="#cb23-38" tabindex="-1"></a></span>
<span id="cb23-39"><a href="#cb23-39" tabindex="-1"></a>s6_plB_rat <span class="ot">&lt;-</span> s6_plB_rat <span class="sc">+</span> </span>
<span id="cb23-40"><a href="#cb23-40" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;1,4-dioxane</span><span class="sc">\n</span><span class="st">Rat&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-41"><a href="#cb23-41" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> panelB_cols[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">6</span>,<span class="dv">8</span>)],</span>
<span id="cb23-42"><a href="#cb23-42" tabindex="-1"></a>                     <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>)) <span class="sc">+</span></span>
<span id="cb23-43"><a href="#cb23-43" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb23-44"><a href="#cb23-44" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb23-45"><a href="#cb23-45" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>))</span>
<span id="cb23-46"><a href="#cb23-46" tabindex="-1"></a></span>
<span id="cb23-47"><a href="#cb23-47" tabindex="-1"></a>s6_plC <span class="ot">&lt;-</span> s6_plC <span class="sc">+</span></span>
<span id="cb23-48"><a href="#cb23-48" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;tolbutamide&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-49"><a href="#cb23-49" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#6BAED6&quot;</span>, <span class="st">&quot;#08519C&quot;</span>),</span>
<span id="cb23-50"><a href="#cb23-50" tabindex="-1"></a>                     <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>)) <span class="sc">+</span></span>
<span id="cb23-51"><a href="#cb23-51" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb23-52"><a href="#cb23-52" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb23-53"><a href="#cb23-53" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>))</span>
<span id="cb23-54"><a href="#cb23-54" tabindex="-1"></a></span>
<span id="cb23-55"><a href="#cb23-55" tabindex="-1"></a>s6_plD <span class="ot">&lt;-</span> s6_plD <span class="sc">+</span></span>
<span id="cb23-56"><a href="#cb23-56" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;formamide&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-57"><a href="#cb23-57" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> panelD_cols,</span>
<span id="cb23-58"><a href="#cb23-58" tabindex="-1"></a>                     <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>)) <span class="sc">+</span></span>
<span id="cb23-59"><a href="#cb23-59" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb23-60"><a href="#cb23-60" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb23-61"><a href="#cb23-61" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>))</span>
<span id="cb23-62"><a href="#cb23-62" tabindex="-1"></a></span>
<span id="cb23-63"><a href="#cb23-63" tabindex="-1"></a><span class="co"># Put it all together</span></span>
<span id="cb23-64"><a href="#cb23-64" tabindex="-1"></a>s6_plB <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(s6_plB_mouse, s6_plB_rat,</span>
<span id="cb23-65"><a href="#cb23-65" tabindex="-1"></a>            <span class="at">align =</span> <span class="st">&quot;h&quot;</span>, <span class="at">axis =</span> <span class="st">&quot;bt&quot;</span>,</span>
<span id="cb23-66"><a href="#cb23-66" tabindex="-1"></a>           <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">1.2</span>,<span class="dv">2</span>))</span>
<span id="cb23-67"><a href="#cb23-67" tabindex="-1"></a></span>
<span id="cb23-68"><a href="#cb23-68" tabindex="-1"></a></span>
<span id="cb23-69"><a href="#cb23-69" tabindex="-1"></a>s6_plCD <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(s6_plC, s6_plD, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>), <span class="at">label_size =</span> <span class="dv">24</span>)</span>
<span id="cb23-70"><a href="#cb23-70" tabindex="-1"></a></span>
<span id="cb23-71"><a href="#cb23-71" tabindex="-1"></a></span>
<span id="cb23-72"><a href="#cb23-72" tabindex="-1"></a><span class="fu">plot_grid</span>(</span>
<span id="cb23-73"><a href="#cb23-73" tabindex="-1"></a>  s6_plA,</span>
<span id="cb23-74"><a href="#cb23-74" tabindex="-1"></a>  s6_plB,</span>
<span id="cb23-75"><a href="#cb23-75" tabindex="-1"></a>  s6_plCD,</span>
<span id="cb23-76"><a href="#cb23-76" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">&quot;v&quot;</span>,</span>
<span id="cb23-77"><a href="#cb23-77" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb23-78"><a href="#cb23-78" tabindex="-1"></a>  <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="fl">1.25</span>, <span class="dv">1</span>, <span class="fl">1.25</span>),</span>
<span id="cb23-79"><a href="#cb23-79" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;&quot;</span>),</span>
<span id="cb23-80"><a href="#cb23-80" tabindex="-1"></a>  <span class="at">label_size =</span> <span class="dv">24</span></span>
<span id="cb23-81"><a href="#cb23-81" tabindex="-1"></a>)</span>
<span id="cb23-82"><a href="#cb23-82" tabindex="-1"></a></span>
<span id="cb23-83"><a href="#cb23-83" tabindex="-1"></a><span class="co"># Am making this 2X the size I need it to be </span></span>
<span id="cb23-84"><a href="#cb23-84" tabindex="-1"></a><span class="co"># so the points are a reasonable size when I scale it down</span></span>
<span id="cb23-85"><a href="#cb23-85" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb23-86"><a href="#cb23-86" tabindex="-1"></a>              <span class="st">&quot;ExampleFitsPlots_11.30.2023.png&quot;</span>),</span>
<span id="cb23-87"><a href="#cb23-87" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">13</span>,</span>
<span id="cb23-88"><a href="#cb23-88" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">14</span>,</span>
<span id="cb23-89"><a href="#cb23-89" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span></code></pre></div>
<p>Here I decide to investigate data where fits were aborted and how
many time-points occurred before non-compartmental t<sub>max</sub>,
which essentially asks whether there are enough detectable (above LOQ)
data points to model absorption. As a threshold for whether absorption
can be modeled, I count those that have at least more than one data
point prior to the empirical t<sub>max</sub>. With at least three points
(including t<sub>max</sub>) we can reasonably begin to assess the
absorption of a compound.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>my_pk<span class="sc">$</span>prefit<span class="sc">$</span>fit_check <span class="sc">%&gt;%</span> <span class="fu">filter</span>(fit_decision <span class="sc">==</span> <span class="st">&quot;abort&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(model, Chemical) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>all_my_data <span class="sc">%&gt;%</span></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>  <span class="fu">filter</span>(Chemical <span class="sc">==</span> <span class="st">&quot;DTXSID2021315&quot;</span>)</span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a><span class="co"># On average, how many time-points before tmax (empirical)?</span></span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a>my_nca <span class="sc">%&gt;%</span> <span class="fu">filter</span>(param_name <span class="sc">%in%</span> <span class="st">&quot;tmax&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Chemical, Species, Route, Media, <span class="at">tmax.nca =</span> param_value) <span class="sc">%&gt;%</span></span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a>  <span class="fu">left_join</span>(all_my_data) <span class="sc">%&gt;%</span></span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a>  <span class="fu">filter</span>(Route <span class="sc">%in%</span> <span class="st">&quot;oral&quot;</span>, Time <span class="sc">&lt;</span> tmax.nca) <span class="sc">%&gt;%</span></span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a>  <span class="fu">distinct</span>(Chemical, Chemical_Name, Species, Route, Media, Detect, Time) <span class="sc">%&gt;%</span></span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical, Chemical_Name, Species, Route, Media, Detect) <span class="sc">%&gt;%</span></span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">name =</span> <span class="st">&quot;tp_before_tmax&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a>  <span class="fu">filter</span>(Detect <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-20"><a href="#cb24-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>Detect) <span class="sc">%&gt;%</span></span>
<span id="cb24-21"><a href="#cb24-21" tabindex="-1"></a>  <span class="fu">arrange</span>(tp_before_tmax) <span class="sc">%&gt;%</span></span>
<span id="cb24-22"><a href="#cb24-22" tabindex="-1"></a>  <span class="fu">count</span>(tp_before_tmax <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb24-23"><a href="#cb24-23" tabindex="-1"></a>  </span></code></pre></div>
<p>Here I introduce the notion whether the data is variable compared
across time.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>my_residuals <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>  <span class="fu">filter</span>(exclude <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>  <span class="fu">inner_join</span>(winmodel) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>  <span class="fu">inner_join</span>(my_tkstats <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(Chemical, Species,</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>                            Route, Media,</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>                            <span class="at">tmax =</span> tmax.tkstats) <span class="sc">%&gt;%</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>              <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(tmax))) <span class="sc">%&gt;%</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical,</span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>           Species,</span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>           Route,</span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>           Media,</span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>           Dose) <span class="sc">%&gt;%</span></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a>         <span class="at">normTime =</span> <span class="fu">ifelse</span>(</span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a>           Route <span class="sc">==</span> <span class="st">&quot;iv&quot;</span>,</span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a>           <span class="dv">1</span> <span class="sc">+</span> Time<span class="sc">/</span><span class="fu">max</span>(Time),</span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a>           <span class="fu">ifelse</span>(</span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a>             Time <span class="sc">&gt;</span> tmax,</span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a>             ((Time <span class="sc">-</span> tmax)<span class="sc">/</span><span class="fu">max</span>(Time)) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a>             <span class="fl">0.5</span> <span class="sc">+</span> Time<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>tmax)</span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a>           )</span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a>         )) <span class="sc">%&gt;%</span></span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a>  <span class="fu">filter</span>(Detect <span class="sc">%in%</span> <span class="cn">TRUE</span>) <span class="ot">-&gt;</span> my_residuals2</span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a>my_residuals2 <span class="sc">%&gt;%</span></span>
<span id="cb25-27"><a href="#cb25-27" tabindex="-1"></a>  <span class="co"># filter(Route == &quot;oral&quot;) %&gt;% View()</span></span>
<span id="cb25-28"><a href="#cb25-28" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb25-29"><a href="#cb25-29" tabindex="-1"></a>    <span class="at">x =</span> normTime,</span>
<span id="cb25-30"><a href="#cb25-30" tabindex="-1"></a>    <span class="at">y =</span> Residuals</span>
<span id="cb25-31"><a href="#cb25-31" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb25-32"><a href="#cb25-32" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb25-33"><a href="#cb25-33" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(my_residuals2,</span>
<span id="cb25-34"><a href="#cb25-34" tabindex="-1"></a>                           Chemical <span class="sc">%in%</span> <span class="st">&quot;DTXSID4020533&quot;</span>,</span>
<span id="cb25-35"><a href="#cb25-35" tabindex="-1"></a>                           Species <span class="sc">%in%</span> <span class="st">&quot;rat&quot;</span>),</span>
<span id="cb25-36"><a href="#cb25-36" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;orange2&quot;</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb25-37"><a href="#cb25-37" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(my_residuals2,</span>
<span id="cb25-38"><a href="#cb25-38" tabindex="-1"></a>                           Chemical <span class="sc">%in%</span> <span class="st">&quot;DTXSID8031865&quot;</span>,</span>
<span id="cb25-39"><a href="#cb25-39" tabindex="-1"></a>                           Species <span class="sc">%in%</span> <span class="st">&quot;rat&quot;</span>),</span>
<span id="cb25-40"><a href="#cb25-40" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;magenta4&quot;</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb25-41"><a href="#cb25-41" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(my_residuals2,</span>
<span id="cb25-42"><a href="#cb25-42" tabindex="-1"></a>                           Chemical <span class="sc">%in%</span> <span class="st">&quot;DTXSID8025337&quot;</span>,</span>
<span id="cb25-43"><a href="#cb25-43" tabindex="-1"></a>                           Species <span class="sc">%in%</span> <span class="st">&quot;rat&quot;</span>),</span>
<span id="cb25-44"><a href="#cb25-44" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;green2&quot;</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb25-45"><a href="#cb25-45" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb25-46"><a href="#cb25-46" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;green4&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb25-47"><a href="#cb25-47" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(Route),</span>
<span id="cb25-48"><a href="#cb25-48" tabindex="-1"></a>             <span class="co"># rows = vars(model),</span></span>
<span id="cb25-49"><a href="#cb25-49" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb25-50"><a href="#cb25-50" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;ADME-Normalized Time&quot;</span>,</span>
<span id="cb25-51"><a href="#cb25-51" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Winning Model Residuals&quot;</span>) <span class="sc">+</span></span>
<span id="cb25-52"><a href="#cb25-52" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb25-53"><a href="#cb25-53" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="fl">1.5</span>),</span>
<span id="cb25-54"><a href="#cb25-54" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-55"><a href="#cb25-55" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey90&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>),</span>
<span id="cb25-56"><a href="#cb25-56" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>),</span>
<span id="cb25-57"><a href="#cb25-57" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb25-58"><a href="#cb25-58" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-59"><a href="#cb25-59" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-60"><a href="#cb25-60" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb25-61"><a href="#cb25-61" tabindex="-1"></a></span>
<span id="cb25-62"><a href="#cb25-62" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb25-63"><a href="#cb25-63" tabindex="-1"></a>              <span class="st">&quot;ADME_NormalizedTime-WinModelResiduals_onlyDetects_Highlighted_2023-07-19.png&quot;</span>),</span>
<span id="cb25-64"><a href="#cb25-64" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb25-65"><a href="#cb25-65" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb25-66"><a href="#cb25-66" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>)</span></code></pre></div>
<p>I try to find the connections between functions in
<em>invivoPKfit</em> to best understand and represent the structure of
the package.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>fw <span class="ot">&lt;-</span> mvbutils<span class="sc">::</span><span class="fu">foodweb</span>(<span class="at">where =</span> <span class="fu">asNamespace</span>(<span class="st">&quot;invivoPKfit&quot;</span>),</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>                        <span class="at">border =</span> <span class="cn">TRUE</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>)</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>fun_mat <span class="ot">&lt;-</span> fw<span class="sc">$</span>funmat</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>mvbutils<span class="sc">::</span><span class="fu">foodweb</span>(<span class="at">where =</span> <span class="fu">asNamespace</span>(<span class="st">&quot;invivoPKfit&quot;</span>),</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>                  <span class="at">prune =</span> <span class="st">&quot;calc_auc&quot;</span>,</span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>                  <span class="co"># descendants = FALSE,</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>                  <span class="co"># ancestors = FALSE,</span></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>                  <span class="at">border =</span> <span class="cn">TRUE</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>)</span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a><span class="co"># Predict dependents: rmse, residuals, rsq, calc_auc, fold_errors, plot</span></span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a><span class="co"># Coef dependents: calc_auc, predict, get_tkstats, summary,log_Lik, coef_sd</span></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a><span class="co"># list of all functions and methods</span></span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a>fm <span class="ot">&lt;-</span> <span class="fu">ls</span>(<span class="fu">asNamespace</span>(<span class="st">&quot;invivoPKfit&quot;</span>))</span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a>fm <span class="ot">&lt;-</span> fm[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;.default&quot;</span>, <span class="at">x =</span> fm)]</span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a>              <span class="st">&quot;NonDefaultFunction_Connections.pdf&quot;</span>),</span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">8</span>)</span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> fm) {</span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a>  mvbutils<span class="sc">::</span><span class="fu">foodweb</span>(<span class="at">where =</span> <span class="fu">asNamespace</span>(<span class="st">&quot;invivoPKfit&quot;</span>),</span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a>                  <span class="at">prune =</span> i,</span>
<span id="cb26-24"><a href="#cb26-24" tabindex="-1"></a>                  <span class="co"># descendants = FALSE,</span></span>
<span id="cb26-25"><a href="#cb26-25" tabindex="-1"></a>                  <span class="co"># ancestors = FALSE,</span></span>
<span id="cb26-26"><a href="#cb26-26" tabindex="-1"></a>                  <span class="at">border =</span> <span class="cn">TRUE</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>)</span>
<span id="cb26-27"><a href="#cb26-27" tabindex="-1"></a>}</span>
<span id="cb26-28"><a href="#cb26-28" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
</div>
<div id="other-plots" class="section level2">
<h2>Other Plots</h2>
<div id="plotting-all-fits-for-dose-normalized-joint-fits-l-bfgs-b" class="section level3">
<h3>Plotting ALL fits for Dose-normalized Joint fits (L-BFGS-B)</h3>
<p>Here is the code used to generate the CvT data and
<em>invivoPKfit</em> fits for each chemical, species data group.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="do">### Plotting for all (2.5MB file)</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">plot</span>(my_pk, <span class="at">n_interp =</span> <span class="dv">8</span>, <span class="at">use_scale_conc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>              <span class="st">&quot;DoseNormalized_Joint_AllFits_Final.pdf&quot;</span>),</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">10</span>)</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pl)) {</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>  <span class="fu">print</span>(pl<span class="sc">$</span>final_plot[[i]])</span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a>}</span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a><span class="co"># From my new SQL pull</span></span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">plot</span>(my_pk, <span class="at">n_interp =</span> <span class="dv">8</span>, <span class="at">use_scale_conc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a>              <span class="st">&quot;NormalizedUpdate_NewCvT_SQLquery.pdf&quot;</span>),</span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">10</span>)</span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pl)) {</span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a>  <span class="fu">print</span>(pl<span class="sc">$</span>final_plot[[i]])</span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a>}</span>
<span id="cb27-19"><a href="#cb27-19" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
</div>
<div id="figure-2-example-fits-to-explain-joint-vs-pooled-models" class="section level3">
<h3>Figure 2: Example Fits to Explain Joint vs Pooled Models</h3>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="co"># Note that the data will run one &quot;Series&quot; of time point at a time</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>my_1comp <span class="ot">&lt;-</span> <span class="cf">function</span>(t, F_V, kelim, kabs, <span class="at">sd =</span> <span class="dv">0</span>) {</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>  sd <span class="sc">+</span> (F_V <span class="sc">*</span> (kabs <span class="sc">*</span> (<span class="fu">exp</span>(<span class="sc">-</span>kelim <span class="sc">*</span> t) <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>kabs <span class="sc">*</span> t))) <span class="sc">/</span> (kabs <span class="sc">-</span> kelim))</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>}</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>my_cdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>  <span class="at">Reference =</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;O&quot;</span>), <span class="at">each =</span> <span class="dv">3</span>), <span class="dv">6</span>),</span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>  <span class="at">Time =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">12</span>), <span class="at">each =</span> <span class="dv">6</span>),</span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a>  <span class="at">Concentration =</span> <span class="fu">c</span>(</span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a>    <span class="dv">4</span>, <span class="dv">5</span>, <span class="fl">6.5</span>,</span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a>    <span class="fl">4.5</span>, <span class="dv">5</span>, <span class="dv">6</span>,</span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a>    <span class="dv">8</span>, <span class="dv">9</span>, <span class="fl">9.5</span>,</span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a>    <span class="fl">7.5</span>, <span class="dv">8</span>, <span class="fl">8.5</span>,</span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a>    <span class="dv">3</span>, <span class="fl">4.5</span>, <span class="dv">6</span>,</span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a>    <span class="fl">3.5</span>, <span class="dv">4</span>, <span class="dv">5</span>,</span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a>    <span class="dv">2</span>, <span class="fl">2.5</span>, <span class="dv">4</span>,</span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a>    <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="fl">2.25</span>,</span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a>    <span class="fl">0.4</span>, <span class="dv">1</span>, <span class="dv">2</span>,</span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a>    <span class="fl">0.4</span>, <span class="fl">0.8</span>, <span class="dv">1</span>,</span>
<span id="cb28-20"><a href="#cb28-20" tabindex="-1"></a>    <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="dv">1</span>,</span>
<span id="cb28-21"><a href="#cb28-21" tabindex="-1"></a>    <span class="fl">0.25</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span></span>
<span id="cb28-22"><a href="#cb28-22" tabindex="-1"></a>  ) </span>
<span id="cb28-23"><a href="#cb28-23" tabindex="-1"></a>)</span>
<span id="cb28-24"><a href="#cb28-24" tabindex="-1"></a></span>
<span id="cb28-25"><a href="#cb28-25" tabindex="-1"></a></span>
<span id="cb28-26"><a href="#cb28-26" tabindex="-1"></a>pl_pool <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb28-27"><a href="#cb28-27" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> my_cdata,</span>
<span id="cb28-28"><a href="#cb28-28" tabindex="-1"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb28-29"><a href="#cb28-29" tabindex="-1"></a>               <span class="at">x =</span> Time,</span>
<span id="cb28-30"><a href="#cb28-30" tabindex="-1"></a>               <span class="at">y =</span> Concentration,</span>
<span id="cb28-31"><a href="#cb28-31" tabindex="-1"></a>               <span class="at">color =</span> Reference</span>
<span id="cb28-32"><a href="#cb28-32" tabindex="-1"></a>             ),</span>
<span id="cb28-33"><a href="#cb28-33" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.4</span>),</span>
<span id="cb28-34"><a href="#cb28-34" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb28-35"><a href="#cb28-35" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb28-36"><a href="#cb28-36" tabindex="-1"></a>    <span class="at">fun =</span> my_1comp,</span>
<span id="cb28-37"><a href="#cb28-37" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">list</span>(<span class="at">F_V =</span> <span class="dv">20</span>, <span class="at">kelim =</span> <span class="fl">0.6</span>, <span class="at">kabs =</span> <span class="fl">0.8</span>),</span>
<span id="cb28-38"><a href="#cb28-38" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb28-39"><a href="#cb28-39" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb28-40"><a href="#cb28-40" tabindex="-1"></a>    <span class="at">fun =</span> my_1comp,</span>
<span id="cb28-41"><a href="#cb28-41" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">list</span>(<span class="at">F_V =</span> <span class="dv">20</span>, <span class="at">kelim =</span> <span class="fl">0.6</span>, <span class="at">kabs =</span> <span class="fl">0.8</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb28-42"><a href="#cb28-42" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-43"><a href="#cb28-43" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb28-44"><a href="#cb28-44" tabindex="-1"></a>    <span class="at">fun =</span> my_1comp,</span>
<span id="cb28-45"><a href="#cb28-45" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">list</span>(<span class="at">F_V =</span> <span class="dv">20</span>, <span class="at">kelim =</span> <span class="fl">0.6</span>, <span class="at">kabs =</span> <span class="fl">0.8</span>, <span class="at">sd =</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb28-46"><a href="#cb28-46" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-47"><a href="#cb28-47" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">pretty_breaks</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb28-48"><a href="#cb28-48" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">pretty_breaks</span>(<span class="dv">13</span>)) <span class="sc">+</span></span>
<span id="cb28-49"><a href="#cb28-49" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb28-50"><a href="#cb28-50" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb28-51"><a href="#cb28-51" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb28-52"><a href="#cb28-52" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb28-53"><a href="#cb28-53" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb28-54"><a href="#cb28-54" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">lineend =</span> <span class="st">&quot;square&quot;</span>),</span>
<span id="cb28-55"><a href="#cb28-55" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb28-56"><a href="#cb28-56" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>), <span class="st">&quot;PooledExampleFigure.png&quot;</span>),</span>
<span id="cb28-57"><a href="#cb28-57" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb28-58"><a href="#cb28-58" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb28-59"><a href="#cb28-59" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">5</span>,</span>
<span id="cb28-60"><a href="#cb28-60" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb28-61"><a href="#cb28-61" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb28-62"><a href="#cb28-62" tabindex="-1"></a></span>
<span id="cb28-63"><a href="#cb28-63" tabindex="-1"></a><span class="co"># Change shape(s) from circles</span></span>
<span id="cb28-64"><a href="#cb28-64" tabindex="-1"></a>pl_joint <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb28-65"><a href="#cb28-65" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> my_cdata,</span>
<span id="cb28-66"><a href="#cb28-66" tabindex="-1"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb28-67"><a href="#cb28-67" tabindex="-1"></a>               <span class="at">x =</span> Time,</span>
<span id="cb28-68"><a href="#cb28-68" tabindex="-1"></a>               <span class="at">y =</span> Concentration,</span>
<span id="cb28-69"><a href="#cb28-69" tabindex="-1"></a>               <span class="at">color =</span> Reference,</span>
<span id="cb28-70"><a href="#cb28-70" tabindex="-1"></a>               <span class="at">shape =</span> Reference</span>
<span id="cb28-71"><a href="#cb28-71" tabindex="-1"></a>             ),</span>
<span id="cb28-72"><a href="#cb28-72" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.4</span>),</span>
<span id="cb28-73"><a href="#cb28-73" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb28-74"><a href="#cb28-74" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb28-75"><a href="#cb28-75" tabindex="-1"></a>    <span class="at">fun =</span> my_1comp,</span>
<span id="cb28-76"><a href="#cb28-76" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">list</span>(<span class="at">F_V =</span> <span class="dv">20</span>, <span class="at">kelim =</span> <span class="fl">0.6</span>, <span class="at">kabs =</span> <span class="fl">0.8</span>),</span>
<span id="cb28-77"><a href="#cb28-77" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb28-78"><a href="#cb28-78" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb28-79"><a href="#cb28-79" tabindex="-1"></a>    <span class="at">fun =</span> my_1comp,</span>
<span id="cb28-80"><a href="#cb28-80" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">list</span>(<span class="at">F_V =</span> <span class="dv">20</span>, <span class="at">kelim =</span> <span class="fl">0.6</span>, <span class="at">kabs =</span> <span class="fl">0.8</span>, <span class="at">sd =</span> <span class="fl">1.3</span>),</span>
<span id="cb28-81"><a href="#cb28-81" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;green4&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-82"><a href="#cb28-82" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb28-83"><a href="#cb28-83" tabindex="-1"></a>    <span class="at">fun =</span> my_1comp,</span>
<span id="cb28-84"><a href="#cb28-84" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">list</span>(<span class="at">F_V =</span> <span class="dv">20</span>, <span class="at">kelim =</span> <span class="fl">0.6</span>, <span class="at">kabs =</span> <span class="fl">0.8</span>, <span class="at">sd =</span> <span class="sc">-</span><span class="fl">1.3</span>),</span>
<span id="cb28-85"><a href="#cb28-85" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;green4&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-86"><a href="#cb28-86" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb28-87"><a href="#cb28-87" tabindex="-1"></a>    <span class="at">fun =</span> my_1comp,</span>
<span id="cb28-88"><a href="#cb28-88" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">list</span>(<span class="at">F_V =</span> <span class="dv">20</span>, <span class="at">kelim =</span> <span class="fl">0.6</span>, <span class="at">kabs =</span> <span class="fl">0.8</span>, <span class="at">sd =</span> <span class="fl">0.7</span>),</span>
<span id="cb28-89"><a href="#cb28-89" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;magenta3&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-90"><a href="#cb28-90" tabindex="-1"></a>  <span class="fu">stat_function</span>(</span>
<span id="cb28-91"><a href="#cb28-91" tabindex="-1"></a>    <span class="at">fun =</span> my_1comp,</span>
<span id="cb28-92"><a href="#cb28-92" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">list</span>(<span class="at">F_V =</span> <span class="dv">20</span>, <span class="at">kelim =</span> <span class="fl">0.6</span>, <span class="at">kabs =</span> <span class="fl">0.8</span>, <span class="at">sd =</span> <span class="sc">-</span><span class="fl">0.7</span>),</span>
<span id="cb28-93"><a href="#cb28-93" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;magenta3&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-94"><a href="#cb28-94" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">pretty_breaks</span>(<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb28-95"><a href="#cb28-95" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">pretty_breaks</span>(<span class="dv">13</span>)) <span class="sc">+</span></span>
<span id="cb28-96"><a href="#cb28-96" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;magenta3&quot;</span>, <span class="st">&quot;green4&quot;</span>)) <span class="sc">+</span></span>
<span id="cb28-97"><a href="#cb28-97" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">17</span>)) <span class="sc">+</span></span>
<span id="cb28-98"><a href="#cb28-98" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb28-99"><a href="#cb28-99" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb28-100"><a href="#cb28-100" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb28-101"><a href="#cb28-101" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb28-102"><a href="#cb28-102" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">lineend =</span> <span class="st">&quot;square&quot;</span>),</span>
<span id="cb28-103"><a href="#cb28-103" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb28-104"><a href="#cb28-104" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb28-105"><a href="#cb28-105" tabindex="-1"></a></span>
<span id="cb28-106"><a href="#cb28-106" tabindex="-1"></a>pl_joint</span>
<span id="cb28-107"><a href="#cb28-107" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>), <span class="st">&quot;JointExampleFigure.png&quot;</span>),</span>
<span id="cb28-108"><a href="#cb28-108" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb28-109"><a href="#cb28-109" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">4</span>,</span>
<span id="cb28-110"><a href="#cb28-110" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">5</span>,</span>
<span id="cb28-111"><a href="#cb28-111" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb28-112"><a href="#cb28-112" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb28-113"><a href="#cb28-113" tabindex="-1"></a></span>
<span id="cb28-114"><a href="#cb28-114" tabindex="-1"></a></span>
<span id="cb28-115"><a href="#cb28-115" tabindex="-1"></a><span class="fu">plot_grid</span>(pl_pool, pl_joint,</span>
<span id="cb28-116"><a href="#cb28-116" tabindex="-1"></a>          <span class="at">align =</span> <span class="st">&quot;h&quot;</span>, <span class="at">axis =</span> <span class="st">&quot;bt&quot;</span>)</span>
<span id="cb28-117"><a href="#cb28-117" tabindex="-1"></a></span>
<span id="cb28-118"><a href="#cb28-118" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>),</span>
<span id="cb28-119"><a href="#cb28-119" tabindex="-1"></a>                         <span class="st">&quot;Pooled_Joint_ExampleFigure.png&quot;</span>),</span>
<span id="cb28-120"><a href="#cb28-120" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb28-121"><a href="#cb28-121" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">3.4</span>,</span>
<span id="cb28-122"><a href="#cb28-122" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">6.5</span>,</span>
<span id="cb28-123"><a href="#cb28-123" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb28-124"><a href="#cb28-124" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb28-125"><a href="#cb28-125" tabindex="-1"></a></span>
<span id="cb28-126"><a href="#cb28-126" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">point_size =</span> <span class="fu">seq</span>(<span class="fl">0.2</span>, <span class="dv">3</span>, <span class="at">by =</span> <span class="fl">0.2</span>)),</span>
<span id="cb28-127"><a href="#cb28-127" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(point_size), <span class="at">size =</span> point_size)) <span class="sc">+</span></span>
<span id="cb28-128"><a href="#cb28-128" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">y =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb28-129"><a href="#cb28-129" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb28-130"><a href="#cb28-130" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb28-131"><a href="#cb28-131" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb28-132"><a href="#cb28-132" tabindex="-1"></a></span>
<span id="cb28-133"><a href="#cb28-133" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;FIG_DIR&quot;</span>), <span class="st">&quot;Point_Reference_3x5.png&quot;</span>),</span>
<span id="cb28-134"><a href="#cb28-134" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">&quot;in&quot;</span>,</span>
<span id="cb28-135"><a href="#cb28-135" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">3</span>,</span>
<span id="cb28-136"><a href="#cb28-136" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">5</span>,</span>
<span id="cb28-137"><a href="#cb28-137" tabindex="-1"></a>       <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb28-138"><a href="#cb28-138" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">300</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="preparing-results-for-cvtdb" class="section level1">
<h1>Preparing results for CvTdb</h1>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>my_cvt <span class="ot">&lt;-</span> cvt</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>my_tkstats <span class="ot">&lt;-</span> <span class="fu">eval_tkstats</span>(my_pk)</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>  </span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>my_cvt_unique <span class="ot">&lt;-</span> my_cvt <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>  <span class="at">preprocess_data_flags =</span> </span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>    <span class="fu">case_when</span>(</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>      (other_study_identifier <span class="sc">%in%</span> <span class="st">&quot;S0916&quot;</span>) <span class="sc">~</span> <span class="fu">paste</span>(<span class="st">&quot;Adjusted dose_level_original_units&quot;</span>,</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a>                                                              <span class="st">&quot;adjusted dose_level_normalized.&quot;</span>,</span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a>                                                              <span class="at">sep =</span> <span class="st">&quot; and &quot;</span>),</span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a>      (other_study_identifier <span class="sc">%in%</span> <span class="st">&quot;S0624&quot;</span>) <span class="sc">~</span> <span class="fu">paste</span>(<span class="st">&quot;Adjusted dose_level_normalized.&quot;</span>),</span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a>      (document_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;65&quot;</span>, <span class="st">&quot;61&quot;</span>, <span class="st">&quot;46&quot;</span>, <span class="st">&quot;31&quot;</span>)) <span class="sc">~</span> <span class="fu">paste</span>(<span class="st">&quot;Adjusted analyte_dtxsid&quot;</span>,</span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a>                                                           <span class="st">&quot;adjusted analyte_name_original.&quot;</span>,</span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a>                                                           <span class="at">sep =</span> <span class="st">&quot; and &quot;</span>),</span>
<span id="cb29-15"><a href="#cb29-15" tabindex="-1"></a>      (other_study_identifier <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;S0976&quot;</span>,</span>
<span id="cb29-16"><a href="#cb29-16" tabindex="-1"></a>                                     <span class="st">&quot;S0361&quot;</span>,</span>
<span id="cb29-17"><a href="#cb29-17" tabindex="-1"></a>                                     <span class="st">&quot;S0328&quot;</span>)) <span class="sc">~</span> <span class="fu">paste</span>(<span class="st">&quot;Adjusted loq and loq_units.&quot;</span>),</span>
<span id="cb29-18"><a href="#cb29-18" tabindex="-1"></a>      (document_id <span class="sc">%in%</span> <span class="st">&quot;38&quot;</span>) <span class="sc">~</span> <span class="fu">paste</span>(<span class="st">&quot;Adjusted conc.&quot;</span>),</span>
<span id="cb29-19"><a href="#cb29-19" tabindex="-1"></a>      (analyte_name_original <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;n-desmethyltamoxifen&quot;</span>,</span>
<span id="cb29-20"><a href="#cb29-20" tabindex="-1"></a>                                    <span class="st">&quot;methemoglobin&quot;</span>)) <span class="sc">~</span> <span class="fu">paste</span>(<span class="st">&quot;Adjusted analyte_dtxsid.&quot;</span>),</span>
<span id="cb29-21"><a href="#cb29-21" tabindex="-1"></a>      <span class="at">.default =</span> <span class="cn">NA_character_</span></span>
<span id="cb29-22"><a href="#cb29-22" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span></span>
<span id="cb29-23"><a href="#cb29-23" tabindex="-1"></a>  <span class="fu">group_by</span>(analyte_dtxsid, species,</span>
<span id="cb29-24"><a href="#cb29-24" tabindex="-1"></a>    administration_route_normalized, conc_medium_normalized, preprocess_data_flags) <span class="sc">%&gt;%</span></span>
<span id="cb29-25"><a href="#cb29-25" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">document_ids =</span> <span class="fu">paste0</span>(<span class="fu">unique</span>(document_id), <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>))</span>
<span id="cb29-26"><a href="#cb29-26" tabindex="-1"></a></span>
<span id="cb29-27"><a href="#cb29-27" tabindex="-1"></a><span class="co"># Non-compartmental analysis</span></span>
<span id="cb29-28"><a href="#cb29-28" tabindex="-1"></a>my_nca <span class="ot">&lt;-</span> <span class="fu">get_nca</span>(my_pk) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>param_units) <span class="sc">%&gt;%</span></span>
<span id="cb29-29"><a href="#cb29-29" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param_name =</span> <span class="fu">paste0</span>(param_name, <span class="st">&quot;.nca&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-30"><a href="#cb29-30" tabindex="-1"></a>  <span class="fu">group_by</span>(Chemical, Species,</span>
<span id="cb29-31"><a href="#cb29-31" tabindex="-1"></a>           Route, Media, design) <span class="sc">%&gt;%</span></span>
<span id="cb29-32"><a href="#cb29-32" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> param_name,</span>
<span id="cb29-33"><a href="#cb29-33" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="fu">c</span>(param_value, param_sd_z)) <span class="sc">%&gt;%</span></span>
<span id="cb29-34"><a href="#cb29-34" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-35"><a href="#cb29-35" tabindex="-1"></a>  <span class="fu">arrange</span>(Chemical) <span class="sc">%&gt;%</span></span>
<span id="cb29-36"><a href="#cb29-36" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="at">.fn =</span> <span class="sc">~</span><span class="fu">gsub</span>(<span class="st">&quot;param_&quot;</span>, <span class="st">&quot;&quot;</span>, .x)) <span class="sc">%&gt;%</span></span>
<span id="cb29-37"><a href="#cb29-37" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="at">.fn =</span> <span class="sc">~</span><span class="fu">gsub</span>(<span class="st">&quot;value_&quot;</span>, <span class="st">&quot;&quot;</span>, .x)) <span class="sc">%&gt;%</span></span>
<span id="cb29-38"><a href="#cb29-38" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">analyte_dtxsid =</span> Chemical,</span>
<span id="cb29-39"><a href="#cb29-39" tabindex="-1"></a>         <span class="at">species =</span> Species,</span>
<span id="cb29-40"><a href="#cb29-40" tabindex="-1"></a>         <span class="at">administration_route_normalized =</span> Route,</span>
<span id="cb29-41"><a href="#cb29-41" tabindex="-1"></a>         <span class="at">conc_medium_normalized =</span> Media)</span>
<span id="cb29-42"><a href="#cb29-42" tabindex="-1"></a></span>
<span id="cb29-43"><a href="#cb29-43" tabindex="-1"></a></span>
<span id="cb29-44"><a href="#cb29-44" tabindex="-1"></a>my_cvt <span class="sc">%&gt;%</span></span>
<span id="cb29-45"><a href="#cb29-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(analyte_dtxsid, species, radiolabeled) <span class="sc">%&gt;%</span></span>
<span id="cb29-46"><a href="#cb29-46" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-47"><a href="#cb29-47" tabindex="-1"></a>  <span class="fu">filter</span>(analyte_dtxsid <span class="sc">%in%</span> (cvt <span class="sc">%&gt;%</span> <span class="fu">filter</span>(radiolabeled) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(analyte_dtxsid)))</span>
<span id="cb29-48"><a href="#cb29-48" tabindex="-1"></a></span>
<span id="cb29-49"><a href="#cb29-49" tabindex="-1"></a><span class="co"># Writing to file</span></span>
<span id="cb29-50"><a href="#cb29-50" tabindex="-1"></a><span class="fu">left_join</span>(my_nca, my_cvt_unique) <span class="sc">%&gt;%</span></span>
<span id="cb29-51"><a href="#cb29-51" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-52"><a href="#cb29-52" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.infinite</span>(AUC_infinity.nca), <span class="sc">!</span><span class="fu">is.infinite</span>(AUMC_infinity.nca)) <span class="sc">%&gt;%</span></span>
<span id="cb29-53"><a href="#cb29-53" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-54"><a href="#cb29-54" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nca_id =</span> <span class="fu">row_number</span>(),</span>
<span id="cb29-55"><a href="#cb29-55" tabindex="-1"></a>         <span class="at">.before =</span> analyte_dtxsid) <span class="sc">%&gt;%</span></span>
<span id="cb29-56"><a href="#cb29-56" tabindex="-1"></a>  <span class="co"># View(&quot;NCA-CvTdb&quot;)</span></span>
<span id="cb29-57"><a href="#cb29-57" tabindex="-1"></a>  <span class="fu">write_tsv</span>(<span class="st">&quot;data-raw/NCA_CvTdb.tsv&quot;</span>)</span>
<span id="cb29-58"><a href="#cb29-58" tabindex="-1"></a><span class="co"># Note that this will have more numbers because it still includes AUC_infinity == NA</span></span>
<span id="cb29-59"><a href="#cb29-59" tabindex="-1"></a></span>
<span id="cb29-60"><a href="#cb29-60" tabindex="-1"></a></span>
<span id="cb29-61"><a href="#cb29-61" tabindex="-1"></a></span>
<span id="cb29-62"><a href="#cb29-62" tabindex="-1"></a><span class="co"># TK stats</span></span>
<span id="cb29-63"><a href="#cb29-63" tabindex="-1"></a>my_tkstats <span class="ot">&lt;-</span> my_tkstats <span class="sc">%&gt;%</span></span>
<span id="cb29-64"><a href="#cb29-64" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">analyte_dtxsid =</span> Chemical, <span class="at">species =</span> Species,</span>
<span id="cb29-65"><a href="#cb29-65" tabindex="-1"></a>                <span class="at">administration_route_normalized =</span> Route, </span>
<span id="cb29-66"><a href="#cb29-66" tabindex="-1"></a>                <span class="at">conc_medium_normalized =</span> Media, </span>
<span id="cb29-67"><a href="#cb29-67" tabindex="-1"></a>                Reference,</span>
<span id="cb29-68"><a href="#cb29-68" tabindex="-1"></a>                model, method,</span>
<span id="cb29-69"><a href="#cb29-69" tabindex="-1"></a>                <span class="fu">ends_with</span>(<span class="st">&quot;tkstats&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-70"><a href="#cb29-70" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="fu">across</span>(<span class="fu">everything</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb29-71"><a href="#cb29-71" tabindex="-1"></a>  <span class="fu">ungroup</span>(Reference) <span class="sc">%&gt;%</span></span>
<span id="cb29-72"><a href="#cb29-72" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">document_ids =</span> <span class="fu">paste0</span>(<span class="fu">unique</span>(Reference), <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-73"><a href="#cb29-73" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-74"><a href="#cb29-74" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-75"><a href="#cb29-75" tabindex="-1"></a>  <span class="fu">arrange</span>(analyte_dtxsid) </span>
<span id="cb29-76"><a href="#cb29-76" tabindex="-1"></a></span>
<span id="cb29-77"><a href="#cb29-77" tabindex="-1"></a>prefit_df <span class="ot">&lt;-</span> my_pk<span class="sc">$</span>prefit<span class="sc">$</span>fit_check <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(<span class="fu">get_winning_model</span>(my_pk)) <span class="sc">%&gt;%</span></span>
<span id="cb29-78"><a href="#cb29-78" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">analyte_dtxsid =</span> Chemical, <span class="at">species =</span> Species, model, method, </span>
<span id="cb29-79"><a href="#cb29-79" tabindex="-1"></a>                fit_decision, fit_reason)</span>
<span id="cb29-80"><a href="#cb29-80" tabindex="-1"></a></span>
<span id="cb29-81"><a href="#cb29-81" tabindex="-1"></a><span class="fu">left_join</span>(my_tkstats, my_cvt_unique) <span class="sc">%&gt;%</span></span>
<span id="cb29-82"><a href="#cb29-82" tabindex="-1"></a>  <span class="fu">left_join</span>(prefit_df) <span class="sc">%&gt;%</span></span>
<span id="cb29-83"><a href="#cb29-83" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-84"><a href="#cb29-84" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-85"><a href="#cb29-85" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tkstats_id =</span> <span class="fu">row_number</span>(), <span class="at">.before =</span> analyte_dtxsid) <span class="sc">%&gt;%</span></span>
<span id="cb29-86"><a href="#cb29-86" tabindex="-1"></a>  <span class="co"># View(&quot;TKstats-CvTdb&quot;)</span></span>
<span id="cb29-87"><a href="#cb29-87" tabindex="-1"></a>  <span class="fu">write_tsv</span>(<span class="st">&quot;data-raw/tkstats_CvTdb.tsv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="co">#&gt; R version 4.3.1 (2023-06-16 ucrt)</span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a><span class="co">#&gt; Platform: x86_64-w64-mingw32/x64 (64-bit)</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="co">#&gt; Running under: Windows 11 x64 (build 22000)</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="co">#&gt; Matrix products: default</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a><span class="co">#&gt; locale:</span></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a><span class="co">#&gt; [1] LC_COLLATE=English_United States.utf8 </span></span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a><span class="co">#&gt; [2] LC_CTYPE=English_United States.utf8   </span></span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a><span class="co">#&gt; [3] LC_MONETARY=English_United States.utf8</span></span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a><span class="co">#&gt; [4] LC_NUMERIC=C                          </span></span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a><span class="co">#&gt; [5] LC_TIME=English_United States.utf8    </span></span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a><span class="co">#&gt; time zone: America/New_York</span></span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a><span class="co">#&gt; tzcode source: internal</span></span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a><span class="co">#&gt; attached base packages:</span></span>
<span id="cb30-20"><a href="#cb30-20" tabindex="-1"></a><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods  </span></span>
<span id="cb30-21"><a href="#cb30-21" tabindex="-1"></a><span class="co">#&gt; [7] base     </span></span>
<span id="cb30-22"><a href="#cb30-22" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-23"><a href="#cb30-23" tabindex="-1"></a><span class="co">#&gt; other attached packages:</span></span>
<span id="cb30-24"><a href="#cb30-24" tabindex="-1"></a><span class="co">#&gt;  [1] invivoPKfit_1.6.1  RColorBrewer_1.1-3 cowplot_1.1.1     </span></span>
<span id="cb30-25"><a href="#cb30-25" tabindex="-1"></a><span class="co">#&gt;  [4] lubridate_1.9.3    forcats_1.0.0      stringr_1.5.0     </span></span>
<span id="cb30-26"><a href="#cb30-26" tabindex="-1"></a><span class="co">#&gt;  [7] dplyr_1.1.3        purrr_1.0.2        readr_2.1.4       </span></span>
<span id="cb30-27"><a href="#cb30-27" tabindex="-1"></a><span class="co">#&gt; [10] tidyr_1.3.0        tibble_3.2.1       ggplot2_3.4.4     </span></span>
<span id="cb30-28"><a href="#cb30-28" tabindex="-1"></a><span class="co">#&gt; [13] tidyverse_2.0.0    testthat_3.2.0    </span></span>
<span id="cb30-29"><a href="#cb30-29" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-30"><a href="#cb30-30" tabindex="-1"></a><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span id="cb30-31"><a href="#cb30-31" tabindex="-1"></a><span class="co">#&gt;  [1] gtable_0.3.4        bslib_0.5.1         xfun_0.40          </span></span>
<span id="cb30-32"><a href="#cb30-32" tabindex="-1"></a><span class="co">#&gt;  [4] htmlwidgets_1.6.2   devtools_2.4.5      remotes_2.4.2.1    </span></span>
<span id="cb30-33"><a href="#cb30-33" tabindex="-1"></a><span class="co">#&gt;  [7] processx_3.8.2      tzdb_0.4.0          callr_3.7.3        </span></span>
<span id="cb30-34"><a href="#cb30-34" tabindex="-1"></a><span class="co">#&gt; [10] numDeriv_2016.8-1.1 vctrs_0.6.3         tools_4.3.1        </span></span>
<span id="cb30-35"><a href="#cb30-35" tabindex="-1"></a><span class="co">#&gt; [13] ps_1.7.5            generics_0.1.3      fansi_1.0.4        </span></span>
<span id="cb30-36"><a href="#cb30-36" tabindex="-1"></a><span class="co">#&gt; [16] pkgconfig_2.0.3     desc_1.4.2          optimx_2023-8.13   </span></span>
<span id="cb30-37"><a href="#cb30-37" tabindex="-1"></a><span class="co">#&gt; [19] lifecycle_1.0.3     multidplyr_0.1.3    compiler_4.3.1     </span></span>
<span id="cb30-38"><a href="#cb30-38" tabindex="-1"></a><span class="co">#&gt; [22] brio_1.1.3          munsell_0.5.0       httpuv_1.6.11      </span></span>
<span id="cb30-39"><a href="#cb30-39" tabindex="-1"></a><span class="co">#&gt; [25] sass_0.4.7          htmltools_0.5.6.1   usethis_2.2.2      </span></span>
<span id="cb30-40"><a href="#cb30-40" tabindex="-1"></a><span class="co">#&gt; [28] yaml_2.3.7          pracma_2.4.2        jquerylib_0.1.4    </span></span>
<span id="cb30-41"><a href="#cb30-41" tabindex="-1"></a><span class="co">#&gt; [31] later_1.3.1         pillar_1.9.0        nloptr_2.0.3       </span></span>
<span id="cb30-42"><a href="#cb30-42" tabindex="-1"></a><span class="co">#&gt; [34] crayon_1.5.2        urlchecker_1.0.1    whisker_0.4.1      </span></span>
<span id="cb30-43"><a href="#cb30-43" tabindex="-1"></a><span class="co">#&gt; [37] MASS_7.3-60         ellipsis_0.3.2      cachem_1.0.8       </span></span>
<span id="cb30-44"><a href="#cb30-44" tabindex="-1"></a><span class="co">#&gt; [40] sessioninfo_1.2.2   mime_0.12           tidyselect_1.2.0   </span></span>
<span id="cb30-45"><a href="#cb30-45" tabindex="-1"></a><span class="co">#&gt; [43] digest_0.6.33       stringi_1.7.12      rprojroot_2.0.3    </span></span>
<span id="cb30-46"><a href="#cb30-46" tabindex="-1"></a><span class="co">#&gt; [46] fastmap_1.1.1       grid_4.3.1          colorspace_2.1-0   </span></span>
<span id="cb30-47"><a href="#cb30-47" tabindex="-1"></a><span class="co">#&gt; [49] cli_3.6.1           magrittr_2.0.3      pkgbuild_1.4.2     </span></span>
<span id="cb30-48"><a href="#cb30-48" tabindex="-1"></a><span class="co">#&gt; [52] utf8_1.2.3          withr_2.5.1         prettyunits_1.2.0  </span></span>
<span id="cb30-49"><a href="#cb30-49" tabindex="-1"></a><span class="co">#&gt; [55] scales_1.2.1        promises_1.2.1      timechange_0.2.0   </span></span>
<span id="cb30-50"><a href="#cb30-50" tabindex="-1"></a><span class="co">#&gt; [58] rmarkdown_2.25      hms_1.1.3           memoise_2.0.1      </span></span>
<span id="cb30-51"><a href="#cb30-51" tabindex="-1"></a><span class="co">#&gt; [61] shiny_1.7.5         evaluate_0.22       knitr_1.44         </span></span>
<span id="cb30-52"><a href="#cb30-52" tabindex="-1"></a><span class="co">#&gt; [64] PK_1.3-6            miniUI_0.1.1.1      profvis_0.3.8      </span></span>
<span id="cb30-53"><a href="#cb30-53" tabindex="-1"></a><span class="co">#&gt; [67] rlang_1.1.1         Rcpp_1.0.11         xtable_1.8-4       </span></span>
<span id="cb30-54"><a href="#cb30-54" tabindex="-1"></a><span class="co">#&gt; [70] glue_1.6.2          pkgload_1.3.3       jsonlite_1.8.7     </span></span>
<span id="cb30-55"><a href="#cb30-55" tabindex="-1"></a><span class="co">#&gt; [73] rstudioapi_0.15.0   R6_2.5.1            fs_1.6.3</span></span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
